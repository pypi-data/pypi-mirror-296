"use strict";(self.webpackChunk_jupytergis_jupytergis_lab=self.webpackChunk_jupytergis_jupytergis_lab||[]).push([[484],{484:(e,o,t)=>{t.r(o),t.d(o,{default:()=>h});var n=t(323),a=t(33),r=t(909),s=t(314),d=t(241),m=t(818),c=t(678),l=t(256),i=t(796),u=t(473),p=t(354),g=t(230),y=t(677);class I extends y.JupyterYModel{}class j extends l.Panel{constructor(e){super(),this.onResize=()=>{this._jgisWidget&&g.MessageLoop.sendMessage(this._jgisWidget,l.Widget.ResizeMessage.UnknownSize)},this.addClass("jupytergis-notebook-widget"),this._jgisWidget=new n.JupyterGISPanel(e),this.addWidget(this._jgisWidget)}}const M={id:"jupytergis:yjswidget-plugin",autoStart:!0,optional:[y.IJupyterYWidgetManager,c.ITranslator],activate:(e,o,t)=>{if(!o)return void console.error("Missing IJupyterYWidgetManager token!");const n=null!=t?t:c.nullTranslator;o.registerWidget("@jupytergis:widget",class extends I{ydocFactory(o){const{path:t,format:r,contentType:s}=o;this.jupyterGISModel=new a.JupyterGISModel({});const d=e.serviceManager.user;if(t&&r&&s){const e=p.ServerConnection.makeSettings(),o=u.URLExt.join(e.wsUrl,"api/collaboration/room"),a=new i.WebSocketProvider({url:o,path:t,format:r,contentType:s,model:this.jupyterGISModel.sharedModel,user:d,translator:n.load("jupyterlab")});this.jupyterGISModel.disposed.connect((()=>{a.dispose()}))}else{const e=this.jupyterGISModel.sharedModel.awareness,o=o=>{e.setLocalStateField("user",o.identity)};d.ready.then((()=>{o(d)})).catch((e=>console.error(e))),d.userChanged.connect(o,this)}return this.jupyterGISModel.sharedModel.ydoc}},class{constructor(e,o){this.yModel=e,this.node=o;const t=new j({model:e.jupyterGISModel});g.MessageLoop.sendMessage(t,l.Widget.Msg.BeforeAttach),o.appendChild(t.node),g.MessageLoop.sendMessage(t,l.Widget.Msg.AfterAttach)}})}},C="jupytergis",h=[{id:"jupytergis:lab:main-menu",autoStart:!0,requires:[a.IJupyterGISDocTracker,a.IJGISFormSchemaRegistryToken,a.IJGISLayerBrowserRegistryToken,m.IStateDB],optional:[d.IMainMenu,c.ITranslator,s.ICompletionProviderManager],activate:(e,o,t,a,r,s,d,m)=>{console.log("jupytergis:lab:main-menu is activated!"),d=null!=d?d:c.nullTranslator;(0,n.createDefaultLayerRegistry)(a),(0,n.addCommands)(e,o,d,t,a,r,m);const i=new l.Menu({commands:e.commands});i.title.label=d.load("jupyterlab").__("Add Source"),i.id="jp-gis-contextmenu-addSource",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-sourcePanel",rank:3,submenu:i}),i.addItem({command:n.CommandIDs.newRasterSource,args:{from:"contextMenu"}}),i.addItem({command:n.CommandIDs.newVectorSource,args:{from:"contextMenu"}}),i.addItem({command:n.CommandIDs.newGeoJSONSource,args:{from:"contextMenu"}}),i.addItem({command:n.CommandIDs.newRasterDemSource,args:{from:"contextMenu"}}),i.addItem({command:n.CommandIDs.newImageSource,args:{from:"contextMenu"}}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-sourcePanel",rank:2}),e.contextMenu.addItem({selector:".jp-gis-source.jp-gis-sourceUnused",rank:1,command:n.CommandIDs.removeSource}),e.commands.addKeyBinding({command:n.CommandIDs.removeSource,keys:["Delete"],selector:".jp-gis-source.jp-gis-sourceUnused"}),e.contextMenu.addItem({selector:".jp-gis-source",rank:1,command:n.CommandIDs.renameSource}),e.commands.addKeyBinding({command:n.CommandIDs.renameSource,keys:["F2"],selector:".jp-gis-sourceItem"}),e.contextMenu.addItem({command:n.CommandIDs.symbology,selector:".jp-gis-layerItem",rank:1}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:1}),e.contextMenu.addItem({command:n.CommandIDs.removeLayer,selector:".jp-gis-layerItem",rank:2}),e.commands.addKeyBinding({command:n.CommandIDs.removeLayer,keys:["Delete"],selector:".jp-gis-layerItem"}),e.contextMenu.addItem({command:n.CommandIDs.renameLayer,selector:".jp-gis-layerItem",rank:2}),e.commands.addKeyBinding({command:n.CommandIDs.renameLayer,keys:["F2"],selector:".jp-gis-layerItem"});const u=new l.Menu({commands:e.commands});u.title.label=d.load("jupyterlab").__("Move Selected Layers to Group"),u.id="jp-gis-contextmenu-movelayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerItem",rank:2,submenu:u}),e.contextMenu.opened.connect((()=>function(e,o){var t,a,r,s;if(!(null===(t=o.currentWidget)||void 0===t?void 0:t.context.model))return;const d=null===(a=o.currentWidget)||void 0===a?void 0:a.context.model,m=null!==(s=null===(r=e.menu.items.find((e=>{var o;return"submenu"===e.type&&"jp-gis-contextmenu-movelayer"===(null===(o=e.submenu)||void 0===o?void 0:o.id)})))||void 0===r?void 0:r.submenu)&&void 0!==s?s:null;if(!m)return;m.clearItems();const c=function e(o){const t=[];for(const n of o)if("string"!=typeof n&&n.layers){t.push(n.name);const o=e(n.layers);t.push(...o)}return t}(d.getLayerTree());m.addItem({command:n.CommandIDs.moveLayersToGroup,args:{label:""}}),c.forEach((e=>{m.addItem({command:n.CommandIDs.moveLayersToGroup,args:{label:e}})})),m.addItem({command:n.CommandIDs.moveLayerToNewGroup})}(e.contextMenu,o))),e.contextMenu.addItem({command:n.CommandIDs.removeGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.commands.addKeyBinding({command:n.CommandIDs.removeGroup,keys:["Delete"],selector:".jp-gis-layerGroupHeader"}),e.contextMenu.addItem({command:n.CommandIDs.renameGroup,selector:".jp-gis-layerGroupHeader",rank:2}),e.commands.addKeyBinding({command:n.CommandIDs.renameGroup,keys:["F2"],selector:".jp-gis-layerGroupHeader"}),e.contextMenu.addItem({type:"separator",selector:".jp-gis-layerPanel",rank:2});const p=new l.Menu({commands:e.commands});p.title.label=d.load("jupyterlab").__("Add Layer"),p.id="jp-gis-contextmenu-addLayer",e.contextMenu.addItem({type:"submenu",selector:".jp-gis-layerPanel",rank:3,submenu:p}),p.addItem({command:n.CommandIDs.newRasterLayer,args:{from:"contextMenu"}}),p.addItem({command:n.CommandIDs.newVectorLayer,args:{from:"contextMenu"}}),p.addItem({command:n.CommandIDs.newHillshadeLayer,args:{from:"contextMenu"}}),p.addItem({command:n.CommandIDs.newImageLayer,args:{from:"contextMenu"}}),s&&function(e,o){e.editMenu.undoers.redo.add({id:n.CommandIDs.redo,isEnabled:o}),e.editMenu.undoers.undo.add({id:n.CommandIDs.undo,isEnabled:o})}(s,(()=>null!==o.currentWidget&&o.currentWidget===e.shell.currentWidget)),e.commands.addKeyBinding({command:n.CommandIDs.executeConsole,keys:["Shift Enter"],selector:".jpgis-console .jp-CodeConsole[data-jp-interaction-mode='notebook'] .jp-CodeConsole-promptCell"}),e.commands.addKeyBinding({command:n.CommandIDs.invokeCompleter,keys:["Tab"],selector:".jpgis-console .jp-CodeConsole-promptCell .jp-mod-completer-enabled"}),e.commands.addKeyBinding({command:n.CommandIDs.selectCompleter,keys:["Enter"],selector:".jpgis-console .jp-ConsolePanel .jp-mod-completer-active"})}},{id:"jupytergis:lab:controlpanel",autoStart:!0,requires:[r.ILayoutRestorer,a.IJupyterGISDocTracker,a.IJGISFormSchemaRegistryToken,m.IStateDB],activate:(e,o,t,a,r)=>{const s=new n.ControlPanelModel({tracker:t}),d=new n.LeftPanelWidget({model:s,tracker:t,state:r});d.id="jupytergis::leftControlPanel",d.title.caption="JupyterGIS Control Panel";const m=new n.RightPanelWidget({model:s,tracker:t,formSchemaRegistry:a});m.id="jupytergis::rightControlPanel",m.title.caption="JupyterGIS Control Panel",o&&(o.add(d,C),o.add(m,C)),e.shell.add(d,"left",{rank:2e3}),e.shell.add(m,"right",{rank:2e3})}},M]}}]);