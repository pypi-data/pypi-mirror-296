Metadata-Version: 2.1
Name: stacksmith
Version: 0.0.8
Summary: Enhanced Git workflow
Home-page: https://github.com/findjashua/stacksmith
Author: Jashua Gupta
Author-email: findjashua@gmail.com
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.6
Classifier: Programming Language :: Python :: 3.7
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Requires-Python: >=3.6
Description-Content-Type: text/markdown
License-File: LICENSE

# StackSmith: effortless Git branch stacking

StackSmith supercharges your Git workflow with powerful stacked branch management. Inspired by Facebook's Phabricator, it offers 5 core commands to create, update, and maintain interdependent branches effortlessly.

## Quickstart

Install StackSmith:

```bash
pip install stacksmith
```

## Five powerful commands

StackSmith uses `ss` as its base command:

1. **Create a branch**
   ```
   ss create <branch_name> [parent_branch]
   ```
   Creates a new branch, with an empty commit used for tracking branch lineage. Do not delete or modify this commit.

2. **Propagate changes**
   ```
   ss propagate
   ```
   Propagates commits from current branch up the stack, maintaining consistency.

3. **Publish changes**
   ```
   ss publish
   ```
   Pushes all branches in the stack to remote.

4. **Create a pull request**
   ```
   ss pr [title]
   ```
   Creates a pull request using the parent branch as base and links to the parent PR.

5. **Hoist a stack onto the trunk**
   ```
   ss hoist
   ```
   After merging the base branch of the stack, hoist the remaining stack onto the trunk, side-stepping conflicts caused by squash-and-merge. 
   \
   Please note that after merging, you have to fetch origin and checkout the child of the merged branch before hoisting the stack.

## Git command passthrough

StackSmith supports Git command passthrough. Any Git command not recognized as a StackSmith command will be passed directly to Git. For example:

```bash
ss add --all
ss commit -m "Your commit message"
ss push origin your-branch
```

This allows you to use StackSmith seamlessly alongside your regular Git workflow.

## Why StackSmith?

- **Stacked Workflow**: Optimized for managing interdependent feature branches.
- **Effortless Updates**: Easily keep your entire branch stack up-to-date with the trunk.
- **Consistent History**: Maintain a clean, linear history across your stacked branches.
- **Simplified Collaboration**: Streamline code reviews with well-organized, incremental changes.
- **Conflict Avoidance**: Smartly side-steps conflicts arising from squash-and-merge operations.
- **Intelligent PRs**: Automatically sets correct PR base and maintains PR relationships.
- **Idempotent Operations**: All commands are idempotent, allowing for easy recovery from errors.

## Perfect for

- Feature decomposition and incremental development
- Managing long-running feature branches
- Collaborative development on complex features
- Maintaining a clean, reviewable commit history
- Teams using squash-and-merge for pull requests

## Key Concepts

### Side-stepping squash-and-merge conflicts

When using a squash-and-merge strategy for pull requests, conflicts typically arise in stacked branches. StackSmith's `hoist` command cleverly side-steps these conflicts, allowing your stacked branches to update smoothly without manual conflict resolution.

### Intelligent pull requests

StackSmith's `pr` command automatically sets the parent branch as the base for your pull request. It also adds a link to the parent PR in the description, maintaining the relationship between stacked branches in your PR chain.

### Idempotent operations

All StackSmith operations are designed to be idempotent. This means that in case of an error due to any issue (merge conflict, internet issue, etc.), you can simply resolve the issue and rerun the command. StackSmith will pick up where it left off, ensuring a smooth workflow even in the face of unexpected problems.

### Recommendations
1. Do not amend commits, as they can result in merge conflicts during `propagate`
2. To prevent PRs in the stack from accidentally getting merged out of order, create the following workflow:
 `.github/workflows/enforce-merge-to-trunk-only.yml`
```
name: Enforce Merge to Trunk Only

on:
  pull_request_target:
    types: [synchronize, labeled]
  check_suite:
    types: [requested]

env:
  TRUNK_BRANCH: ${{ github.event.repository.default_branch }}

jobs:
  check-base-branch:
    runs-on: ubuntu-latest
    if: contains(github.event.pull_request.labels.*.name, 'merge-to-trunk-only')
    steps:
      - name: Check if base branch is trunk
        run: |
          if [ "${{ github.event.pull_request.base.ref }}" != "${{ env.TRUNK_BRANCH }}" ]; then
            echo "Error: This PR is labeled with 'merge-to-trunk-only' but the base branch is not '${{ env.TRUNK_BRANCH }}'."
            echo "Current base branch: ${{ github.event.pull_request.base.ref }}"
            echo "Please update the PR to target the '${{ env.TRUNK_BRANCH }}' branch before merging, or remove the 'merge-to-trunk-only' label."
            exit 1
          fi
      - name: PR can be merged
        if: success()
        run: echo "PR base branch is '${{ env.TRUNK_BRANCH }}' and can be merged"
```        

## Requirements

- Python 3.6+
- Git 2.38+
- GitHub CLI (for pull requests)

## License

StackSmith is open source software licensed under the MIT License. See the LICENSE file for more details.

This project is not affiliated with or endorsed by GitHub or any Git project. Git is a trademark of Software Freedom Conservancy.
