import{_ as O,aT as w,V as c,aA as u,aJ as l,aC as b,Q as d,W as k,al as y,aB as _,ag as P,bs as K,R as T,A as L,z as C,ch as B,ci as E,S as v,aE as N,U as g,af as R}from"./admin-drawer-panel-BAT7GA64.js";import{C as p,t as V,c as A}from"./main-CmjU2oTp.js";import{V as D}from"./VTable-2af995xo.js";import{C as x}from"./confirm-dialog-CbW3hlOp.js";import{c as G}from"./copy-to-clipboard-DoUvDJVx.js";import"./VDialog-GbxvFMMN.js";const U={name:"StatsTable",props:{title:{type:String,required:!0},items:{type:Object,required:!0}},data(){return{}},methods:{valueTable(e){return e&&typeof e=="object"?e:{}},tdClasses(e){return{indent:e[0]==="+"}},tdLabel(e){return e.replace(/^\+/,"")},nf(e){return typeof e=="number"?w.format(e):e}}},z={class:"statBlock"},F={key:0},H={colspan:"2",class:"subtitleRow"},$={key:1},M={class:"indent"};function q(e,s,t,r,a,o){return c(),u("div",z,[l("h3",null,b(t.title),1),d(D,{class:"highlight-table"},{default:k(()=>[(c(!0),u(y,null,_(Object.entries(t.items),([n,i])=>(c(),u("tbody",{key:n},[typeof i=="object"?(c(),u("tr",F,[l("th",H,b(n),1)])):(c(),u("tr",$,[l("td",{class:P(o.tdClasses(n))},b(o.tdLabel(n)),3),l("td",null,b(o.nf(i)),1)])),(c(!0),u(y,null,_(Object.entries(o.valueTable(i)),([m,f])=>(c(),u("tr",{key:m},[l("td",M,b(m),1),l("td",null,b(o.nf(f)),1)]))),128))]))),128)),K(e.$slots,"default",{},void 0,!0)]),_:3})])}const J=O(U,[["render",q],["__scopeId","data-v-4bb3ecd9"]]),Q="Copy API Key to clipboard",h=e=>{const s={};for(const t of e)s[t.value]=t.title;return s},S={topGroup:p.browser.groupNames,orderBy:h(p.browser.orderBy),fitTo:h(p.reader.fitTo),readingDirection:h(p.reader.readingDirection)},I={authGroupCount:"Authorization Groups",libraryCount:"Libraries",userAnonymousCount:"Anonymous Users",userRegisteredCount:"Registered Users"};Object.freeze(I);Object.freeze(S);const j=new Set(["storyArcNumbersCount","identifierTypesCount","contributorPersonsCount","contributorRolesCount"]);Object.freeze(j);const W={name:"AdminTasksTab",components:{ConfirmDialog:x,StatsTable:J},data(){return{showTooltip:{show:!1},schemaHref:window.CODEX.API_V3_PATH+"#/api/api_v3_admin_stats_retrieve"}},computed:{...T(L,{}),...T(C,{stats:e=>e.stats}),clipBoardEnabled(){return location.prototcal=="https:"},apiTooltip(){return Q?this.clipBoardEnabled:void 0},clipBoardIcon(){return this.showTooltip?B:E},platformTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.platform)){const a=this.keyToLabel(t),o=t==="system"?`${r.name} ${r.release}`:r;e[a]=o}return e},configTable(){var t;const e={};let s="";for(const[r,a]of Object.entries((t=this.stats)==null?void 0:t.config)){let o;if(r=="apiKey"){s=a;continue}else o=I[r];e[o]=a}return e["API Key"]=s,e},userSettingsTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.sessions)){const a={},o=S[t];for(const[i,m]of Object.entries(r)){let f;o?f=o[V(i)]:f=i,a[f]=m}const n=this.keyToLabel(t);e[n]=a}return e},browserGroupsTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.groups)){let a=this.keyToLabel(t);a!=="Series"&&(a+="s"),e[a]=r}return e},fileTypesTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.fileTypes)){const a=t==="unknown"?A(t):this.keyToLabel(t).toUpperCase();e[a]=r}return e},metadataTable(){var s;const e={};for(const[t,r]of Object.entries((s=this.stats)==null?void 0:s.metadata)){let a=t==="countryCount"?"Countries":this.keyToLabel(t)+"s";j.has(t)&&(a=a.replace(/^\w+ /,"+")),e[a]=r}return e}},created(){this.loadStats()},methods:{...v(C,["loadStats","updateAPIKey"]),regenAPIKey(){this.updateAPIKey().then(this.loadStats).catch(console.warn)},onClickAPIKey(){this.clipBoardEnabled&&G(this.stats.config.apiKey,this.showTooltip)},keyToLabel(e){return e=e.replace(/Count$/,""),A(e)}}},X={key:0,id:"stats"},Y={id:"schemaDoc"},Z={colspan:"2"},ee=["href"],te={colspan:"2"};function se(e,s,t,r,a,o){const n=g("StatsTable"),i=g("ConfirmDialog");return e.stats?(c(),u("div",X,[d(n,{title:"Platform",items:o.platformTable},null,8,["items"]),d(n,{title:"Config",items:o.configTable},{default:k(()=>[l("tbody",null,[l("tr",Y,[l("td",Z,[s[0]||(s[0]=R(" The only endpoint accessible by API Key is ")),l("a",{href:a.schemaHref,target:"_blank"},"/admin/stats",8,ee)])]),l("tr",null,[l("td",te,[d(i,{"button-text":"Regenerate API Key","title-text":"Regenerate","object-name":"API Key","confirm-text":"Regenerate",onConfirm:o.regenAPIKey},null,8,["onConfirm"])])])])]),_:1},8,["items"]),d(n,{title:"User Settings",items:o.userSettingsTable},null,8,["items"]),d(n,{title:"Browser Groups",items:o.browserGroupsTable},null,8,["items"]),d(n,{title:"File Types",items:o.fileTypesTable},null,8,["items"]),d(n,{title:"Metadata",items:o.metadataTable},null,8,["items"])])):N("",!0)}const ce=O(W,[["render",se],["__scopeId","data-v-e443c3c3"]]);export{ce as default};
