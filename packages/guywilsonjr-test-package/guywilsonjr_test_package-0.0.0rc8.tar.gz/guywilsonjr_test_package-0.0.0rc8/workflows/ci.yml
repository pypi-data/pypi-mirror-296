name: CI

on:
  workflow_call:
    inputs:
      python-versions:
        description: 'Python versions to test as stringified array'
        required: true
        type: string
      ref_name:
        required: true
        type: string
jobs:
  static-analysis:
    name: Test Actions
    steps:
      - uses: guywilsonjr/actions/actions/valid_checkout@main
        name: Checkout
        with:
          ref: ${{ github.ref_name }}
      - name: Test Static Analysis
        uses: guywilsonjr/actions/actions/static-analysis@main
  build:
    name: Build
    needs: static-analysis
    strategy:
      fail-fast: false
      matrix:
        build-type: ['sdist', 'wheel']
        python-version: fromJson('${{ inputs.python-versions }}')
    steps:
      - uses: guywilsonjr/actions/actions/valid_checkout@main
        name: Checkout
        with:
          ref: ${{ github.ref_name }}
      - name: Test Build SDist
        uses: "guywilsonjr/actions/actions/build-${{matrix.build-type}}@main"
        with:
          python-version: ${{ inputs.python-version }}
      - name: Test Build Wheel
        uses: guywilsonjr/actions/actions/build-wheel@main
        with:
          python-version: ${{ inputs.python-version }}


