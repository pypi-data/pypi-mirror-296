import{openBlock as l,createElementBlock as b,unref as t,createElementVNode as e,renderSlot as Q,defineComponent as C,ref as w,onMounted as P,watchEffect as N,resolveComponent as O,createVNode as _,withCtx as y,createTextVNode as R,toDisplayString as o,createCommentVNode as z,normalizeClass as Y,Fragment as B,renderList as F,createBlock as q,computed as E,Teleport as W,withModifiers as H,createApp as oe}from"vue";import{u as I,aw as L,_ as J,v as T,az as se,aR as re,J as G,G as X,L as ae,at as x,aS as ne,aT as le,I as j,a1 as ie,an as de,S as ce,aU as ue,aa as _e,aV as me,aW as K,aX as fe,aY as be,x as he,aZ as pe,a_ as ee,a$ as ve,b0 as ge,b1 as $e,aC as ye,b2 as we,b3 as ke,aH as ze,aD as Ae,aK as Z,av as Me,aL as Ce,aM as Re,aN as Ie,a9 as Se,b4 as qe,b5 as Oe,aO as Te,aP as Be,aQ as Pe}from"./sentry.5.2.1.dev28756.js";import"vue-content-loader";import"./_commonjsHelpers.5.2.1.dev28756.js";function Is(){import.meta.url,import("_").catch(()=>1);async function*v(){}}const Ue=["aria-label"],Ve={class:"fr-breadcrumb__list"},D={__name:"Breadcrumb",setup(v){const{t:s}=I();return(r,i)=>(l(),b("nav",{rol:"navigation","aria-label":t(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[e("ol",Ve,[Q(r.$slots,"default")])],8,Ue))}},Ee={class:"fr-container--fluid"},Le={key:0},De={class:"fr-breadcrumb__link","aria-current":"page"},He={class:"fr-alert fr-alert--info"},Ne={class:"fr-alert__title"},We=C({__name:"Datasets",props:{oid:{}},setup(v){const{t:s}=I(),r=v,i="/admin/organization/".concat(r.oid,"/"),a=w(null),n=w(null);return P(async()=>a.value=await L()),N(()=>{var c,d;n.value=(d=(c=a.value)==null?void 0:c.organizations.find(h=>h.id===r.oid))!=null?d:null}),(c,d)=>{const h=O("router-link");return l(),b("div",Ee,[_(D,null,{default:y(()=>[e("li",null,[_(h,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(t(s)("Administration")),1)]),_:1})]),n.value?(l(),b("li",Le,[_(h,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(n.value.name),1)]),_:1})])):z("",!0),e("li",null,[e("a",De,o(t(s)("Datasets")),1)])]),_:1}),e("div",He,[e("h3",Ne,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",{href:i},o(t(s)("You can manage your datasets on the current admin.")),1)])])])}}}),je={class:"fr-container--fluid"},Ye={key:0},Fe={class:"fr-breadcrumb__link","aria-current":"page"},Ze={class:"fr-alert fr-alert--info"},Je={class:"fr-alert__title"},Ge=C({__name:"Reuses",props:{oid:{}},setup(v){const{t:s}=I(),r=v,i="/admin/organization/".concat(r.oid,"/"),a=w(null),n=w(null);return P(async()=>a.value=await L()),N(()=>{var c,d;n.value=(d=(c=a.value)==null?void 0:c.organizations.find(h=>h.id===r.oid))!=null?d:null}),(c,d)=>{const h=O("router-link");return l(),b("div",je,[_(D,null,{default:y(()=>[e("li",null,[_(h,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(t(s)("Administration")),1)]),_:1})]),n.value?(l(),b("li",Ye,[_(h,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(n.value.name),1)]),_:1})])):z("",!0),e("li",null,[e("a",Fe,o(t(s)("Reuses")),1)])]),_:1}),e("div",Ze,[e("h3",Je,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",{href:i},o(t(s)("You can manage your reuses on the current admin.")),1)])])])}}}),Ke={class:"fr-container--fluid"},Qe={class:"fr-breadcrumb__link","aria-current":"page"},Xe={key:0,class:"fr-h1"},xe={class:"fr-alert fr-alert--info"},et={class:"fr-alert__title"},tt={href:"/admin/me/"},ot=C({__name:"Me",setup(v){const{t:s}=I(),r=w(null);return P(async()=>r.value=await L()),(i,a)=>{const n=O("router-link");return l(),b("div",Ke,[_(D,null,{default:y(()=>[e("li",null,[_(n,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(t(s)("Administration")),1)]),_:1})]),e("li",null,[e("a",Qe,o(t(s)("Me")),1)])]),_:1}),r.value?(l(),b("h1",Xe,o(r.value.first_name)+" "+o(r.value.last_name),1)):z("",!0),e("div",xe,[e("h3",et,o(t(s)("This is a WIP page")),1),e("p",null,[e("a",tt,o(t(s)("You can edit your profil on the current admin.")),1)])])])}}}),st={class:"fr-sidemenu__item"},rt=["innerHTML"],at=C({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(v){return(s,r)=>{const i=O("router-link");return l(),b("li",st,[e("div",{class:Y([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(l(),b("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,rt)):s.icon?(l(),b("div",{key:1,class:Y([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):z("",!0),_(i,{to:s.to},{default:y(()=>[R(o(s.label),1)]),_:1},8,["to"])],2)])}}});const V=J(at,[["__scopeId","data-v-6240fbee"]]),nt='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',lt=["aria-expanded","aria-controls","aria-current"],it={class:"logo logo--sm"},dt={class:"fr-mx-1w fr-col text-overflow-ellipsis"},ct=["id"],ut={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},_t=C({__name:"AdminSidebarOrganizationMenu",props:{organization:{},isOpened:{type:Boolean}},setup(v){const{t:s}=I(),r=T("organization-menu");return(i,a)=>(l(),b("li",{class:Y(["fr-sidemenu__item",{"fr-sidemenu__item--active":i.isOpened}])},[e("button",{class:"fr-sidemenu__btn","aria-expanded":i.isOpened,"aria-controls":t(r),"aria-current":i.isOpened},[e("div",it,[_(se,{type:"organization",src:i.organization.logo_thumbnail,size:20},null,8,["src"])]),e("p",dt,o(i.organization.name),1)],8,lt),e("div",{class:"fr-collapse","data-fr-js-collapse":"",id:t(r)},[e("ul",ut,[_(V,{iconHtml:t(nt),label:t(s)("Datasets"),to:{name:"organization-datasets",params:{oid:i.organization.id}}},null,8,["iconHtml","label","to"]),_(V,{icon:"fr-icon-line-chart-line",label:t(s)("Reuses"),to:{name:"organization-reuses",params:{oid:i.organization.id}}},null,8,["label","to"]),_(V,{icon:"fr-icon-parent-line",label:t(s)("Members"),to:{name:"organization-members",params:{oid:i.organization.id}}},null,8,["label","to"]),_(V,{icon:"fr-icon-user-line",label:t(s)("Profile"),to:{name:"organization-profile",params:{oid:i.organization.id}}},null,8,["label","to"])])],8,ct)],2))}});const mt=J(_t,[["__scopeId","data-v-58992dd6"]]),ft={class:"fr-container--fluid h-100"},bt={class:"fr-grid-row h-100 bg-grey-50"},ht={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},pt=["aria-label"],vt={class:"fr-sidemenu__inner"},gt=["aria-controls"],$t=["id"],yt={class:"fr-sidemenu__list"},wt={class:"fr-sidemenu__item"},kt=["aria-controls"],zt={class:"fr-mx-1v"},At=["id"],Mt={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},Ct=C({__name:"Admin",setup(v){const{t:s}=I(),r=re(),i=T("menu"),a=T("profil-submenu"),n=w(null),c=w(null);function d(h){return h===c.value}return P(async()=>{n.value=await L(),n.value.organizations.length>0&&(r.params.oid?c.value=r.params.oid:c.value=n.value.organizations[0].id)}),(h,$)=>{const M=O("router-view");return l(),b("div",ft,[e("div",bt,[e("div",ht,[e("nav",{class:"fr-sidemenu","aria-label":t(s)("Administration menu")},[e("div",vt,[e("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":t(i),"aria-expanded":"false"},o(t(s)("Open menu")),9,gt),e("div",{class:"fr-collapse",id:t(i)},[e("ul",yt,[e("li",wt,[e("button",{class:"fr-sidemenu__btn border-bottom border-default-grey","aria-expanded":"false","aria-controls":t(a)},[_(G,{user:t(X),size:24,rounded:!0},null,8,["user"]),e("p",zt,o(t(s)("My Profil")),1)],8,kt),e("div",{class:"fr-collapse",id:t(a)},[_(V,{icon:"fr-icon-account-circle-line",label:t(s)("Me"),to:"/me"},null,8,["label"])],8,At)]),n.value?(l(!0),b(B,{key:0},F(n.value.organizations,m=>(l(),q(mt,{organization:m,"is-opened":d(m.id)},null,8,["organization","is-opened"]))),256)):z("",!0)])],8,$t)])],8,pt)]),e("div",Mt,[(l(),q(M,{key:t(r).fullPath}))])])])}}});const Rt=J(Ct,[["__scopeId","data-v-7ab2922f"]]),It={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},te=C({__name:"AdminDangerZone",setup(v){return(s,r)=>(l(),q(t(ae),{color:"error",type:"secondary",weight:"regular"},{default:y(()=>[e("div",It,[Q(s.$slots,"default")])]),_:3}))}}),St=["aria-labelledby","id"],qt={class:"fr-container fr-container--fluid fr-container-md"},Ot={class:"fr-grid-row fr-grid-row--center"},Tt={class:"fr-col-12 fr-col-md-8"},Bt={class:"fr-modal__body"},Pt={class:"fr-modal__header"},Ut=["title","aria-controls"],Vt={class:"fr-modal__content"},Et=["id"],Lt={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},Dt={class:"fr-col"},Ht={class:"fr-col-auto"},Nt=["disabled"],Wt={class:"fr-col"},jt={class:"fr-m-0 text-grey-500"},Yt={class:"fr-m-0 fr-text--xs text-default-error"},Ft={class:"fr-col-auto"},Zt=["disabled"],Jt=C({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v,{emit:s}){const r=v,i=s,a=E(()=>"fr-modal-title-user-"+r.id),{t:n}=I(),{toast:c}=j(),d=w(!1);async function h(u){if(!u.newRole){m();return}try{d.value=!0,await ne(r.oid,u.user.id,u.newRole),i("memberUpdated"),m()}catch(p){c.error(n("An error occurred while update member role."))}finally{d.value=!1}}async function $(u){try{d.value=!0,await le(r.oid,u.user.id),i("memberUpdated")}catch(p){c.error(n("An error occurred while removing this member."))}finally{d.value=!1}}function M(u){return r.roles.map(p=>{const g={...p};return g.value===u&&(g.selected=!0),g})}function m(){d.value=!1;const u=document.getElementById(r.id);globalThis.dsfr(u).modal.conceal()}return(u,p)=>(l(),q(W,{to:"body"},[e("dialog",{"aria-labelledby":a.value,role:"dialog",id:u.id,class:"fr-modal"},[e("div",qt,[e("div",Ot,[e("div",Tt,[e("div",Bt,[e("div",Pt,[e("button",{class:"fr-btn--close fr-btn",title:t(n)("Close the modal dialog"),"aria-controls":u.id},o(t(n)("Close")),9,Ut)]),e("div",Vt,[e("h1",{id:a.value,class:"fr-modal__title fr-mb-2w"},o(t(n)("Edit member")),9,Et),e("p",Lt,[_(G,{class:"fr-mr-1v",user:u.member.user,rounded:!0,size:24},null,8,["user"]),R(" "+o(u.member.user.first_name)+" "+o(u.member.user.last_name),1)]),e("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:p[1]||(p[1]=H(g=>h(u.member),["prevent"]))},[e("div",Dt,[u.roles.length>0?(l(),q(x,{key:0,label:t(n)("Role of the member"),"model-value":u.member.role,"onUpdate:modelValue":p[0]||(p[0]=g=>u.member.newRole=g),options:M(u.member.role)},null,8,["label","model-value","options"])):z("",!0)]),e("div",Ht,[e("button",{class:"fr-btn",type:"submit",disabled:d.value},o(t(n)("Validate")),9,Nt)])],32),_(te,{class:"fr-mt-2w"},{default:y(()=>[e("div",Wt,[e("p",jt,o(t(n)("Remove member from the organization")),1),e("p",Yt,o(t(n)("Be careful, this action can't be reverse.")),1)]),e("div",Ft,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:d.value,onClick:p[2]||(p[2]=g=>$(u.member))},o(t(n)("Remove member")),9,Zt)])]),_:1})])])])])])],8,St)]))}}),Gt=["aria-controls"],Kt=C({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(v){const s=v,{t:r}=I(),i=E(()=>"fr-modal-user-"+s.member.user.id);return(a,n)=>(l(),b(B,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":i.value},o(t(r)("Edit")),9,Gt),_(Jt,{id:i.value,member:a.member,oid:a.oid,roles:a.roles,onMemberUpdated:n[0]||(n[0]=c=>a.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Qt={class:"fr-mt-n9v fr-mb-2w"},Xt={class:"fr-badge fr-badge--info fr-badge--no-icon"},xt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},eo={class:"fr-col"},to={class:"fr-grid-row fr-grid-row--middle"},oo={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},so={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},ro=["disabled"],ao=["disabled","aria-controls"],no=["aria-labelledby","id"],lo={class:"fr-container fr-container--fluid fr-container-md"},io={class:"fr-grid-row fr-grid-row--center"},co={class:"fr-col-12 fr-col-md-8"},uo={class:"fr-modal__body"},_o={class:"fr-modal__header"},mo=["title","aria-controls"],fo={class:"fr-modal__content"},bo=["id"],ho={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},po={class:"fr-col-auto"},vo=["disabled"],go={class:"fr-col-auto"},$o=["disabled"],yo=C({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(v,{emit:s}){const r=v,i=s,{t:a}=I(),n=w(""),c=T("modal"),d=T("modalTitle");function h(){const m=document.getElementById(c);globalThis.dsfr(m).modal.conceal()}function $(){i("refuse",r.request.id,n.value),h()}function M(){n.value="",h()}return(m,u)=>{const p=O("AdminMembershipRequest",!0);return l(),q(ie,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:y(()=>[e("div",Qt,[e("p",Xt,[u[2]||(u[2]=e("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),R(" "+o(t(a)("Membership Request")),1)])]),e("div",xt,[e("div",eo,[e("div",to,[_(G,{class:"fr-mr-1v",user:m.request.user,rounded:!0,size:24},null,8,["user"]),R(" "+o(t(a)("{fullName} asks to join the organization.",{fullName:m.request.user.first_name+" "+m.request.user.last_name})),1)]),e("div",oo,o(m.request.comment),1)]),m.showActions?(l(),b("div",so,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:u[0]||(u[0]=g=>m.$emit("accept",m.request.id)),disabled:m.loading,"data-testid":"accept"},o(t(a)("Accept request")),9,ro),e("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:m.loading,"data-fr-opened":"false","aria-controls":t(c),"data-testid":"refuse"},o(t(a)("Refuse")),9,ao),(l(),q(W,{to:"body"},[e("dialog",{"aria-labelledby":t(d),role:"dialog",id:t(c),class:"fr-modal","data-testid":"modal"},[e("div",lo,[e("div",io,[e("div",co,[e("div",uo,[e("div",_o,[e("button",{class:"fr-btn--close fr-btn",title:t(a)("Close the modal dialog"),"aria-controls":t(c),onClick:H(M,["prevent"])},o(t(a)("Close")),9,mo)]),e("div",fo,[e("h1",{id:t(d),class:"fr-modal__title fr-mb-2w"},o(t(a)("Refuse membership request")),9,bo),_(p,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:m.oid,request:m.request,"show-actions":!1},null,8,["oid","request"]),e("form",{onSubmit:H($,["prevent"]),onReset:M},[_(de,{label:t(a)("You can provide the refusal reason:"),modelValue:n.value,"onUpdate:modelValue":u[1]||(u[1]=g=>n.value=g),"data-testid":"comment-group"},null,8,["label","modelValue"]),e("div",ho,[e("div",po,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:m.loading,"data-testid":"cancel-modal-button"},o(t(a)("Cancel")),9,vo)]),e("div",go,[e("button",{class:"fr-btn",type:"submit",disabled:m.loading,"data-testid":"refuse-modal-button"},o(t(a)("Refuse request")),9,$o)])])],32)])])])])])],8,no)]))])):z("",!0)])]),_:1})}}}),wo=["aria-labelledby","id"],ko={class:"fr-container fr-container--fluid fr-container-md"},zo={class:"fr-grid-row fr-grid-row--center"},Ao={class:"fr-col-12 fr-col-md-8"},Mo={class:"fr-modal__body"},Co={class:"fr-modal__header"},Ro=["title","aria-controls"],Io={class:"fr-modal__content"},So=["id"],qo={class:"fr-modal__footer"},Oo={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},To=["disabled"],Bo=["disabled"],Po=C({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(v,{emit:s}){const r=v,i=s,{t:a}=I(),{toast:n}=j(),c=w(!1),d=w(),h=w("editor"),$=E(()=>"fr-modal-title-user-"+r.id);async function M(){try{c.value=!0,d.value&&(await ue(r.oid,d.value,h.value),i("memberAdded"),u())}catch(p){n.error(a("An error occurred while update member role."))}finally{c.value=!1}}function m(p){return p.map(g=>{var k;const f={...g,avatar_thumbnail:(k=g.avatar_url)!=null?k:void 0};return{value:f.id,label:f.first_name+" "+f.last_name,image:_e(f,32)}})}function u(){c.value=!1,d.value=void 0,h.value="editor";const p=document.getElementById(r.id);globalThis.dsfr(p).modal.conceal()}return(p,g)=>(l(),q(W,{to:"body"},[e("dialog",{"aria-labelledby":$.value,role:"dialog",id:p.id,class:"fr-modal"},[e("div",ko,[e("div",zo,[e("div",Ao,[e("div",Mo,[e("div",Co,[e("button",{class:"fr-btn--close fr-btn",title:t(a)("Close the modal dialog"),"aria-controls":p.id},o(t(a)("Close")),9,Ro)]),e("form",{onSubmit:H(M,["prevent"])},[e("div",Io,[e("h1",{id:$.value,class:"fr-modal__title fr-mb-2w"},o(t(a)("Add member to the organization")),9,So),_(ce,{placeholder:p.$t("Search a user"),searchPlaceholder:p.$t("Search a user..."),suggestUrl:"/users/suggest/",values:d.value,onChange:g[0]||(g[0]=f=>d.value=f),allOption:p.$t("Select a user"),addAllOption:!1,onSuggest:m,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),p.roles.length>0?(l(),q(x,{key:0,label:t(a)("Role of the member"),"model-value":h.value,"onUpdate:modelValue":g[1]||(g[1]=f=>h.value=f),options:p.roles},null,8,["label","model-value","options"])):z("",!0)]),e("div",qo,[e("div",Oo,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:u,disabled:c.value},o(t(a)("Cancel")),9,To),e("button",{class:"fr-btn",type:"submit",disabled:c.value},o(t(a)("Add to the organization")),9,Bo)])])],32)])])])])],8,wo)]))}}),Uo=["aria-controls"],Vo=C({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(v){const s=v,{t:r}=I(),i=E(()=>"fr-modal-add-user-"+s.oid);return(a,n)=>(l(),b(B,null,[e("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":i.value},o(t(r)("Add member")),9,Uo),_(Po,{id:i.value,oid:a.oid,roles:a.roles,onMemberAdded:n[0]||(n[0]=c=>a.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Eo={key:0},Lo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Do={class:"fr-col-12 fr-col-md"},Ho={class:"fr-h1 fr-mb-2w"},No={key:0,class:"fr-col-auto"},Wo={class:"subtitle subtitle--uppercase"},jo={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},Yo={class:"fr-table fr-table--layout-fixed"},Fo={scope:"col"},Zo={scope:"col"},Jo={scope:"col"},Go={scope:"col"},Ko={scope:"col"},Qo={key:0,scope:"col"},Xo={class:"fr-badge"},xo={key:0},es={key:1},ts={key:0},os=C({__name:"Members",props:{oid:{}},setup(v){const s=v,{t:r}=I(),{toast:i}=j(),a=w([]),n=E(()=>me||h.value.some(f=>{var k;return f.user.id===((k=X)==null?void 0:k.id)&&f.role==="admin"})),c=w([]),d={name:"SomeName"},h=w([]),$=w(!1);function M(f){var k,S;return(S=(k=c.value.find(A=>A.value===f))==null?void 0:k.label)!=null?S:f}async function m(){const f=await ee(s.oid);h.value=f.members}async function u(){const f=await K(s.oid);a.value=f}async function p(f){$.value=!0;const k=[];try{await ve(s.oid,f),k.push(u()),k.push(m())}catch(S){i.error(r("An error occurred while accepting this membership."))}finally{Promise.all(k).finally(()=>$.value=!1)}}async function g(f,k){$.value=!0;const S=[];try{await ge(s.oid,f,k),S.push(u()),S.push(m())}catch(A){i.error(r("An error occurred while refusing this membership."))}finally{Promise.all(S).finally(()=>$.value=!1)}}return N(()=>{n.value&&K(s.oid).then(f=>a.value=f)}),P(()=>{fe().then(be).then(f=>c.value=f),m()}),(f,k)=>{const S=O("router-link");return l(),b("div",null,[_(D,null,{default:y(()=>[e("li",null,[_(S,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(t(r)("Administration")),1)]),_:1})]),d?(l(),b("li",Eo,[_(S,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(d.name),1)]),_:1})])):z("",!0),k[0]||(k[0]=e("li",null,null,-1))]),_:1}),e("div",Lo,[e("div",Do,[e("h1",Ho,o(t(r)("Members")),1)]),n.value?(l(),b("div",No,[_(Vo,{oid:f.oid,roles:c.value,onMemberAdded:m},null,8,["oid","roles"])])):z("",!0)]),a.value.length?(l(),b(B,{key:0},[e("h2",Wo,o(t(r)("{n} requests",{n:a.value.length})),1),(l(!0),b(B,null,F(a.value,A=>(l(),q(yo,{class:"fr-mb-4w",key:A.id,loading:$.value,oid:f.oid,request:A,"show-actions":!0,onAccept:p,onRefuse:g},null,8,["loading","oid","request"]))),128))],64)):z("",!0),e("h2",jo,o(t(r)("{n} members",{n:h.value.length})),1),e("div",Yo,[e("table",null,[e("thead",null,[e("tr",null,[e("th",Fo,o(t(r)("Members")),1),e("th",Zo,o(t(r)("Email")),1),e("th",Jo,o(t(r)("Status")),1),e("th",Go,o(t(r)("Member since")),1),e("th",Ko,o(t(r)("Last connection")),1),n.value?(l(),b("th",Qo,o(t(r)("Action")),1)):z("",!0)])]),e("tbody",null,[(l(!0),b(B,null,F(h.value,A=>(l(),b("tr",{key:A.user.id},[e("td",null,o(A.user.first_name)+" "+o(A.user.last_name),1),e("td",null,o(A.user.email),1),e("td",null,[e("p",Xo,o(M(A.role)),1)]),e("td",null,o(t(he)(A.since)),1),e("td",null,[A.user.last_login_at?(l(),b("span",xo,o(t(pe)(A.user.last_login_at)),1)):(l(),b("span",es,o(t(r)("No connection")),1))]),n.value?(l(),b("td",ts,[_(Kt,{member:A,oid:f.oid,roles:c.value,onMemberUpdated:m},null,8,["member","oid","roles"])])):z("",!0)]))),128))])])])])}}}),ss={class:"fr-container--fluid"},rs={key:0},as={class:"fr-breadcrumb__link","aria-current":"page"},ns=["id"],ls=["disabled","onClick"],is={class:"fr-col"},ds={class:"fr-m-0 text-grey-500"},cs={class:"fr-m-0 fr-text--xs text-default-error"},us={class:"fr-col-auto"},_s=["disabled","aria-controls"],ms=["aria-labelledby","id"],fs={class:"fr-container fr-container--fluid fr-container-md"},bs={class:"fr-grid-row fr-grid-row--center"},hs={class:"fr-col-12 fr-col-md-8"},ps={class:"fr-modal__body"},vs={class:"fr-modal__header"},gs=["title","aria-controls"],$s={class:"fr-modal__content"},ys=["id"],ws={class:"fr-text--bold"},ks={class:"fr-modal__footer"},zs={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},As=["disabled"],Ms=C({__name:"Profile",props:{oid:{}},setup(v){const{t:s}=I(),{toast:r}=j(),i=v,a=$e(),n=w(null),c=w(null),d=w(null),h=w([]),$=w(!1),M=T("modal"),m=T("modalTitle");function u(){d.value&&($.value=!0,we(d.value.id).then(()=>{a.replace("/"),window.location.reload()}).catch(()=>r.error(s("An error occured when deleting the organization."))).finally(()=>$.value=!1))}function p(g,f){$.value=!0,ke(g).then(()=>r.success(s("Organization updated !"))).catch(()=>r.error(s("An error occured when updating the organization."))).finally(()=>$.value=!1)}return P(async()=>n.value=await L()),N(async()=>{d.value=await ee(i.oid)}),(g,f)=>{const k=O("router-link");return l(),b("div",ss,[_(D,null,{default:y(()=>[e("li",null,[_(k,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(t(s)("Administration")),1)]),_:1})]),d.value?(l(),b("li",rs,[_(k,{class:"fr-breadcrumb__link",to:"/"},{default:y(()=>[R(o(d.value.name),1)]),_:1})])):z("",!0),e("li",null,[e("a",as,o(t(s)("Profile")),1)])]),_:1}),c.value?(l(),b("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:c.value.legend},o(t(s)("Edit profile")),9,ns)):z("",!0),d.value?(l(),q(ye,{key:1,organization:d.value,errors:h.value,showLegend:!1,showWell:!1,ref_key:"form",ref:c,onSubmit:p},{submitButton:y(({submit:S})=>[e("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:$.value,"data-testid":"submitButton",onClick:S},o(t(s)("Save")),9,ls)]),default:y(()=>[_(te,{class:"fr-mt-6w"},{default:y(()=>[e("div",is,[e("p",ds,o(t(s)("Delete the organization")),1),e("p",cs,o(t(s)("Be careful, this action can't be reverse.")),1)]),e("div",us,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:$.value,"data-fr-opened":"false","aria-controls":t(M)},o(t(s)("Delete")),9,_s),(l(),q(W,{to:"body"},[e("dialog",{"aria-labelledby":t(m),role:"dialog",id:t(M),class:"fr-modal"},[e("div",fs,[e("div",bs,[e("div",hs,[e("div",ps,[e("div",vs,[e("button",{class:"fr-btn--close fr-btn",title:t(s)("Close the modal dialog"),"aria-controls":t(M)},o(t(s)("Close")),9,gs)]),e("div",$s,[e("h1",{id:t(m),class:"fr-modal__title fr-mb-2w"},o(t(s)("Are you sure you want to delete this organization ?")),9,ys),e("p",ws,o(t(s)("This action can't be reverse.")),1),e("p",null,o(t(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),e("p",null,o(t(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),e("div",ks,[e("div",zs,[e("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:$.value,onClick:u},o(t(s)("Delete")),9,As)])])])])])])],8,ms)]))])]),_:1})]),_:1},8,["organization","errors"])):z("",!0)])}}});ze({admin_root:Ae,default_lang:Z.global.locale.value,only_locales:Z.global.locale.value,schema_documentation_url:Me,schema_validata_url:Ce,show_copy_resource_permalink:!0,tabular_api_url:Re,tabular_page_size:Ie,title:Se});const Cs=[{path:"/me",component:ot},{path:"/organizations/:oid",children:[{path:"datasets",component:We,props:!0,name:"organization-datasets"},{path:"reuses",component:Ge,props:!0,name:"organization-reuses"},{path:"members",component:os,props:!0,name:"organization-members"},{path:"profile",component:Ms,props:!0,name:"organization-profile"}]}],Rs=qe({history:Oe(),routes:Cs}),U=oe(Rt);Te(U);U.use(Be);U.use(Pe);U.use(Z);U.use(Rs);U.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{Is as __vite_legacy_guard};
