- set_fact:
    result_dir: "{{ evaluation_results_dir }}/{{ inventory_hostname }}/"

- name: "Ensure directory to collect artifacts exists ({{ result_dir }})"
  file:
    path: "{{ result_dir }}"
    state: directory
    mode: 0777
  delegate_to: localhost
  become: true

- name: Find all csvs 
  command: ls /tmp/flops_evaluation_runs/
  register: run_csvs

- name: "Copy all evaluation-run csv files (from '/tmp/flops_evaluation_runs/*') to localhost ({{ result_dir }})"
  fetch:
    src: "/tmp/flops_evaluation_runs/{{ item }}"
    dest: "{{ result_dir }}"
    flat: true
  loop: "{{ run_csvs.stdout_lines}}"

- name: "Copy trained-models csv files (from '/tmp/flops_trained_models.csv') to localhost ({{ result_dir }})"
  fetch:
    src: '/tmp/flops_trained_models.csv'
    dest: "{{ result_dir }}"
    flat: true
  when: is_root
