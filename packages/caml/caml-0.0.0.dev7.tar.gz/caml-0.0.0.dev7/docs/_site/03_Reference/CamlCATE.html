<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>camlcate – CaML - Causal ML</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/logo_no_text.svg" rel="icon" type="image/svg+xml">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles/styles.css">
<meta property="og:title" content="CaML - Causal ML">
<meta property="og:description" content="">
<meta property="og:site_name" content="CaML - Causal ML">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../assets/logo_no_text.svg" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">
        <li>
    <a class="dropdown-item" href="../index.html">
 <span class="dropdown-text">Welcome!</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../01_Home/installation.html">
 <span class="dropdown-text">Installation</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../01_Home/quickstart.html">
 <span class="dropdown-text">Tutorial: Quick Start</span></a>
  </li>
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-concepts" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Concepts</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-concepts">
        <li>
    <a class="dropdown-item" href="../02_Concepts/motivation.html">
 <span class="dropdown-text">Motivation</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../02_Concepts/theory.html">
 <span class="dropdown-text">Econometric Theory</span></a>
  </li>
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../03_Reference/index.html">
<span class="menu-text">API Reference</span></a>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contributors" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contributors</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contributors">
        <li>
    <a class="dropdown-item" href="../04_Contributors/environment.html">
 <span class="dropdown-text">Environment &amp; Development</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../04_Contributors/testing.html">
 <span class="dropdown-text">Testing</span></a>
  </li>
        <li>
    <a class="dropdown-item" href="../04_Contributors/documentation.html">
 <span class="dropdown-text">Documentation</span></a>
  </li>
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jakepenzak/caml">
            Source code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/jakepenzak/caml/issues/new">
            Report Issue
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>

  <ul>
  <li><a href="#caml.CamlCATE" id="toc-caml.CamlCATE" class="nav-link active" data-scroll-target="#caml.CamlCATE">CamlCATE</a>
  <ul class="collapse">
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters">Parameters</a></li>
  <li><a href="#attributes" id="toc-attributes" class="nav-link" data-scroll-target="#attributes">Attributes</a></li>
  <li><a href="#examples" id="toc-examples" class="nav-link" data-scroll-target="#examples">Examples</a></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#caml.CamlCATE.auto_nuisance_functions" id="toc-caml.CamlCATE.auto_nuisance_functions" class="nav-link" data-scroll-target="#caml.CamlCATE.auto_nuisance_functions">auto_nuisance_functions</a></li>
  <li><a href="#caml.CamlCATE.fit_final" id="toc-caml.CamlCATE.fit_final" class="nav-link" data-scroll-target="#caml.CamlCATE.fit_final">fit_final</a></li>
  <li><a href="#caml.CamlCATE.fit_validator" id="toc-caml.CamlCATE.fit_validator" class="nav-link" data-scroll-target="#caml.CamlCATE.fit_validator">fit_validator</a></li>
  <li><a href="#caml.CamlCATE.predict" id="toc-caml.CamlCATE.predict" class="nav-link" data-scroll-target="#caml.CamlCATE.predict">predict</a></li>
  <li><a href="#caml.CamlCATE.rank_order" id="toc-caml.CamlCATE.rank_order" class="nav-link" data-scroll-target="#caml.CamlCATE.rank_order">rank_order</a></li>
  <li><a href="#caml.CamlCATE.summarize" id="toc-caml.CamlCATE.summarize" class="nav-link" data-scroll-target="#caml.CamlCATE.summarize">summarize</a></li>
  <li><a href="#caml.CamlCATE.validate" id="toc-caml.CamlCATE.validate" class="nav-link" data-scroll-target="#caml.CamlCATE.validate">validate</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/jakepenzak/caml/edit/main/docs/03_Reference/CamlCATE.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jakepenzak/caml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="caml.CamlCATE" class="level1">
<h1>CamlCATE</h1>
<p><code>CamlCATE(self, df, Y, T, X, *, uuid=None, discrete_treatment=True, discrete_outcome=False, seed=None, verbose=1)</code></p>
<p>The CamlCATE class represents an opinionated implementation of Causal Machine Learning techniques for estimating highly accurate conditional average treatment effects (CATEs).</p>
<p>This class is built on top of the EconML library and provides a high-level API for fitting, validating, and making inference with CATE models, with best practices built directly into the API. The class is designed to be easy to use and understand, while still providing flexibility for advanced users. The class is designed to be used with <code>pandas</code>, <code>polars</code>, <code>pyspark</code>, or <code>ibis</code> backends to provide a level of extensibility &amp; interoperability across different data processing frameworks.</p>
<p>The primary workflow for the CamlCATE class is as follows:</p>
<ol type="1">
<li>Initialize the class with the input DataFrame and the necessary columns.</li>
<li>Utilize AutoML to find the optimal nuisance functions to be utilized in the EconML estimators.</li>
<li>Fit the CATE models on the training set and evaluate based on the validation set, then select the top performer/ensemble.</li>
<li>Validate the fitted CATE model on the test set to check for generalization performance.</li>
<li>Fit the final estimator on the entire dataset, after validation and testing.</li>
<li>Predict the CATE based on the fitted final estimator for either the internal dataframe or an out-of-sample dataframe.</li>
<li>Rank orders households based on the predicted CATE values for either the internal dataframe or an out-of-sample dataframe.</li>
<li>Summarize population summary statistics for the CATE predictions for either the internal dataframe or an out-of-sample dataframe.</li>
</ol>
<p>For technical details on conditional average treatment effects, see:</p>
<ul>
<li>CaML Documentation</li>
<li><a href="https://econml.azurewebsites.net/">EconML documentation</a></li>
</ul>
<p><strong>Note</strong>: All the standard assumptions of Causal Inference apply to this class (e.g., exogeneity/unconfoundedness, overlap, positivity, etc.). The class does not check for these assumptions and assumes that the user has already thought through these assumptions before using the class.</p>
<p><strong>Outcome &amp; Treatment Data Type Support Matrix</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Outcome</th>
<th>Treatment</th>
<th>Support</th>
<th>Missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Continuous</td>
<td>Binary</td>
<td>✅Full</td>
<td>None</td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Continuous</td>
<td>🟡Partial</td>
<td>Validation</td>
</tr>
<tr class="odd">
<td>Continuous</td>
<td>Categorical</td>
<td>✅Full</td>
<td>None</td>
</tr>
<tr class="even">
<td>Binary</td>
<td>Binary</td>
<td>❌Not yet</td>
<td></td>
</tr>
<tr class="odd">
<td>Binary</td>
<td>Continuous</td>
<td>❌Not yet</td>
<td></td>
</tr>
<tr class="even">
<td>Binary</td>
<td>Categorical</td>
<td>❌Not yet</td>
<td></td>
</tr>
<tr class="odd">
<td>Categorical</td>
<td>Binary</td>
<td>❌Not yet</td>
<td></td>
</tr>
<tr class="even">
<td>Categorical</td>
<td>Continuous</td>
<td>❌Not yet</td>
<td></td>
</tr>
<tr class="odd">
<td>Categorical</td>
<td>Categorical</td>
<td>❌Not yet</td>
<td></td>
</tr>
</tbody>
</table>
<p>Multi-dimensional outcomes and treatments are not on the roadmap yet.</p>
<section id="parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters">Parameters</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 33%">
<col style="width: 53%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>df</code></td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table</td>
<td>The input DataFrame representing the data for the CamlCATE instance.</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>Y</code></td>
<td>str</td>
<td>The str representing the column name for the outcome variable.</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>T</code></td>
<td>str</td>
<td>The str representing the column name(s) for the treatment variable(s).</td>
<td><em>required</em></td>
</tr>
<tr class="even">
<td><code>X</code></td>
<td>list[str] | str | None</td>
<td>The str (if unity) or list of feature names representing the confounder/control feature set to be utilized for estimating heterogeneity/CATE.</td>
<td><em>required</em></td>
</tr>
<tr class="odd">
<td><code>uuid</code></td>
<td>str | None</td>
<td>The str representing the column name for the universal identifier code (eg, ehhn). Default implies index for joins.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>discrete_treatment</code></td>
<td>bool</td>
<td>A boolean indicating whether the treatment is discrete/categorical or continuous.</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>discrete_outcome</code></td>
<td>bool</td>
<td>A boolean indicating whether the outcome is binary or continuous.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>seed</code></td>
<td>int | None</td>
<td>The seed to use for the random number generator.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>verbose</code></td>
<td>int</td>
<td>The verbosity level for logging. Default implies 1 (INFO). Set to 0 for no logging. Set to 2 for DEBUG.</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
</section>
<section id="attributes" class="level2">
<h2 class="anchored" data-anchor-id="attributes">Attributes</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 33%">
<col style="width: 57%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>df</td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table</td>
<td>The input DataFrame representing the data for the CamlCATE instance.</td>
</tr>
<tr class="even">
<td>Y</td>
<td>str</td>
<td>The str representing the column name for the outcome variable.</td>
</tr>
<tr class="odd">
<td>T</td>
<td>str</td>
<td>The str representing the column name(s) for the treatment variable(s).</td>
</tr>
<tr class="even">
<td>X</td>
<td>list[str] | str</td>
<td>The str (if unity) or list/tuple of feature names representing the confounder/control feature set to be utilized for estimating heterogeneity/CATE.</td>
</tr>
<tr class="odd">
<td>uuid</td>
<td>str</td>
<td>The str representing the column name for the universal identifier code (eg, ehhn)</td>
</tr>
<tr class="even">
<td>discrete_treatment</td>
<td>bool</td>
<td>A boolean indicating whether the treatment is discrete/categorical or continuous.</td>
</tr>
<tr class="odd">
<td>discrete_outcome</td>
<td>bool</td>
<td>A boolean indicating whether the outcome is binary or continuous.</td>
</tr>
<tr class="even">
<td>validation_estimator</td>
<td>econml._cate_estimator.BaseCateEstimator | econml.score.EnsembleCateEstimator</td>
<td>The fitted EconML estimator object for validation.</td>
</tr>
<tr class="odd">
<td>final_estimator</td>
<td>econml._cate_estimator.BaseCateEstimator | econml.score.EnsembleCateEstimator</td>
<td>The fitted EconML estimator object on the entire dataset after validation.</td>
</tr>
<tr class="even">
<td>dataframe</td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table</td>
<td>The input DataFrame with any modifications (e.g., predictions or rank orderings) made by the class returned to the original backend.</td>
</tr>
<tr class="odd">
<td>model_Y_X</td>
<td>sklearn.base.BaseEstimator</td>
<td>The fitted nuisance function for the outcome variable.</td>
</tr>
<tr class="even">
<td>model_Y_X_T</td>
<td>sklearn.base.BaseEstimator</td>
<td>The fitted nuisance function for the outcome variable with treatment variable.</td>
</tr>
<tr class="odd">
<td>model_T_X</td>
<td>sklearn.base.BaseEstimator</td>
<td>The fitted nuisance function for the treatment variable.</td>
</tr>
<tr class="even">
<td>_ibis_connection</td>
<td>ibis.client.Client</td>
<td>The Ibis client object representing the backend connection to Ibis.</td>
</tr>
<tr class="odd">
<td>_ibis_df</td>
<td>ibis.expr.types.Table</td>
<td>The Ibis table expression representing the DataFrame connected to Ibis.</td>
</tr>
<tr class="even">
<td>_table_name</td>
<td>str</td>
<td>The name of the temporary table/view created for the DataFrame in the backend.</td>
</tr>
<tr class="odd">
<td>_spark</td>
<td>pyspark.sql.SparkSession</td>
<td>The Spark session object if the DataFrame is a Spark DataFrame.</td>
</tr>
<tr class="even">
<td>_Y</td>
<td>ibis.expr.types.Table</td>
<td>The outcome variable data as ibis table.</td>
</tr>
<tr class="odd">
<td>_T</td>
<td>ibis.expr.types.Table</td>
<td>The treatment variable data as ibis table.</td>
</tr>
<tr class="even">
<td>_X</td>
<td>ibis.expr.types.Table</td>
<td>The feature/confounder set data as ibis table.</td>
</tr>
<tr class="odd">
<td>_X_T</td>
<td>ibis.expr.types.Table</td>
<td>The feature/confounder feature set and treatment variable data as ibis table.</td>
</tr>
<tr class="even">
<td>_nuisances_fitted</td>
<td>bool</td>
<td>A boolean indicating whether the nuisance functions have been fitted.</td>
</tr>
<tr class="odd">
<td>_validation_estimator</td>
<td>econml._cate_estimator.BaseCateEstimator | econml.score.EnsembleCateEstimator</td>
<td>The fitted EconML estimator object for validation.</td>
</tr>
<tr class="even">
<td>_final_estimator</td>
<td>econml._cate_estimator.BaseCateEstimator | econml.score.EnsembleCateEstimator</td>
<td>The fitted EconML estimator object for final predictions.</td>
</tr>
<tr class="odd">
<td>_validator_results</td>
<td>econml.validate.EvaluationResults</td>
<td>The results of the validation tests from DRTester.</td>
</tr>
<tr class="even">
<td>_cate_models</td>
<td>list[tuple[str, econml._cate_estimator.BaseCateEstimator]]</td>
<td>The list of CATE models to fit and ensemble.</td>
</tr>
<tr class="odd">
<td>_data_splits</td>
<td>dict[str, np.ndarray]</td>
<td>The dictionary containing the training, validation, and test data splits.</td>
</tr>
<tr class="even">
<td>_rscorer</td>
<td>econml.score.RScorer</td>
<td>The RScorer object for the validation estimator.</td>
</tr>
</tbody>
</table>
</section>
<section id="examples" class="level2">
<h2 class="anchored" data-anchor-id="examples">Examples</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> caml.core.cate <span class="im">import</span> CamlCATE</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="im">from</span> caml.extensions.synthetic_data <span class="im">import</span> make_fully_heterogeneous_dataset</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> df, true_cates, true_ate <span class="op">=</span> make_fully_heterogeneous_dataset(n_obs<span class="op">=</span><span class="dv">1000</span>, n_confounders<span class="op">=</span><span class="dv">10</span>, theta<span class="op">=</span><span class="dv">10</span>, seed<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> df[<span class="st">'uuid'</span>] <span class="op">=</span> df.index</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span>  caml_obj<span class="op">=</span> CamlCATE(df<span class="op">=</span>df, Y<span class="op">=</span><span class="st">"y"</span>, T<span class="op">=</span><span class="st">"d"</span>, X<span class="op">=</span>[c <span class="cf">for</span> c <span class="kw">in</span> df.columns <span class="cf">if</span> <span class="st">"X"</span> <span class="kw">in</span> c], uuid<span class="op">=</span><span class="st">"uuid"</span>, discrete_treatment<span class="op">=</span><span class="va">True</span>, discrete_outcome<span class="op">=</span><span class="va">False</span>, seed<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> <span class="co"># Standard pipeline</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.auto_nuisance_functions()</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.fit_validator()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.validate(print_full_report<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.fit_final()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.predict(join_predictions<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.rank_order(join_rank_order<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.summarize()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> end_of_pipeline_results <span class="op">=</span> caml_obj.dataframe</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> final_estimator <span class="op">=</span> caml_obj.final_estimator <span class="co"># Can be saved for future inference.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="methods" class="level2">
<h2 class="anchored" data-anchor-id="methods">Methods</h2>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><a href="#caml.CamlCATE.auto_nuisance_functions">auto_nuisance_functions</a></td>
<td>Automatically finds the optimal nuisance functions for estimating EconML estimators.</td>
</tr>
<tr class="even">
<td><a href="#caml.CamlCATE.fit_final">fit_final</a></td>
<td>Fits the final estimator on the entire dataset, after validation and testing.</td>
</tr>
<tr class="odd">
<td><a href="#caml.CamlCATE.fit_validator">fit_validator</a></td>
<td>Fits the CATE models on the training set and evaluates them &amp; ensembles based on the validation set.</td>
</tr>
<tr class="even">
<td><a href="#caml.CamlCATE.predict">predict</a></td>
<td>Predicts the CATE based on the fitted final estimator for either the internal dataframe or an out-of-sample dataframe.</td>
</tr>
<tr class="odd">
<td><a href="#caml.CamlCATE.rank_order">rank_order</a></td>
<td>Ranks orders households based on the predicted CATE values for either the internal dataframe or an out-of-sample dataframe.</td>
</tr>
<tr class="even">
<td><a href="#caml.CamlCATE.summarize">summarize</a></td>
<td>Provides population summary statistics for the CATE predictions for either the internal dataframe or an out-of-sample dataframe.</td>
</tr>
<tr class="odd">
<td><a href="#caml.CamlCATE.validate">validate</a></td>
<td>Validates the fitted CATE models on the test set to check for generalization performance. Uses the DRTester class from EconML to obtain the Best</td>
</tr>
</tbody>
</table>
<section id="caml.CamlCATE.auto_nuisance_functions" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.auto_nuisance_functions">auto_nuisance_functions</h3>
<p><code>CamlCATE.auto_nuisance_functions(flaml_Y_kwargs=None, flaml_T_kwargs=None, use_ray=False, use_spark=False)</code></p>
<p>Automatically finds the optimal nuisance functions for estimating EconML estimators.</p>
<p>Sets the <code>model_Y_X</code>, <code>model_Y_X_T</code>, and <code>model_T_X</code> internal attributes to the fitted nuisance functions.</p>
<section id="parameters-1" class="level4">
<h4 class="anchored" data-anchor-id="parameters-1">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 74%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>flaml_Y_kwargs</code></td>
<td>dict | None</td>
<td>The keyword arguments for the FLAML AutoML search for the outcome model. Default implies the base parameters in CamlBase.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>flaml_T_kwargs</code></td>
<td>dict | None</td>
<td>The keyword arguments for the FLAML AutoML search for the treatment model. Default implies the base parameters in CamlBase.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>use_ray</code></td>
<td>bool</td>
<td>A boolean indicating whether to use Ray for parallel processing.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>use_spark</code></td>
<td>bool</td>
<td>A boolean indicating whether to use Spark for parallel processing.</td>
<td><code>False</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples-1" class="level4">
<h4 class="anchored" data-anchor-id="examples-1">Examples</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> flaml_Y_kwargs <span class="op">=</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"n_jobs"</span>: <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"time_budget"</span>: <span class="dv">300</span>, <span class="co"># in seconds</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>...     }</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> flaml_T_kwargs <span class="op">=</span> {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"n_jobs"</span>: <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"time_budget"</span>: <span class="dv">300</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>...     }</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.auto_nuisance_functions(flaml_Y_kwargs<span class="op">=</span>flaml_Y_kwargs, flaml_T_kwargs<span class="op">=</span>flaml_T_kwargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.fit_final" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.fit_final">fit_final</h3>
<p><code>CamlCATE.fit_final()</code></p>
<p>Fits the final estimator on the entire dataset, after validation and testing.</p>
<p>Sets the <code>_final_estimator</code> internal attribute to the fitted EconML estimator.</p>
<section id="examples-2" class="level4">
<h4 class="anchored" data-anchor-id="examples-2">Examples</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.fit_final() <span class="co"># Fits the final estimator on the entire dataset.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.fit_validator" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.fit_validator">fit_validator</h3>
<p><code>CamlCATE.fit_validator(subset_cate_models=['LinearDML', 'NonParamDML', 'DML-Lasso3d', 'CausalForestDML', 'XLearner', 'DomainAdaptationLearner', 'SLearner', 'TLearner', 'DRLearner', 'LinearDRLearner', 'ForestDRLearner'], additional_cate_models=[], rscorer_kwargs={}, use_ray=False, ray_remote_func_options_kwargs={})</code></p>
<p>Fits the CATE models on the training set and evaluates them &amp; ensembles based on the validation set.</p>
<p>Sets the <code>_validation_estimator</code> and <code>_rscorer</code> internal attributes to the fitted EconML estimator and RScorer object.</p>
<section id="parameters-2" class="level4">
<h4 class="anchored" data-anchor-id="parameters-2">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 28%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>subset_cate_models</code></td>
<td>list[str]</td>
<td>The list of CATE models to fit and ensemble. Default implies all available models as defined by class.</td>
<td><code>['LinearDML', 'NonParamDML', 'DML-Lasso3d', 'CausalForestDML', 'XLearner', 'DomainAdaptationLearner', 'SLearner', 'TLearner', 'DRLearner', 'LinearDRLearner', 'ForestDRLearner']</code></td>
</tr>
<tr class="even">
<td><code>additional_cate_models</code></td>
<td>list[tuple[str, BaseCateEstimator]]</td>
<td>The list of additional CATE models to fit and ensemble</td>
<td><code>[]</code></td>
</tr>
<tr class="odd">
<td><code>rscorer_kwargs</code></td>
<td>dict</td>
<td>The keyword arguments for the econml.score.RScorer object.</td>
<td><code>{}</code></td>
</tr>
<tr class="even">
<td><code>use_ray</code></td>
<td>bool</td>
<td>A boolean indicating whether to use Ray for parallel processing.</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>ray_remote_func_options_kwargs</code></td>
<td>dict</td>
<td>The keyword arguments for the Ray remote function options.</td>
<td><code>{}</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples-3" class="level4">
<h4 class="anchored" data-anchor-id="examples-3">Examples</h4>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> rscorer_kwargs <span class="op">=</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"cv"</span>: <span class="dv">3</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>...     <span class="st">"mc_iters"</span>: <span class="dv">3</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>...     }</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> subset_cate_models <span class="op">=</span> [<span class="st">"LinearDML"</span>, <span class="st">"NonParamDML"</span>, <span class="st">"DML-Lasso3d"</span>, <span class="st">"CausalForestDML"</span>]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> additional_cate_models <span class="op">=</span> [(<span class="st">"XLearner"</span>, XLearner(models<span class="op">=</span>caml_obj._model_Y_X_T, cate_models<span class="op">=</span>caml_obj._model_Y_X_T, propensity_model<span class="op">=</span>caml._model_T_X))]</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.fit_validator(subset_cate_models<span class="op">=</span>subset_cate_models, additional_cate_models<span class="op">=</span>additional_cate_models, rscorer_kwargs<span class="op">=</span>rscorer_kwargs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.predict" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.predict">predict</h3>
<p><code>CamlCATE.predict(out_of_sample_df=None, out_of_sample_uuid=None, return_predictions=False, join_predictions=True, T0=0, T1=1)</code></p>
<p>Predicts the CATE based on the fitted final estimator for either the internal dataframe or an out-of-sample dataframe.</p>
<p>For binary treatments, the CATE is the estimated effect of the treatment and for a continuous treatment, the CATE is the estimated effect of a one-unit increase in the treatment. This can be modified by setting the T0 and T1 parameters to the desired treatment levels.</p>
<section id="parameters-3" class="level4">
<h4 class="anchored" data-anchor-id="parameters-3">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 9%">
<col style="width: 41%">
<col style="width: 43%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>out_of_sample_df</code></td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table | None</td>
<td>The out-of-sample DataFrame to make predictions on.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>out_of_sample_uuid</code></td>
<td>str | None</td>
<td>The column name for the universal identifier code (eg, ehhn) in the out-of-sample DataFrame.</td>
<td><code>None</code></td>
</tr>
<tr class="odd">
<td><code>return_predictions</code></td>
<td>bool</td>
<td>A boolean indicating whether to return the predicted CATE.</td>
<td><code>False</code></td>
</tr>
<tr class="even">
<td><code>join_predictions</code></td>
<td>bool</td>
<td>A boolean indicating whether to join the predicted CATE to the original DataFrame within the class.</td>
<td><code>True</code></td>
</tr>
<tr class="odd">
<td><code>T0</code></td>
<td>int</td>
<td>Base treatment for each sample.</td>
<td><code>0</code></td>
</tr>
<tr class="even">
<td><code>T1</code></td>
<td>int</td>
<td>Target treatment for each sample.</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns" class="level4">
<h4 class="anchored" data-anchor-id="returns">Returns</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 72%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>np.ndarray | DataFrame</td>
<td>The predicted CATE values if return_predictions is set to True.</td>
</tr>
</tbody>
</table>
</section>
<section id="examples-4" class="level4">
<h4 class="anchored" data-anchor-id="examples-4">Examples</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml.predict(join_predictions<span class="op">=</span><span class="va">True</span>) <span class="co"># Joins the predicted CATE values to the original DataFrame.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml.dataframe <span class="co"># Returns the DataFrame to original backend with the predicted CATE values joined.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.rank_order" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.rank_order">rank_order</h3>
<p><code>CamlCATE.rank_order(out_of_sample_df=None, return_rank_order=False, join_rank_order=True, treatment_category=1)</code></p>
<p>Ranks orders households based on the predicted CATE values for either the internal dataframe or an out-of-sample dataframe.</p>
<section id="parameters-4" class="level4">
<h4 class="anchored" data-anchor-id="parameters-4">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 35%">
<col style="width: 51%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>out_of_sample_df</code></td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table | None</td>
<td>The out-of-sample DataFrame to rank order.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>return_rank_order</code></td>
<td>bool</td>
<td>A boolean indicating whether to return the rank ordering.</td>
<td><code>False</code></td>
</tr>
<tr class="odd">
<td><code>join_rank_order</code></td>
<td>bool</td>
<td>A boolean indicating whether to join the rank ordering to the original DataFrame within the class.</td>
<td><code>True</code></td>
</tr>
<tr class="even">
<td><code>treatment_category</code></td>
<td>int</td>
<td>The treatment category, in the case of categorical treatments, to rank order the households based on. Default implies the first category.</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-1" class="level4">
<h4 class="anchored" data-anchor-id="returns-1">Returns</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 71%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>np.ndarray | DataFrame</td>
<td>The rank ordering values if return_rank_order is set to True.</td>
</tr>
</tbody>
</table>
</section>
<section id="examples-5" class="level4">
<h4 class="anchored" data-anchor-id="examples-5">Examples</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml.rank_order(join_rank_order<span class="op">=</span><span class="va">True</span>) <span class="co"># Joins the rank ordering to the original DataFrame.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml.dataframe <span class="co"># Returns the DataFrame to original backend with the rank ordering values joined.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.summarize" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.summarize">summarize</h3>
<p><code>CamlCATE.summarize(out_of_sample_df=None, treatment_category=1)</code></p>
<p>Provides population summary statistics for the CATE predictions for either the internal dataframe or an out-of-sample dataframe.</p>
<section id="parameters-5" class="level4">
<h4 class="anchored" data-anchor-id="parameters-5">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 36%">
<col style="width: 51%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>out_of_sample_df</code></td>
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table | None</td>
<td>The out-of-sample DataFrame to summarize.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>treatment_category</code></td>
<td>int</td>
<td>The treatment level, in the case of categorical treatments, to summarize the CATE predictions for. Default implies the first category.</td>
<td><code>1</code></td>
</tr>
</tbody>
</table>
</section>
<section id="returns-2" class="level4">
<h4 class="anchored" data-anchor-id="returns-2">Returns</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 63%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>pandas.DataFrame | polars.DataFrame | pyspark.sql.DataFrame | ibis.expr.types.Table</td>
<td>The summary statistics for the CATE predictions.</td>
</tr>
</tbody>
</table>
</section>
<section id="examples-6" class="level4">
<h4 class="anchored" data-anchor-id="examples-6">Examples</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml.summarize() <span class="co"># Summarizes the CATE predictions for the internal DataFrame.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="caml.CamlCATE.validate" class="level3">
<h3 class="anchored" data-anchor-id="caml.CamlCATE.validate">validate</h3>
<p><code>CamlCATE.validate(estimator=None, print_full_report=True)</code></p>
<p>Validates the fitted CATE models on the test set to check for generalization performance. Uses the DRTester class from EconML to obtain the Best Linear Predictor (BLP), Calibration, AUTOC, and QINI. See <a href="https://econml.azurewebsites.net/_autosummary/econml.validate.DRTester.html">EconML documentation</a> for more details. In short, we are checking for the ability of the model to find statistically significant heterogeneity in a “well-calibrated” fashion.</p>
<p>Sets the <code>_validator_results</code> internal attribute to the results of the DRTester class.</p>
<section id="parameters-6" class="level4">
<h4 class="anchored" data-anchor-id="parameters-6">Parameters</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 30%">
<col style="width: 51%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>estimator</code></td>
<td>BaseCateEstimator | EnsembleCateEstimator | None</td>
<td>The estimator to validate. Default implies the best estimator from the validation set.</td>
<td><code>None</code></td>
</tr>
<tr class="even">
<td><code>print_full_report</code></td>
<td>bool</td>
<td>A boolean indicating whether to print the full validation report.</td>
<td><code>True</code></td>
</tr>
</tbody>
</table>
</section>
<section id="examples-7" class="level4">
<h4 class="anchored" data-anchor-id="examples-7">Examples</h4>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;&gt;&gt;</span> caml_obj.validate(print_full_report<span class="op">=</span><span class="va">True</span>) <span class="co"># Prints the full validation report.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


</section>
</section>
</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button,
        { trigger: "manual",
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config);
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined;
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            }
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          }
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Jacob Pieniazek</p>
</div>
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/jakepenzak/caml/edit/main/docs/03_Reference/CamlCATE.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/jakepenzak/caml/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Powered by: <a href="https://quarto.org/"><img src="../assets/external_logos/quarto.png" class="img-fluid" width="85"></a></p>
</div>
  </div>
</footer>




</body></html>
