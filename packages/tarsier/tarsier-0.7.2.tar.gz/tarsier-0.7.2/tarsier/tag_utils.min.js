"use strict";const tarsierId="__tarsier_id",tarsierDataAttribute="data-tarsier-id",tarsierSelector=`#${tarsierId}`,reworkdVisibilityAttribute="reworkd-original-visibility",elIsVisible=t=>{const n=t.getBoundingClientRect(),e=window.getComputedStyle(t),o=e.visibility==="hidden"||e.display==="none"||t.hidden||t.hasAttribute("disabled")&&t.getAttribute("disabled"),r=e.opacity==="0"&&!hasLabel(t),i=e.display==="contents",a=(n.width===0||n.height===0)&&!i,l=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!o&&!r&&!a&&!l};function hasLabel(t){if(!["input","textarea","select","button"].includes(t.tagName.toLowerCase()))return!1;const e=CSS.escape(t.id);if(document.querySelector(`label[for="${e}"]`))return!0;const s=Array.from(t.parentElement?.children||[]);for(let r of s)if(r.tagName.toLowerCase()==="label")return!0;return!1}const isTaggableTextNode=t=>isNonWhiteSpaceTextNode(t)&&isTextNodeAValidWord(t),isNonWhiteSpaceTextNode=t=>t.nodeType===Node.TEXT_NODE&&t.textContent&&t.textContent.trim().length>0&&t.textContent.trim()!=="\u200B",isTextNodeAValidWord=t=>{const n=t.textContent?.trim();return n&&(n.match(/\w/)||n.length>3)},isImageElement=t=>t.tagName.toLowerCase()==="img",inputs=["a","button","textarea","select","details","label"],isInteractable=t=>t.tagName.toLowerCase()==="label"&&t.querySelector("input")?!1:inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),textLessTagWhiteList=["input","textarea","select","button","a"],isTextLess=t=>{const n=t.tagName.toLowerCase();if(textLessTagWhiteList.includes(n)||t.childElementCount>0)return!1;if("innerText"in t&&t.innerText.trim().length===0){const e=t.querySelector("svg"),o=t.querySelector("img");return e||o?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const n=t.getBoundingClientRect(),e=n.width>1||n.height>1;let o=document.body,s=document.documentElement;const r=Math.max(o.scrollHeight,o.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight),i=Math.max(o.scrollWidth,o.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth);return e&&n.top>=0&&n.left>=0&&n.bottom<=r&&n.right<=i}function getElementXPath(t){let n=[],e="";for(t&&t.ownerDocument!==window.document&&(e=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let o=t.tagName.toLowerCase(),s=window.fixNamespaces(o),r=1,i=t.previousElementSibling;for(;i;)i.tagName===t.tagName&&i.id!=tarsierId&&r++,i=i.previousElementSibling;let a=t.nextElementSibling,l=!1;for(;a;){if(a.tagName===t.tagName){l=!0;break}a=a.nextElementSibling}if((r>1||l)&&(s+=`[${r}]`),t.id){if(s+=`[@id="${t.id}"]`,n.length>3)return n.unshift(s),"//"+n.join("/")}else t.className&&(s+=`[@class="${t.className}"]`);n.unshift(s),t=t.parentNode}return e+"//"+n.join("/")}function create_tagged_span(t,n){let e;isInteractable(n)?isTextInsertable(n)?e=`[#${t}]`:n.tagName.toLowerCase()=="a"?e=`[@${t}]`:e=`[$${t}]`:isImageElement(n)?e=`[%${t}]`:e=`[${t}]`;let o=document.createElement("span");return o.id=tarsierId,o.style.position="relative",o.style.display="inline",o.style.color="white",o.style.backgroundColor="red",o.style.padding="1.5px",o.style.borderRadius="3px",o.style.fontWeight="bold",o.style.fontFamily="Arial",o.style.margin="1px",o.style.lineHeight="1.25",o.style.letterSpacing="2px",o.style.zIndex="2140000046",o.style.clip="auto",o.style.height="fit-content",o.style.width="fit-content",o.style.minHeight="15px",o.style.minWidth="23px",o.style.maxHeight="unset",o.style.maxWidth="unset",o.textContent=e,o.style.webkitTextFillColor="white",o.style.textShadow="",o.style.textDecoration="none",o.style.letterSpacing="0px",o.setAttribute(tarsierDataAttribute,t.toString()),o}const MIN_FONT_SIZE=11,ensureMinimumTagFontSizes=()=>{Array.from(document.querySelectorAll(tarsierSelector)).forEach(n=>{parseFloat(window.getComputedStyle(n).fontSize.split("px")[0])<MIN_FONT_SIZE&&(n.style.fontSize=`${MIN_FONT_SIZE}px`)})};window.tagifyWebpage=(t=!1)=>{window.removeTags(),hideMapElements();const n=getAllElementsInAllFrames(),e=getElementsToTag(n,t),o=removeNestedTags(e),s=insertTags(o,t);return shrinkCollidingTags(),ensureMinimumTagFontSizes(),Object.entries(s).reduce((r,[i,a])=>(r[parseInt(i)]=a.xpath,r),{})};function getAllElementsInAllFrames(){const t=Array.from(document.body.querySelectorAll("*")),n=document.getElementsByTagName("iframe");for(let e=0;e<n.length;e++)try{const o=n[e],s=o.contentDocument||o.contentWindow?.document;if(!s)continue;const r=Array.from(s.querySelectorAll("*"));r.forEach(i=>i.setAttribute("iframe_index",e.toString())),t.push(...r)}catch(o){console.error("Error accessing iframe content:",o)}return t}function getElementsToTag(t,n){const e=[];for(let o of t)isTextLess(o)&&!isImageElement(o)||!elIsVisible(o)||(isInteractable(o)||isImageElement(o)||n&&Array.from(o.childNodes).filter(isTaggableTextNode).length>=1)&&e.push(o);return e}function removeNestedTags(t){const n=[...t];return t.map(e=>{if(isInteractable(e)){const o=[];if(e.querySelectorAll("*").forEach(s=>{n.indexOf(s)>-1&&o.push(s)}),o.length<=2)for(let s of o)n.splice(n.indexOf(s),1)}}),n}function insertTags(t,n){function e(i){if(!i.firstChild||i.firstChild.nodeType!==Node.TEXT_NODE)return;const a=i.firstChild;a.textContent=a.textContent.trimStart()}function o(i,a){const l=Array.from(i.childNodes).filter(c=>isNonWhiteSpaceTextNode(c)?!0:c.nodeType===Node.TEXT_NODE?!1:!(c.nodeType===Node.ELEMENT_NODE&&(isTextLess(c)||!elIsVisible(c))));if(l.length===1){const c=l[0],d=["div","span","p","h1","h2","h3","h4","h5","h6"];if(c.nodeType===Node.ELEMENT_NODE&&d.includes(c.tagName.toLowerCase()))return o(c,a)}return e(i),i}const s={};let r=0;for(let i of t)if(s[r]={xpath:getElementXPath(i)},isInteractable(i)){const a=create_tagged_span(r,i);if(isTextInsertable(i)&&i.parentElement)i.parentElement.insertBefore(a,i);else{const l=o(i,a);l.prepend(a),absolutelyPositionTagIfMisaligned(a,l)}r++}else if(isImageElement(i)){const a=create_tagged_span(r,i);i.parentElement&&(i.parentElement.insertBefore(a,i),absolutelyPositionTagIfMisaligned(a,i)),r++}else if(n){e(i);const a=Array.from(i.childNodes).filter(isTaggableTextNode),l=Array.from(i.childNodes).filter(c=>c.nodeType===Node.TEXT_NODE);for(let c of a){const d=getElementXPath(i),g=l.indexOf(c)+1;s[r]={xpath:d,textNodeIndex:g};const p=create_tagged_span(r,i);i.insertBefore(p,c),r++}}return s}function absolutelyPositionTagIfMisaligned(t,n){let e=t.getBoundingClientRect();if(!(e.width===0||e.height===0))return;const o=250,s=n.getBoundingClientRect();if(s.right<0||s.left>(window.innerWidth||document.documentElement.clientWidth)){t.remove();return}const r={x:s.left,y:s.top},i={x:(e.left+e.right)/2,y:(e.top+e.bottom)/2},a=Math.abs(r.x-i.x),l=Math.abs(r.y-i.y);if(a>o||l>o||!elIsVisible(t)){t.style.position="absolute";let c=Math.max(0,s.left-(e.right+3-e.left));c=Math.min(c,window.innerWidth-(e.right-e.left));let d=Math.max(0,s.top+3);d=Math.min(d,Math.max(window.innerHeight,document.documentElement.scrollHeight)-(e.bottom-e.top)),t.style.left=`${c}px`,t.style.top=`${d}px`,t.parentElement&&t.parentElement.removeChild(t),document.body.appendChild(t)}}const shrinkCollidingTags=()=>{const t=Array.from(document.querySelectorAll(tarsierSelector));for(let n=0;n<t.length;n++){const e=t[n];let o=e.getBoundingClientRect(),s=parseFloat(window.getComputedStyle(e).fontSize.split("px")[0]);for(let r=n+1;r<t.length;r++){const i=t[r];let a=i.getBoundingClientRect(),l=parseFloat(window.getComputedStyle(i).fontSize.split("px")[0]);for(;o.left<a.right&&o.right>a.left&&o.top<a.bottom&&o.bottom>a.top&&s>MIN_FONT_SIZE&&l>MIN_FONT_SIZE;)s-=.5,l-=.5,e.style.fontSize=`${s}px`,i.style.fontSize=`${l}px`,o=e.getBoundingClientRect(),a=i.getBoundingClientRect()}}};window.removeTags=()=>{getAllElementsInAllFrames().filter(t=>t.matches(tarsierSelector)).forEach(t=>t.remove()),showMapElements()};const GOOGLE_MAPS_OPACITY_CONTROL="__reworkd_google_maps_opacity",hideMapElements=()=>{const t=['iframe[src*="google.com/maps"]','iframe[id*="gmap_canvas"]',".maplibregl-map",".mapboxgl-map",".leaflet-container",'img[src*="maps.googleapis.com"]','[aria-label="Map"]',".cmp-location-map__map",'.map-view[data-role="mapView"]',".google_Map-wrapper",".google_map-wrapper",".googleMap-wrapper",".googlemap-wrapper",".ls-map-canvas",".gmapcluster","#googleMap","#googleMaps","#googlemaps","#googlemap","#google_map","#google_maps","#MapId",".geolocation-map-wrapper",".locatorMap"];document.querySelectorAll(t.join(", ")).forEach(n=>{const e=window.getComputedStyle(n).opacity;n.setAttribute("data-original-opacity",e),n.style.opacity="0"})},showMapElements=()=>{document.querySelectorAll(`[${GOOGLE_MAPS_OPACITY_CONTROL}]`).forEach(n=>{n.style.opacity=n.getAttribute("data-original-opacity")||"1"})};window.hideNonTagElements=()=>{getAllElementsInAllFrames().forEach(n=>{const e=n;e.style.visibility&&e.setAttribute(reworkdVisibilityAttribute,e.style.visibility),e.id.startsWith(tarsierId)?e.style.visibility="visible":e.style.visibility="hidden"})},window.fixNamespaces=t=>{const n=/^[a-zA-Z_][\w\-.]*:[a-zA-Z_][\w\-.]*$/,e=t.split(/[#.]/)[0];return n.test(e)?t.replace(e,`*[name()="${e}"]`):t},window.revertVisibilities=()=>{getAllElementsInAllFrames().forEach(n=>{const e=n;e.getAttribute(reworkdVisibilityAttribute)?e.style.visibility=e.getAttribute(reworkdVisibilityAttribute)||"true":e.style.removeProperty("visibility")})};
