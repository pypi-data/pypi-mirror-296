{"version":3,"file":"mod-ajax-dev.js","names":["$","MyAMS","checkCsrfHeader","request","window","Cookies","token","get","config","csrfCookieName","setRequestHeader","csrfHeaderName","ajax","_exports","check","checker","source","Promise","resolve","reject","deferred","undefined","Array","src","push","core","getScript","forEach","elt","idx","when","apply","then","length","getAddr","addr","href","attr","location","substring","lastIndexOf","start","show","stop","hide","progress","event","lengthComputable","loaded","total","console","debug","Math","round","url","params","options","startsWith","protocol","defaults","type","cache","data","param","dataType","beforeSend","settings","extend","result","status","xhr","error","post","getJSON","handleJSON","getResponse","contentType","getResponseHeader","responseXML","e","responseText","responseJSON","JSON","parse","alert","title","i18n","ERROR_OCCURED","content","NO_SERVER_RESPONSE","form","target","closeForm","require","resetChanged","modal","close","loadTarget","promises","jQuery","showErrors","open","hash","skin","loadURL","preLoadCallback","getFunctionByName","preReload","each","index","element","executeFunctionByName","preLoadCallbackOptions","preReloadOptions","afterLoadCallback","postReload","afterLoadCallbackOptions","postReloadOptions","endsWith","replace","off","reload","code","showHTTPError","warn","container","html","text","initContent","document","keepHidden","removeClass","contents","message","smallBox","icon","timeout","parent","header","subtitle","messagebox","messageBox","smallbox","trigger","eventOptions","events","callback","callbacks","module","all","response","statusText","toUpperCase","x_ams_handled","parsedResponse","jest","env","baseURL","extext","ajaxSettings","ajaxSetup","safeMethods","indexOf","progressUpload","addEventListener","evt","ajaxStart","ajaxStop","ajaxError","bundle","modules"],"sources":["mod-ajax.js"],"sourcesContent":["/* global jQuery, MyAMS, Cookies */\n/**\n * MyAMS AJAX features\n */\n\nconst $ = MyAMS.$;\n\n\n/**\n * CSRF cookie checker\n *\n * Automatically set CSRF request header when CSRF cookie was specified.\n *\n * @param request: outgoing request\n */\nfunction checkCsrfHeader(request /*, options */) {\n\tif (window.Cookies) {\n\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\tif (token) {\n\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t}\n\t}\n}\n\n\nexport const ajax = {\n\n\t/**\n\t * Check for a given feature, and download script if necessary\n\t *\n\t * @param checker: pointer to a resource which will be downloaded if undefined\n\t * @param source: URL of a javascript file containing requested resource\n\t */\n\tcheck: (checker, source) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tconst deferred = [];\n\n\t\t\tif (checker === undefined) {\n\t\t\t\tif (!(source instanceof Array)) {\n\t\t\t\t\tsource = [source];\n\t\t\t\t}\n\t\t\t\tfor (const src of source) {\n\t\t\t\t\tdeferred.push(MyAMS.core.getScript(src));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!(checker instanceof Array)) {\n\t\t\t\t\tchecker = [checker];\n\t\t\t\t}\n\t\t\t\tchecker.forEach((elt, idx) => {\n\t\t\t\t\tif (elt === undefined) {\n\t\t\t\t\t\tdeferred.push(MyAMS.core.getScript(source[idx]));\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t$.when.apply($, deferred).then(() => {\n\t\t\t\tresolve(deferred.length > 0);\n\t\t\t}, reject);\n\t\t});\n\t},\n\n\t/**\n\t * Get AJAX URL relative to current page\n\t *\n\t * @param addr\n\t */\n\tgetAddr: (addr) => {\n\t\tconst href = addr || $('html head base').attr('href') || window.location.href;\n\t\treturn href.substring(0, href.lastIndexOf('/') + 1);\n\t},\n\n\t/**\n\t * JQuery AJAX start callback\n\t */\n\tstart: () => {\n\t\t$('#ajax-gear').show();\n\t},\n\n\t/**\n\t * JQuery AJAX stop callback\n\t */\n\tstop: () => {\n\t\t$('#ajax-gear').hide();\n\t},\n\n\t/**\n\t * Handle AJAX upload or download progress event\n\t *\n\t * @param event: source event\n\t */\n\tprogress: (event) => {\n\t\tif (!event.lengthComputable) {\n\t\t\treturn;\n\t\t}\n\t\tif (event.loaded >= event.total) {\n\t\t\treturn;\n\t\t}\n\t\tif (console) {\n\t\t\tconsole.debug && console.debug(`${Math.round(event.loaded / event.total * 100)}%`);\n\t\t}\n\t},\n\n\t/**\n\t * Get data from given URL.\n\t * This is a simple wrapper around JQuery AJAX api to keep MyAMS API consistent\n\t *\n\t * @param url: target URL\n\t * @param params: url params\n\t * @param options: AJAX call options\n\t */\n\tget: (url, params, options) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'get',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(params || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL\n\t *\n\t * @param url: target URL\n\t * @param data: submit data\n\t * @param options: AJAX call options\n\t */\n\tpost: (url, data, options) => {\n\n\t\treturn new Promise((resolve, reject) => {\n\n\t\t\tlet addr;\n\t\t\tif (url.startsWith(window.location.protocol)) {\n\t\t\t\taddr = url;\n\t\t\t} else {\n\t\t\t\taddr = MyAMS.ajax.getAddr() + url;\n\t\t\t}\n\n\t\t\tconst defaults = {\n\t\t\t\turl: addr,\n\t\t\t\ttype: 'post',\n\t\t\t\tcache: false,\n\t\t\t\tdata: $.param(data || null),\n\t\t\t\tdataType: 'json',\n\t\t\t\tbeforeSend: checkCsrfHeader\n\t\t\t};\n\t\t\tconst settings = $.extend({}, defaults, options);\n\t\t\t$.ajax(settings).then((result, status, xhr) => {\n\t\t\t\tresolve(result, status, xhr);\n\t\t\t}, (xhr, status, error) => {\n\t\t\t\treject(error);\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Post data to given URL and handle result as JSON\n\t *\n\t * This form of function can be used in MyAMS \"href\" or \"data-ams-url\" attributes, like in\n\t * <a href=\"MyAMS.ajax.getJSON?url=...\">Click me!</a>.\n\t */\n\tgetJSON: () => {\n\t\treturn (source, options) => {\n\t\t\tconst url = options.url;\n\t\t\tdelete options.url;\n\t\t\treturn MyAMS.ajax.post(url, options).then(MyAMS.ajax.handleJSON);\n\t\t}\n\t},\n\n\t/**\n\t * Extract datatype and result from response object\n\t */\n\tgetResponse: (request) => {\n\t\tlet dataType = 'unknown',\n\t\t\tresult;\n\t\tif (request) {\n\t\t\tlet contentType = request.getResponseHeader('content-type');\n\t\t\tif (!contentType) {\n\t\t\t\ttry {\n\t\t\t\t\tcontentType = request.responseXML.contentType;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tcontentType = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (contentType) {\n\t\t\t\t// Get server response\n\t\t\t\tif (contentType.startsWith('application/javascript')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'script';\n\t\t\t\t} else if (contentType.startsWith('text/html')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'html';\n\t\t\t\t} else if (contentType.startsWith('text/xml')) {\n\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\tdataType = 'xml';\n\t\t\t\t} else {\n\t\t\t\t\t// Supposed to be JSON...\n\t\t\t\t\tresult = request.responseJSON;\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = JSON.parse(request.responseText);\n\t\t\t\t\t\t\tdataType = 'json';\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tresult = request.responseText;\n\t\t\t\t\t\t\tdataType = 'binary';\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Probably no response from server...\n\t\t\t\tresult = {\n\t\t\t\t\tstatus: 'alert',\n\t\t\t\t\talert: {\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: MyAMS.i18n.NO_SERVER_RESPONSE\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdataType = 'json';\n\t\t\t}\n\t\t}\n\t\treturn {\n\t\t\tcontentType: dataType,\n\t\t\tdata: result\n\t\t}\n\t},\n\n\t/**\n\t * Handle a server response in JSON format\n\t *\n\t * Result can be an object with several attributes:\n\t *  - main response status: alert, error, info, success, callback, callbacks, reload or\n\t *    redirect\n\t *  - close_form: boolean indicating if current modal should be closed\n\t *  - location: target URL for reload or redirect status\n\t *  - target: target container selector for loaded content ('#content' by default)\n\t *  - content: available for any status producing output; can be raw HTML, or an object\n\t *    with attributes:\n\t *      - target: target container selector (source form by default)\n\t *      - text or html: raw text or HTML result\n\t *  - message: available for any status producing an output message; an object with\n\t *    attributes:\n\t *      - status: message status\n\t *      -\n\t * @param result: response content\n\t * @param form: source form\n\t * @param target\n\t */\n\thandleJSON: (result, form, target) => {\n\n\t\tfunction closeForm() {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tif (form !== undefined) {\n\t\t\t\t\tMyAMS.require('form').then(() => {\n\t\t\t\t\t\tMyAMS.form.resetChanged(form);\n\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\tif (result.closeForm !== false) {\n\t\t\t\t\t\t\tMyAMS.require('modal').then(() => {\n\t\t\t\t\t\t\t\tMyAMS.modal.close(form);\n\t\t\t\t\t\t\t}).then(resolve, reject);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tresolve();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tlet url = null,\n\t\t\tloadTarget = null;\n\t\tconst\n\t\t\tstatus = result.status,\n\t\t\tpromises = [];\n\n\t\tif ((target instanceof jQuery) && !target.length) {\n\t\t\ttarget = null;\n\t\t}\n\n\t\tswitch (status) {\n\n\t\t\tcase 'alert':\n\t\t\t\tif (window.alert) {\n\t\t\t\t\tconst alert = result.alert;\n\t\t\t\t\twindow.alert(`${alert.title}\\n\\n${alert.content}`);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'error':\n\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\tMyAMS.error.showErrors(form, result);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'message':\n\t\t\tcase 'messagebox':\n\t\t\tcase 'smallbox':\n\t\t\t\tbreak;\n\n\t\t\tcase 'info':\n\t\t\tcase 'success':\n\t\t\tcase 'notify':\n\t\t\tcase 'callback':\n\t\t\tcase 'callbacks':\n\t\t\t\tpromises.push(closeForm());\n\t\t\t\tbreak;\n\n\t\t\tcase 'modal':\n\t\t\t\tpromises.push(MyAMS.require('modal').then(() => {\n\t\t\t\t\tMyAMS.modal.open(result.location);\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'reload':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.hash;\n\t\t\t\tif (url.startsWith('#')) {\n\t\t\t\t\turl = url.substring(1);\n\t\t\t\t}\n\t\t\t\tloadTarget = $(result.target || target || '#content');\n\t\t\t\tpromises.push(MyAMS.require('skin').then(() => {\n\t\t\t\t\tMyAMS.skin.loadURL(url, loadTarget, {\n\t\t\t\t\t\tpreLoadCallback: MyAMS.core.getFunctionByName(result.preReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-pre-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-pre-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tpreLoadCallbackOptions: result.preReloadOptions,\n\t\t\t\t\t\tafterLoadCallback: MyAMS.core.getFunctionByName(result.postReload || function() {\n\t\t\t\t\t\t\t$('[data-ams-post-reload]', loadTarget).each((index, element) => {\n\t\t\t\t\t\t\t\tMyAMS.core.executeFunctionByName($(element).data('ams-post-reload'));\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tafterLoadCallbackOptions: result.postReloadOptions\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t\tbreak;\n\n\t\t\tcase 'redirect':\n\t\t\t\tcloseForm();\n\t\t\t\turl = result.location || window.location.href;\n\t\t\t\tif (url.endsWith('##')) {\n\t\t\t\t\turl = url.replace(/##/, window.location.hash);\n\t\t\t\t}\n\t\t\t\tif (result.window) {\n\t\t\t\t\twindow.open(url, result.window, result.options);\n\t\t\t\t} else {\n\t\t\t\t\t$(window).off('beforeunload');\n\t\t\t\t\tif (window.location.href === url) {\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t} else {\n\t\t\t\t\t\twindow.location.replace(url);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tif (result.code) {  // Standard HTTP error?\n\t\t\t\t\tpromises.push(MyAMS.require('error').then(() => {\n\t\t\t\t\t\tMyAMS.error.showHTTPError(result);\n\t\t\t\t\t}));\n\t\t\t\t} else {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.warn && console.warn(`Unhandled JSON response status: ${status}`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t}\n\n\t\t// Single content response\n\t\tif (result.content) {\n\t\t\tconst\n\t\t\t\tcontent = result.content,\n\t\t\t\tcontainer = $(content.target || target || '#content');\n\t\t\tif (typeof content === 'string') {\n\t\t\t\tcontainer.html(content);\n\t\t\t} else {\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text);\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Multiple contents response\n\t\tif (result.contents) {\n\t\t\tfor (const content of result.contents) {\n\t\t\t\tconst container = $(content.target);\n\t\t\t\tif (content.text) {\n\t\t\t\t\tcontainer.text(content.text)\n\t\t\t\t} else {\n\t\t\t\t\tcontainer.html(content.html);\n\t\t\t\t}\n\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(MyAMS.config.initContent,\n\t\t\t\t\tdocument, container).then(() => {\n\t\t\t\t\tif (!content.keepHidden) {\n\t\t\t\t\t\tcontainer.removeClass('hidden');\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\t// Response with message\n\t\tif (result.message && !result.code) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.message === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.message,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.message;\n\t\t\t\t\tMyAMS.alert.alert({\n\t\t\t\t\t\tparent: form,\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\theader: message.header,\n\t\t\t\t\t\tsubtitle: message.subtitle,\n\t\t\t\t\t\tmessage: message.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with message box\n\t\tif (result.messagebox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.messagebox === 'string') {\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\tmessage: result.messagebox,\n\t\t\t\t\t\ttimeout: 10000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.messagebox;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\ttitle: message.title || MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ttimeout: message.timeout === 0 ? 0 : (message.timeout || 10000)\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with small box\n\t\tif (result.smallbox) {\n\t\t\tpromises.push(MyAMS.require('alert').then(() => {\n\t\t\t\tif (typeof result.smallbox === 'string') {\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: status,\n\t\t\t\t\t\tmessage: result.smallbox,\n\t\t\t\t\t\ticon: 'fa-info-circle',\n\t\t\t\t\t\ttimeout: 3000\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst message = result.smallbox;\n\t\t\t\t\tMyAMS.alert.smallBox({\n\t\t\t\t\t\tstatus: message.status || status,\n\t\t\t\t\t\tmessage: message.message,\n\t\t\t\t\t\tcontent: message.content,\n\t\t\t\t\t\ticon: message.icon || 'fa-info-circle',\n\t\t\t\t\t\ttimeout: message.timeout\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\n\t\t// Response with single event\n\t\tif (result.event) {\n\t\t\tform.trigger(result.event, result.eventOptions);\n\t\t}\n\n\t\t// Response with multiple events\n\t\tif (result.events) {\n\t\t\tfor (const event of result.events) {\n\t\t\t\tif (typeof event === 'string') {\n\t\t\t\t\tform.trigger(event, result.eventOptions);\n\t\t\t\t} else {\n\t\t\t\t\tform.trigger(event.event, event.options);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Response with single callback\n\t\tif (result.callback) {\n\t\t\tpromises.push(MyAMS.core.executeFunctionByName(result.callback, document, form,\n\t\t\t\tresult.options));\n\t\t}\n\n\t\t// Response with multiple callbacks\n\t\tif (result.callbacks) {\n\t\t\tfor (const callback of result.callbacks) {\n\t\t\t\tif (typeof callback === 'string') {\n\t\t\t\t\tpromises.push(MyAMS.core.executeFunctionByName(callback, document, form,\n\t\t\t\t\t\tresult.options));\n\t\t\t\t} else {\n\t\t\t\t\tpromises.push(MyAMS.require(callback.module || []).then(() => {\n\t\t\t\t\t\tMyAMS.core.executeFunctionByName(callback.callback, document,\n\t\t\t\t\t\t\tform, callback.options)\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(promises);\n\t},\n\n\t/**\n\t * JQuery AJAX error handler\n\t */\n\terror: (event, response, request, error) => {\n\t\t// user shouldn't be notified of aborted requests\n\t\tif (error === 'abort') {\n\t\t\treturn;\n\t\t}\n\t\t// don't display errors on OK status\n\t\tif (response && response.statusText && response.statusText.toUpperCase() === 'OK') {\n\t\t\treturn;\n\t\t}\n\t\t// don't display errors twice (via AJAX HTTP error handler and JSON response)\n\t\tif (response.x_ams_handled === true) {\n\t\t\treturn;\n\t\t}\n\t\tconst parsedResponse = MyAMS.ajax.getResponse(response);\n\t\tif (parsedResponse) {\n\t\t\tif (parsedResponse.contentType === 'json') {\n\t\t\t\tMyAMS.ajax.handleJSON(parsedResponse.data);\n\t\t\t\tresponse.x_ams_handled = true;\n\t\t\t} else {\n\t\t\t\tMyAMS.require('i18n', 'alert').then(() => {\n\t\t\t\t\tconst\n\t\t\t\t\t\ttitle = error || event.statusText || event.type,\n\t\t\t\t\t\tmessage = parsedResponse.responseText;\n\t\t\t\t\tMyAMS.alert.messageBox({\n\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\ttitle: MyAMS.i18n.ERROR_OCCURED,\n\t\t\t\t\t\tcontent: `<h4>${title}</h4><p>${message || ''}</p>`,\n\t\t\t\t\t\ticon: 'fa-exclamation-triangle',\n\t\t\t\t\t\ttimeout: 5000\n\t\t\t\t\t});\n\t\t\t\t}, () => {\n\t\t\t\t\tif (window.console) {\n\t\t\t\t\t\tconsole.error && console.error(event);\n\t\t\t\t\t\tconsole.debug && console.debug(parsedResponse);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} else {\n\t\t\tif (window.console) {\n\t\t\t\tconsole.error && console.error(\"ERROR: Can't parse response!\");\n\t\t\t\tconsole.debug && console.debug(response);\n\t\t\t}\n\t\t}\n\t}\n};\n\n\n/**\n * AJAX events callbacks\n */\nif (typeof jest === 'undefined') {\n\t// don't check cookies extension in test mode!\n\tajax.check(window.Cookies, `${MyAMS.env.baseURL}../ext/js-cookie${MyAMS.env.extext}.js`)\n\t\t.then(() => {\n\t\t\tconst xhr = $.ajaxSettings.xhr;\n\t\t\t$.ajaxSetup({\n\t\t\t\tbeforeSend: (request, options) => {\n\t\t\t\t\tif (MyAMS.config.safeMethods.indexOf(options.type) < 0) {\n\t\t\t\t\t\tif (window.Cookies !== undefined) {\n\t\t\t\t\t\t\tconst token = Cookies.get(MyAMS.config.csrfCookieName);\n\t\t\t\t\t\t\tif (token) {\n\t\t\t\t\t\t\t\trequest.setRequestHeader(MyAMS.config.csrfHeaderName, token);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tprogress: ajax.progress,\n\t\t\t\tprogressUpload: ajax.progress,\n\t\t\t\txhr: function() {\n\t\t\t\t\tconst request = xhr();\n\t\t\t\t\tif (request && (typeof request.addEventListener === 'function')) {\n\t\t\t\t\t\tif (ajax.progress) {\n\t\t\t\t\t\t\trequest.addEventListener('progress', (evt) => {\n\t\t\t\t\t\t\t\tMyAMS.ajax.progress(evt);\n\t\t\t\t\t\t\t}, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn request;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n}\n\n$(document).ajaxStart(ajax.start);\n$(document).ajaxStop(ajax.stop);\n$(document).ajaxError(ajax.error);\n\n\n/**\n * Global module initialization\n */\nif (MyAMS.env.bundle) {\n\tMyAMS.config.modules.push('ajax');\n} else {\n\tMyAMS.ajax = ajax;\n\tconsole.debug(\"MyAMS: AJAX module loaded...\");\n}\n"],"mappings":"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"}