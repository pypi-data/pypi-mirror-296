"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[268],{47176:function(e,n,t){var a=t(26068),s=t.n(a),r=t(48305),l=t.n(r),i=t(84353),o=t(6434),c=t(32382),u=t(18953),d=t(64518),m=t(66551),p=t(99013),f=t.n(p),h=t(50959),v=t(11527);n.Z=function(e){var n=e.text,t=e.disabled,a=e.type,r=void 0===a?"text":a,p=e.shape,g=void 0===p?"circle":p,x=e.fontSize,j=void 0===x?"14px":x,y=e.style,b=e.size,Z=void 0===b?"middle":b,S=(0,c.useIntl)(),w=(0,h.useState)(!1),k=l()(w,2),C=k[0],N=k[1],T=(0,h.useRef)(null),M=(0,h.useRef)(null);return(0,h.useEffect)((function(){return T.current&&(M.current=new(f())(T.current),M.current.on("success",(function(){N(!0),setTimeout((function(){N(!1)}),3e3)})),M.current.on("error",(function(e){u.ZP.success(S.formatMessage({id:"common.copy.fail"})),e.clearSelection()}))),function(){var e;null===(e=M.current)||void 0===e||e.destroy()}}),[T]),(0,v.jsx)(d.Z,{title:S.formatMessage({id:"common.button.copy"}),children:(0,v.jsx)(m.ZP,{className:"copy-button",ref:T,type:r,shape:g,size:Z,disabled:!!t,"data-clipboard-text":n,icon:C?(0,v.jsx)(i.Z,{style:{color:"var(--ant-color-success)",fontSize:j}}):(0,v.jsx)(o.Z,{style:s()({fontSize:j},y)})})})}},73907:function(e,n,t){var a=(0,t(79107).Z)({scriptUrl:"//at.alicdn.com/t/c/font_4613488_3n3aubqzylv.js"});n.Z=a},94886:function(e,n,t){var a=t(26068),s=t.n(a),r=t(48305),l=t.n(r),i=t(67825),o=t.n(i),c=t(34088),u=t(79698),d=t(19392),m=t(50959),p=t(37975),f=t(11527),h=["label","placeholder","children","required","description","isInFormItems"];n.Z=function(e){var n=e.label,t=e.placeholder,a=e.children,r=e.required,i=e.description,v=e.isInFormItems,g=void 0===v||v,x=o()(e,h),j=(0,m.useState)(!1),y=l()(j,2),b=y[0],Z=y[1],S=(0,m.useRef)(null),w="";if(g){var k,C,N=null===u.Z||void 0===u.Z||null===(k=u.Z.Item)||void 0===k||null===(C=k.useStatus)||void 0===C?void 0:C.call(k);w=(null==N?void 0:N.status)||""}(0,m.useEffect)((function(){(0,c.JL)(e.value)&&Z(!0)}),[e.value]);return(0,f.jsx)(p.Z,{status:w,label:n||t,isFocus:b,required:r,description:i,disabled:e.disabled,onClick:function(){var n,t;e.disabled||b||(null===(n=S.current)||void 0===n||null===(t=n.focus)||void 0===t||t.call(n),Z(!0))},children:(0,f.jsx)(d.default,s()(s()({},x),{},{ref:S,onFocus:function(n){var t;Z(!0),null===(t=e.onFocus)||void 0===t||t.call(e,n)},onBlur:function(n){var t;e.value||Z(!1),null===(t=e.onBlur)||void 0===t||t.call(e,n)},onChange:function(n,t){var a;(0,c.JL)(n)?Z(!0):Z(!1),null===(a=e.onChange)||void 0===a||a.call(e,n,t)},notFoundContent:null,children:a}))})}},43463:function(e,n,t){t.d(n,{d4:function(){return i}});var a=t(48305),s=t.n(a),r=(0,t(34088).oc)(),l={CREATE:["alt+ctrl+N","alt+meta+N"],CLEAR:["alt+ctrl+W","alt+meta+W"],RIGHT:["ctrl+RIGHT","meta+RIGHT"],SAVE:["ctrl+S","meta+S"],SUBMIT:["ctrl+enter","meta+enter"],SAVEAS:["alt+ctrl+S","alt+meta+S"],OPEN:["alt+ctrl+O","alt+meta+O"],CANCEL:["ctrl+W","meta+W"],DELETE:["delete"],COPY:["ctrl+C","meta+C"],REFRESH:["ctrl+R","meta+R"],EDIT:["ctrl+E","meta+E"],SEARCH:["ctrl+K","meta+K"],RESET:["alt+ctrl+R","alt+meta+R"],INPUT:["ctrl+K","meta+K"],NEW1:["ctrl+1","meta+1"],NEW2:["ctrl+2","meta+2"]},i=Object.entries(l).map((function(e){var n=s()(e,2),t=n[0],a=n[1],l=r.isMac&&a[1]||a[0];return{keybinding:l,command:t,textKeybinding:r.isMac?l.replace("meta","Command").replace("alt","Option"):l.replace("ctrl","Ctrl"),iconKeybinding:r.isMac?l.replace("meta","⌘").replace("alt","⌥"):l.replace("ctrl","Ctrl")}})).reduce((function(e,n){return e[n.command]=n,e}),{});n.ZP=l},73083:function(e,n,t){t.d(n,{d:function(){return a}});var a={default:500,large:600,small:400,mini:300}},76398:function(e,n,t){t.d(n,{Z:function(){return Z}});var a=t(26068),s=t.n(a),r=t(15558),l=t.n(r),i=t(48305),o=t.n(i),c=t(19392),u=t(50959),d=t(47176),m=t(11527),p=function(e){var n=e.header,t=e.children,a=e.copyText,s=e.langOptions,r=e.onChangeLang,l=e.defaultValue,i=e.showHeader,o=void 0===i||i,u=function(e){null==r||r(e)};return(0,m.jsxs)("div",{className:"editor-wrap",children:[n?(0,m.jsx)("div",{className:"editor-header",children:n}):o?(0,m.jsxs)("div",{className:"editor-header",children:[(0,m.jsx)(c.default,{defaultValue:l,style:{width:120},size:"middle",variant:"filled",options:s,onChange:u}),(0,m.jsx)(d.Z,{text:a,size:"small",style:{color:"rgba(255,255,255,.7)"}})]}):null,(0,m.jsx)("div",{className:"editor-content",children:t})]})},f=u.memo(p),h=t(24770),v=t(59874),g=t(32382),x=t(48157),j=t(66551),y=t(32699),b=t.n(y),Z=function(e){var n=e||{},t=n.title,a=n.open,r=n.onCancel,i=n.systemMessage,c=n.messageList,d=n.parameters,p=void 0===d?{}:d,y=n.apiType,Z=void 0===y?"chat":y,S=(0,g.useIntl)(),w=(0,u.useRef)(null),k=(0,u.useState)(!1),C=o()(k,2),N=C[0],T=C[1],M=(0,u.useState)(""),I=o()(M,2),R=I[0],_=I[1],P=(0,u.useState)("shell"),E=o()(P,2),F=E[0],A=E[1],O="".concat(window.location.origin,"/v1-openai"),z="chat"===Z?"chat.completions":"embeddings",U="chat"===Z?"chat/completions":"embeddings",V="chat"===Z?"choices[0].message.content":"data[0].embedding",H=function(){if("shell"===F){var e=[].concat(i?[{role:"system",content:i}]:[],l()(b().map(c,(function(e){return{role:e.role,content:e.content}})))),n="curl ".concat(window.location.origin,"/v1-openai/").concat(U,' \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${YOUR_GPUSTACK_API_KEY}" \\\n-d \'').concat(JSON.stringify(s()(s()({},p),e.length>0?{messages:e}:{}),null,2),"'");_(n)}else if("javascript"===F){var t=[].concat(i?[{role:"system",content:i}]:[],l()(b().map(c,(function(e){return{role:e.role,content:e.content}})))),a='const OpenAI = require("openai");\n\nconst openai = new OpenAI({\n  "apiKey": "YOUR_GPUSTACK_API_KEY",\n  "baseURL": "'.concat(O,'"\n});\n\nasync function main(){\n  const params = ').concat(JSON.stringify(s()(s()({},p),t.length>0?{messages:t}:{}),null,4),";\nconst response = await openai.").concat(z,".create(params);\n  console.log(response.").concat(V,");\n}\nmain();");_(a)}else if("python"===F){var r=b().keys(p).reduce((function(e,n){if(null===p[n])return e;var t="string"==typeof p[n]?'"'.concat(p[n],'"'):p[n];return e+"  ".concat(n,"=").concat(t,",\n")}),""),o=i?[{role:"system",content:i}]:[],u="chat"===Z?"messages=".concat(JSON.stringify([].concat(o,l()(b().map(c,(function(e){return{role:e.role,content:e.content}})))),null,2)):"",d='from openai import OpenAI\n\nclient = OpenAI(\n  base_url="'.concat(O,'", \n  api_key="YOUR_GPUSTACK_API_KEY"\n)\n\nresponse = client.').concat(z,".create(\n").concat(r,"  ").concat(u,")\nprint(response.").concat(V,")");_(d)}w.current&&setTimeout((function(){var e,n;null===(e=w.current)||void 0===e||null===(n=e.getAction)||void 0===n||null===(n=n.call(e,"editor.action.formatDocument"))||void 0===n||n.run().then((function(){}))}),100)};return(0,u.useEffect)((function(){H()}),[F,i,c,p]),(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(x.Z,{title:t,open:a,centered:!0,onCancel:function(){A("shell"),r()},destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,footer:null,children:[(0,m.jsx)("div",{style:{marginBottom:"10px"},children:S.formatMessage({id:"playground.viewcode.info"})}),(0,m.jsxs)("div",{children:[(0,m.jsx)(f,{copyText:R,langOptions:[{label:"Curl",value:"shell"},{label:"Python",value:"python"},{label:"Nodejs",value:"javascript"}],defaultValue:"shell",showHeader:N,onChangeLang:function(e){A(e)},children:(0,m.jsx)(v.ZP,{height:380,theme:"vs-dark",className:"monaco-editor",defaultLanguage:"shell",language:F,value:R,options:{minimap:{enabled:!1},hover:{enabled:!1},readOnly:!0,formatOnType:!0,formatOnPaste:!0,fontWeight:"bold",scrollbar:{verticalSliderSize:8}},beforeMount:function(e){e.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1,diagnosticCodesToIgnore:[80001]})},onMount:function(e,n){w.current=e,T(!0)}})}),(0,m.jsxs)("div",{style:{marginTop:10,display:"flex",alignItems:"baseline"},children:[(0,m.jsx)(h.Z,{className:"m-r-8"}),(0,m.jsx)("span",{children:S.formatMessage({id:"playground.viewcode.tips"},{here:(0,m.jsx)(j.ZP,{type:"link",size:"small",href:"#/api-keys",target:"_blank",style:{paddingInline:2},children:(0,m.jsxs)("span",{children:[" ",S.formatMessage({id:"playground.viewcode.here"})]})})})})]})]})]})})}},24139:function(e,n,t){t.r(n),t.d(n,{default:function(){return ve}});var a=t(48305),s=t.n(a),r=t(73907),l=t(43463),i=t(67399),o=t(32382),c=t(81126),u=t(66551),d=t(35623),m=t(82187),p=t.n(m),f=t(50959),h=t(94299),v=t(90228),g=t.n(v),x=t(87999),j=t.n(x),y=t(26068),b=t.n(y),Z=t(15558),S=t.n(Z),w=t(11527),k=(0,f.forwardRef)((function(e,n){var t=e.minHeight,a=void 0===t?50:t,r=e.header,l=e.variant,i=void 0===l?"bordered":l,o=e.children,c=e.setCollapsed,u=(0,f.useState)(!0),d=s()(u,2),m=d[0],h=d[1],v=(0,f.useState)(0),g=s()(v,2),x=g[0],j=g[1],y=(0,f.useRef)(null);(0,f.useEffect)((function(){var e;m?j((null==y||null===(e=y.current)||void 0===e?void 0:e.scrollHeight)||0):j(0)}),[m]);var b=function(){var e;j((null==y||null===(e=y.current)||void 0===e?void 0:e.scrollHeight)||0)};return(0,f.useImperativeHandle)(n,(function(){return{setHeightByContent:b}})),(0,w.jsxs)("div",{className:p()("transition-wrapper",{bordered:"bordered"===i,filled:"filled"===i}),children:[(0,w.jsx)("div",{onClick:function(){h(!m),null==c||c(!m)},className:"header",style:{height:a},children:r}),(0,w.jsx)("div",{className:"transition-content-wrapper",style:{minHeight:m?x:0,height:m?"auto":0,padding:m?"8px":"0 8px"},ref:y,children:(0,w.jsx)("div",{className:"transition-content",children:o})})]})})),C=t(32699),N=t.n(C);var T=t(28791),M=function(e){var n,t=/data:\s*({.*?})(?=\n|$)/g,a=[];if(!e)return a;for(;null!==(n=t.exec(e));)try{a.push(JSON.parse(n[1]))}catch(e){continue}return a},I=function(){var e=j()(g()().mark((function e(n){var t,a,s,r,l,i;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.method||"POST",s=n.url,n.params&&(s="".concat(s,"?").concat(T.Z.stringify(n.params))),e.next=5,fetch(s,{method:a,body:"POST"===a?JSON.stringify(n.data):null,signal:n.signal,headers:{"Content-Type":"application/json"}});case 5:if((r=e.sent).ok){e.next=9;break}throw new Error("Network response was not ok");case 9:return l=null==r||null===(t=r.body)||void 0===t?void 0:t.getReader(),i=new TextDecoder("utf-8"),e.abrupt("return",{reader:l,decoder:i});case 12:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),R=function(){var e=j()(g()().mark((function e(n,t,a){var s,r,l,i;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.read();case 2:if(s=e.sent,r=s.done,l=s.value,!r){e.next=8;break}return e.abrupt("return");case 8:return i=t.decode(l,{stream:!0}),M(i).forEach((function(e){null==a||a(e)})),e.next=13,R(n,t,a);case 13:case"end":return e.stop()}}),e)})));return function(n,t,a){return e.apply(this,arguments)}}(),_=t(25633),P=t(8274),E=t(64518),F=t(2300),A=t(4542),O="/v1-openai/chat/completions";var z=function(){var e=j()(g()().mark((function e(n){return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,o.request)("".concat("/v1-openai/models"),{method:"GET",params:n}));case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),U={User:"user",Assistant:"assistant",System:"system"},V=(U.User,U.Assistant,t(34088)),H=t(10822),B=t(26657),D=t(34828),q=t(65863),L=t(80613),K=function(e){var n=(0,V.oc)(),t=(0,o.useIntl)(),a=e.onSubmit,s=e.onClear,i=e.onStop,d=e.onNewMessage,m=(e.onView,e.feedback),p=e.disabled,f=e.hasTokenResult,v=e.selectedModel;(0,h.y1)(l.ZP.SUBMIT.join(","),(function(){a()}),{enabled:!p});U.User,t.formatMessage({id:"playground.user"}),U.Assistant,t.formatMessage({id:"playground.assistant"});return(0,w.jsx)("div",{className:"chat-footer",children:(0,w.jsxs)(q.Z,{style:{width:"100%"},children:[(0,w.jsx)(L.Z,{lg:f?8:12,xs:24,sm:24,md:24,children:(0,w.jsxs)(c.Z,{size:20,children:[(0,w.jsx)(u.ZP,{disabled:p,icon:(0,w.jsx)(H.Z,{}),onClick:d,children:t.formatMessage({id:"playground.newMessage"})}),(0,w.jsx)(u.ZP,{icon:(0,w.jsx)(B.Z,{}),onClick:s,disabled:p,children:t.formatMessage({id:"common.button.clear"})})]})}),(0,w.jsx)(L.Z,{lg:f?8:0,xs:f?24:0,sm:f?24:0,md:f?24:0,children:m}),(0,w.jsx)(L.Z,{lg:f?8:12,xs:24,sm:24,md:24,style:{textAlign:"right"},children:(0,w.jsx)(c.Z,{size:20,children:p?(0,w.jsx)(u.ZP,{type:"primary",onClick:i,icon:(0,w.jsx)(r.Z,{type:"icon-stop1"}),children:(0,w.jsx)("span",{children:t.formatMessage({id:"common.button.stop"})})}):(0,w.jsxs)(u.ZP,{type:"primary",disabled:p||!v,onClick:a,children:[t.formatMessage({id:"common.button.submit"}),(0,w.jsx)("span",{className:"m-l-5 opct-7",children:n.isMac?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(r.Z,{type:"icon-command"})," +"," ",(0,w.jsx)(D.Z,{})]}):(0,w.jsxs)(w.Fragment,{children:["CTRL + ",(0,w.jsx)(D.Z,{})]})})]})})})]})})},W=t(47176),G=t(92420),Y=t(67577),J=function(e){var n=e.dataList,t=e.onDelete;return(0,w.jsx)(c.Z,{wrap:!0,size:10,className:"thumb-list-wrap",children:N().map(n,(function(e){return(0,w.jsxs)("span",{className:"thumb-img",children:[(0,w.jsx)("span",{style:{backgroundImage:"url(".concat(e.dataUrl,")")},className:"img"}),(0,w.jsx)("span",{className:"del",onClick:function(){return n=e.uid,void t(n);var n},children:(0,w.jsx)(Y.Z,{})})]},e.uid)}))})},$=function(e){var n=e.message,t=e.isFocus,a=e.onDelete,r=e.updateMessage,i=e.onSubmit,d=e.loading,m=(0,o.useIntl)(),p=(0,f.useState)(!1),v=s()(p,2),x=(v[0],v[1],(0,f.useState)(!1)),y=s()(x,2),b=(y[0],y[1],(0,f.useState)(t)),Z=s()(b,2),k=Z[0],C=Z[1],T=(0,f.useState)([]),M=s()(T,2),I=M[0],R=M[1],_=(0,f.useRef)(0),P=(0,f.useRef)(null);(0,f.useEffect)((function(){P.current&&t&&P.current.focus()}),[t]);var A=function(e){r({role:e.role,content:e.message,uid:n.uid})},O=((0,f.useCallback)(function(){var e=j()(g()().mark((function e(n){var t,a,s,r,l,i,o;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.clipboardData||window.clipboardData,a=t.items,s=[],r=g()().mark((function e(){var n,t,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"file"===(n=a[l]).kind&&-1!==n.type.indexOf("image")?(t=n.getAsFile(),r=new Promise((function(e,n){var a=new FileReader;a.onload=function(t){var a,s=null===(a=t.target)||void 0===a?void 0:a.result;s?e(s):n("Failed to convert image to base64")},a.readAsDataURL(t)})),s.push(r)):n.kind;case 3:case"end":return e.stop()}}),e)})),l=0;case 5:if(!(l<a.length)){e.next=10;break}return e.delegateYield(r(),"t0",7);case 7:l++,e.next=5;break;case 10:return e.prev=10,e.next=13,Promise.all(s);case 13:(i=e.sent).length&&(o=N().map(i,(function(e){return _.current+=1,{uid:_.current,dataUrl:e}})),R((function(e){return[].concat(S()(e),S()(o))}))),e.next=20;break;case 17:e.prev=17,e.t1=e.catch(10);case 20:case"end":return e.stop()}}),e,null,[[10,17]])})));return function(n){return e.apply(this,arguments)}}(),[]),(0,f.useCallback)((function(e){var n=I.filter((function(n){return n.uid!==e}));R(n)}),[I]));return(0,h.y1)(l.ZP.SUBMIT,(function(){P.current.blur(),i()}),{enabled:k,enableOnFormTags:k,preventDefault:!0}),(0,w.jsxs)("div",{className:"message-item",children:[(0,w.jsx)("div",{className:"role-type",children:(0,w.jsx)(u.ZP,{onClick:function(){var e=n.role===U.User?U.Assistant:U.User;A({role:e,message:n.content})},type:"text",children:m.formatMessage({id:"playground.".concat(n.role)})})}),(0,w.jsxs)("div",{className:"message-content-input",children:[(0,w.jsx)(J,{dataList:I,onDelete:O}),(0,w.jsx)(F.Z.TextArea,{ref:P,style:{paddingBlock:"12px"},value:n.content,autoSize:!0,variant:"filled",readOnly:d,onChange:function(e){A({role:n.role,message:e.target.value})},onFocus:function(){C(!0)},onBlur:function(){C(!1)}})]}),(0,w.jsx)("div",{className:"delete-btn",children:(0,w.jsxs)(c.Z,{size:5,children:[n.content&&(0,w.jsx)(W.Z,{text:n.content,size:"small",shape:"default",type:"default",fontSize:"12px"}),(0,w.jsx)(E.Z,{title:m.formatMessage({id:"common.button.delete"}),children:(0,w.jsx)(u.ZP,{size:"small",onClick:function(){a()},icon:(0,w.jsx)(G.Z,{})})})]})})]})},Q=function(e){var n=(0,o.useIntl)(),t=e.usage;return t?(0,w.jsxs)("div",{className:"reference-params",children:[(0,w.jsx)("span",{className:"usage",children:(0,w.jsx)(E.Z,{title:(0,w.jsxs)(c.Z,{children:[(0,w.jsxs)("span",{children:[n.formatMessage({id:"playground.completion"}),":"," ",t.completion_tokens]}),(0,w.jsxs)("span",{children:[n.formatMessage({id:"playground.prompt"}),":"," ",t.prompt_tokens]})]}),children:(0,w.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenusage"}),":"," ",t.total_tokens]})})}),(0,w.jsx)("span",{className:"usage",children:(0,w.jsx)(E.Z,{title:(0,w.jsxs)(c.Z,{children:[(0,w.jsxs)("span",{children:["TPOT: ",N().round(t.time_per_output_token_ms,2)," ms"]}),(0,w.jsxs)("span",{children:["TTFT: ",N().round(t.time_to_first_token_ms,2)," ms"]})]}),children:(0,w.jsxs)("span",{children:[n.formatMessage({id:"playground.tokenoutput"}),":"," ",N().round(t.tokens_per_second,2)," Tokens/s"]})})})]}):null},X=t(76398),ee=(0,f.forwardRef)((function(e,n){var t=e.parameters,a=(0,f.useRef)(0),r=(0,f.useState)([{role:"user",content:"",uid:a.current}]),i=s()(r,2),c=i[0],d=i[1],m=(0,o.useIntl)(),p=(0,f.useState)(""),v=s()(p,2),x=v[0],y=v[1],Z=(0,f.useState)(!0),C=s()(Z,2),T=C[0],M=C[1],z=(0,f.useState)(!1),V=s()(z,2),H=V[0],B=V[1],D=(0,f.useState)(!1),q=s()(D,2),L=q[0],W=q[1],G=(0,f.useState)(-1),Y=s()(G,2),J=Y[0],ee=Y[1],ne=(0,f.useState)(null),te=s()(ne,2),ae=te[0],se=te[1],re=(0,f.useState)(!1),le=s()(re,2),ie=le[0],oe=le[1],ce=(0,f.useRef)(null),ue=(0,f.useRef)(""),de=(0,f.useRef)(null),me=(0,f.useRef)(null),pe=function(e,n){var t=(0,f.useRef)(!1),a=(0,f.useRef)(e),s=(0,f.useRef)(n),r=(0,f.useRef)(null==n?void 0:n.toBottom),l=((0,f.useRef)(null),N().debounce((function(){t.current=!1}),5e3)),i=function e(){var n,l,i,o=(null===(n=a.current)||void 0===n?void 0:n.current)||{},c=o.scrollHeight,u=o.clientHeight,d=o.scrollTop;null!==(l=s.current)&&void 0!==l&&l.toBottom&&r.current&&c>u+d?(a.current.current.scrollTop=c,t.current=!1):!t.current&&c>u+d&&null!==(i=a.current)&&void 0!==i&&i.current&&(a.current.current.scrollTop+=10,window.requestAnimationFrame(e))};return{handleContentWheel:function(e){var n;t.current=!0,null===(n=l.cancel)||void 0===n||n.call(l),l()},updateScrollerPosition:function(){t.current||window.requestAnimationFrame(i)},scroller:a}}(me,{toBottom:!0}),fe=pe.updateScrollerPosition,he=pe.handleContentWheel;(0,f.useEffect)((function(){fe()}),[c]),(0,f.useImperativeHandle)(n,(function(){return{viewCode:function(){B(!0)}}}));var ve=function(){a.current=a.current+1},ge=function(e){var n;c.push({role:(null===(n=N().last(c))||void 0===n?void 0:n.role)===U.User?U.Assistant:U.User,content:"",uid:a.current+1}),ve(),d(S()(c)),ee(c.length-1)},xe=function(e){e&&(N().get(e,"choices.0.finish_reason")?se(b()({},null==e?void 0:e.usage)):(ue.current=ue.current+N().get(e,"choices.0.delta.content",""),d([].concat(S()(c),[{role:U.Assistant,content:ue.current,uid:a.current}]))))},je=function(){var e=j()(g()().mark((function e(){var n,a,s,r,l,i,o,u;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.model){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,W(!0),ve(),se(null),null===(n=de.current)||void 0===n||null===(a=n.abort)||void 0===a||a.call(n),de.current=new AbortController,s=de.current.signal,r=N().map(c,(function(e){return{role:e.role,content:e.content}})),ue.current="",l=b()(b()({messages:x?[{role:U.System,content:x}].concat(S()(r)):S()(r)},t),{},{stream:!0}),e.next=14,I({data:l,url:O,signal:s});case 14:if(i=e.sent){e.next=17;break}return e.abrupt("return");case 17:return o=i.reader,u=i.decoder,e.next=20,R(o,u,(function(e){xe(e)}));case 20:W(!1),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(2),W(!1);case 27:case"end":return e.stop()}}),e,null,[[2,23]])})));return function(){return e.apply(this,arguments)}}(),ye=function(){c.length&&(ve(),d([{role:U.User,content:"",uid:a.current}]))},be=function(){je()};return(0,h.y1)(l.ZP.SUBMIT,(function(){be()}),{enabled:ie&&!L,enableOnFormTags:ie&&!L,preventDefault:!0}),(0,h.y1)(l.ZP.CREATE.join(","),(function(){ge()}),{enabled:!L,enableOnFormTags:!L,preventDefault:!0}),(0,h.y1)(l.ZP.CLEAR.join(","),(function(){ye()}),{enabled:!L,enableOnFormTags:!L,preventDefault:!0}),(0,w.jsxs)("div",{className:"ground-left",children:[(0,w.jsxs)("div",{className:"message-list-wrap",ref:me,onWheel:he,children:[(0,w.jsx)("div",{style:{marginBottom:40},children:(0,w.jsx)(k,{header:(0,w.jsxs)("div",{className:"system-message-wrap ",children:[(0,w.jsx)("span",{className:"title",children:m.formatMessage({id:"playground.system"})}),(0,w.jsx)(E.Z,{title:T?m.formatMessage({id:"common.button.collapse"}):m.formatMessage({id:"common.button.expand"}),children:(0,w.jsx)(u.ZP,{size:"small",children:T?(0,w.jsx)(_.Z,{}):(0,w.jsx)(P.Z,{})})})]}),variant:"filled",setCollapsed:M,ref:ce,children:(0,w.jsx)(F.Z.TextArea,{value:x,variant:"filled",autoSize:!0,onFocus:function(){oe(!0)},onBlur:function(){oe(!1)},style:{minHeight:40},placeholder:m.formatMessage({id:"playground.system.tips"}),onChange:function(e){y(e.target.value)}})})}),(0,w.jsxs)("div",{children:[c.map((function(e,n){return(0,w.jsx)($,{isFocus:n===J,islast:n===c.length-1,loading:L,onDelete:function(){return function(e){c.splice(e,1),d(S()(c))}(n)},updateMessage:function(e){return function(e,n){c[e]=n,d(S()(c))}(n,e)},onSubmit:be,message:e},e.uid)})),L&&(0,w.jsx)(A.Z,{children:(0,w.jsx)("div",{style:{height:"46px"}})})]})]}),(0,w.jsx)("div",{className:"ground-left-footer",children:(0,w.jsx)(K,{onClear:ye,onNewMessage:ge,onSubmit:be,onView:function(){B(!0)},onStop:function(){var e,n;null===(e=de.current)||void 0===e||null===(n=e.abort)||void 0===n||n.call(e),W(!1)},disabled:L,selectedModel:t.model,hasTokenResult:!!ae,feedback:(0,w.jsx)(Q,{usage:ae})})}),(0,w.jsx)(X.Z,{open:H,systemMessage:x,messageList:c,parameters:t,onCancel:function(){B(!1)},title:m.formatMessage({id:"playground.viewcode"})})]})})),ne=ee,te=t(82092),ae=t.n(te),se=t(6451),re=t(63109),le=function(e){var n=e.children,t=e.label,a=e.status,s=e.className,r=e.disabled,l=e.required,i=e.variant,o=e.style,c=e.description;return(0,w.jsxs)("div",{style:b()({},o),className:p()(re.Z.wrapper,re.Z["validate-status-".concat(a)],r?re.Z["seal-input-wrapper-disabled"]:"","filled"===i?re.Z.filled:"","borderless"===i?re.Z.borderless:"",s?re.Z[s]:""),children:[(0,w.jsx)("label",{className:p()(re.Z.label,re.Z["isfoucs-has-value"]),children:(0,w.jsx)(se.Z,{label:t,required:l,description:c})}),(0,w.jsx)("div",{style:{padding:"0 calc(var(--ant-padding-sm) - 5px)",width:"100%"},children:n})]})},ie=t(99494),oe=t(94886),ce=t(73083),ue=t(56280),de=t(79698),me=t(30629),pe=t(55915),fe="label___Im6e1",he=function(e){var n=e.selectedModel,t=e.setParams,a=(0,o.useIntl)(),r=(0,f.useState)([]),l=s()(r,2),i=l[0],c=l[1],u={seed:null,stop:null,temperature:1,top_p:1,max_tokens:1024},d=de.Z.useForm(),m=s()(d,1)[0];(0,f.useEffect)((function(){var e=function(){var e=j()(g()().mark((function e(){var a,s,r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={embedding_only:!1},e.next=4,z(a);case 4:s=e.sent,r=N().map(s.data||[],(function(e){return{value:e.id,label:e.id}})),c(r),m.setFieldsValue(b()({model:n||N().get(r,"[0].value")},u)),t(b()({model:n||N().get(r,"[0].value")},u)),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(0),c([]),m.setFieldsValue(b()({model:n||""},u)),t(b()({model:n||""},u));case 16:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();e()}),[]);var p=function(e,n){var a=m.getFieldsValue();m.setFieldsValue(b()(b()({},a),{},ae()({},n,e))),t(b()(b()({},a),{},ae()({},n,e)))},h=function(e){return(0,w.jsxs)("span",{className:fe,style:{width:ce.d.mini},children:[(0,w.jsx)("span",{className:"text",children:e.description?(0,w.jsxs)(E.Z,{title:e.description,children:[(0,w.jsxs)("span",{children:[" ",e.label]}),(0,w.jsx)("span",{className:"m-l-5",children:(0,w.jsx)(ue.Z,{})})]}):(0,w.jsx)("span",{children:e.label})}),(0,w.jsx)(me.Z,{className:"label-val",variant:"outlined",size:"small",value:m.getFieldValue(e.field),controls:!1,onChange:function(n){return p(n,e.field)}})]})};return(0,w.jsx)(de.Z,{name:"modelparams",form:m,onValuesChange:function(e,n){null==t||t(n)},onFinish:function(e){},onFinishFailed:function(e){},children:(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{className:"m-b-15 m-l-10 font-size-14",children:a.formatMessage({id:"playground.model"})}),(0,w.jsx)(de.Z.Item,{name:"model",rules:[{required:!0,message:a.formatMessage({id:"common.form.rule.select"},{name:a.formatMessage({id:"playground.model"})})}],children:(0,w.jsx)(oe.Z,{showSearch:!0,options:i})}),(0,w.jsx)("h3",{className:"m-b-20 m-l-10 flex-between flex-center font-size-14",children:(0,w.jsx)("span",{children:a.formatMessage({id:"playground.parameters"})})}),(0,w.jsx)(de.Z.Item,{name:"temperature",rules:[{required:!1}],children:(0,w.jsx)(le,{label:h({field:"temperature",label:"Temperature",description:a.formatMessage({id:"playground.params.temperature.tips"})}),style:{paddingInline:0},variant:"borderless",children:(0,w.jsx)(pe.Z,{defaultValue:1,max:2,step:.1,style:{marginBottom:0,marginTop:16},tooltip:{open:!1},value:m.getFieldValue("temperature")||void 0,onChange:function(e){return p(e,"temperature")}})})}),(0,w.jsx)(de.Z.Item,{name:"max_tokens",rules:[{required:!1}],children:(0,w.jsx)(le,{label:h({field:"max_tokens",label:"Max Tokens",description:a.formatMessage({id:"playground.params.maxtokens.tips"})}),style:{paddingInline:0},variant:"borderless",children:(0,w.jsx)(pe.Z,{defaultValue:1024,max:2048,step:1,style:{marginBottom:0,marginTop:16},tooltip:{open:!1},value:m.getFieldValue("max_tokens")||void 0,onChange:function(e){return p(e,"max_tokens")}})})}),(0,w.jsx)(de.Z.Item,{name:"top_p",rules:[{required:!1}],children:(0,w.jsx)(le,{label:h({field:"top_p",label:"Top P",description:a.formatMessage({id:"playground.params.topp.tips"})}),style:{paddingInline:0},variant:"borderless",children:(0,w.jsx)(pe.Z,{defaultValue:1,max:1,step:.1,style:{marginBottom:0,marginTop:16},tooltip:{open:!1},value:m.getFieldValue("top_p")||void 0,onChange:function(e){return p(e,"top_p")}})})}),(0,w.jsx)(de.Z.Item,{name:"seed",rules:[{required:!1}],children:(0,w.jsx)(ie.Z.Number,{label:"Seed",min:0,description:a.formatMessage({id:"playground.params.seed.tips"}),style:{width:ce.d.mini}})}),(0,w.jsx)(de.Z.Item,{name:"stop",rules:[{required:!1}],normalize:function(e){return e||null},children:(0,w.jsx)(ie.Z.Input,{allowClear:!0,label:"Stop Sequence",description:a.formatMessage({id:"playground.params.stop.tips"}),style:{width:ce.d.mini}})})]})})},ve=function(){var e=(0,o.useIntl)(),n=(0,o.useSearchParams)(),t=s()(n,1)[0].get("model")||"",a=(0,f.useState)({}),m=s()(a,2),v=m[0],g=m[1],x=(0,f.useState)(!1),j=s()(x,2),y=j[0],b=j[1],Z=(0,f.useRef)(null);return(0,h.y1)(l.ZP.RIGHT.join(","),(function(){b((function(e){return!e}))}),{preventDefault:!0}),(0,w.jsx)(i._z,{ghost:!0,extra:[(0,w.jsxs)(c.Z,{children:[(0,w.jsx)(u.ZP,{size:"middle",onClick:function(){var e,n;null===(e=Z.current)||void 0===e||null===(n=e.viewCode)||void 0===n||n.call(e)},icon:(0,w.jsx)(r.Z,{type:"icon-code",className:"font-size-16"}),children:e.formatMessage({id:"playground.viewcode"})}),(0,w.jsx)(u.ZP,{size:"middle",className:"m-l-5",onClick:function(){return b(!y)},icon:(0,w.jsx)(r.Z,{type:"icon-a-layout6-line",className:"font-size-16"})})]},"buttons")],className:"playground-container",children:(0,w.jsxs)("div",{className:"play-ground",children:[(0,w.jsx)("div",{className:"chat",children:(0,w.jsx)(ne,{parameters:v,ref:Z})}),(0,w.jsxs)("div",{className:p()("left",{collapse:y}),children:[(0,w.jsx)("div",{className:p()("divider-line",{collapse:y}),children:(0,w.jsx)(d.Z,{type:"vertical"})}),(0,w.jsx)("div",{className:p()("params"),children:(0,w.jsx)("div",{className:p()("params-box",{collapse:y}),children:(0,w.jsx)(he,{setParams:g,selectedModel:t})})})]})]})})}}}]);