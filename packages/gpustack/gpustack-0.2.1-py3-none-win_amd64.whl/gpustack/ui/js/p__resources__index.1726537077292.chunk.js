"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[485],{94092:function(e,t,n){n.r(t),n.d(t,{default:function(){return we}});var r=n(48305),a=n.n(r),s=n(67399),o=n(32382),i=n(68459),l=n(50959),d=n(90228),c=n.n(d),u=n(87999),m=n.n(u),f=n(26068),x=n.n(f),p=n(38441),h=n(64518),g=n(19487),v=n(11527),j=(0,l.memo)((function(e){var t=e.percent,n=(e.steps,e.download),r=e.label,a=(0,l.useMemo)((function(){return n?"var(--ant-color-primary)":t<=50?"var(--color-progress-green)":t<=80?"var(--ant-color-warning)":"var(--ant-color-error)"}),[t]);return(0,v.jsx)(v.Fragment,{children:r?(0,v.jsx)(h.Z,{title:r,children:(0,v.jsx)(g.Z,{percentPosition:{align:"center",type:"inner"},size:[void 0,16],format:function(){return(0,v.jsxs)("span",{style:{color:"#fff"},children:[t,"%"]})},percent:t,strokeColor:a})}):(0,v.jsx)(g.Z,{type:"line",percentPosition:{align:"center",type:"inner"},size:[void 0,16],format:function(){return(0,v.jsxs)("span",{style:{color:"#fff"},children:[t,"%"]})},percent:t,strokeColor:a})})})),y=n(79822),b=n(34088),k=n(46392),w=n(357),M=n(81126),Z=n(2300),C=n(66551),P=n(32699),I=n.n(P),S=n(96563),z=w.Z.Column,_=function(){var e=(0,o.useIntl)(),t=(0,y.Z)({defaultSortOrder:"descend"}),n=(t.sortOrder,t.setSortOrder),r=(0,l.useState)({dataList:[],loading:!1,total:0}),s=a()(r,2),i=s[0],d=s[1],u=(0,l.useState)({page:1,perPage:10,search:""}),f=a()(u,2),h=f[0],g=f[1],P=function(){var e=m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d((function(e){return e.loading=!0,x()({},e)})),e.prev=1,t=x()({},I().pickBy(h,(function(e){return!!e}))),e.next=5,(0,S.oz)(t);case 5:n=e.sent,d({dataList:n.items||[],loading:!1,total:n.pagination.total}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),d({dataList:[],loading:!1,total:i.total});case 13:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(){return e.apply(this,arguments)}}();return(0,l.useEffect)((function(){P()}),[h]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(p.Z,{marginBottom:10,marginTop:10,left:(0,v.jsxs)(M.Z,{children:[(0,v.jsx)(Z.Z,{placeholder:e.formatMessage({id:"common.filter.name"}),style:{width:300},allowClear:!0,onChange:function(e){g(x()(x()({},h),{},{search:e.target.value}))}}),(0,v.jsx)(C.ZP,{type:"text",style:{color:"var(--ant-color-text-tertiary)"},onClick:function(e){P()},icon:(0,v.jsx)(k.Z,{})})]})}),(0,v.jsxs)(w.Z,{dataSource:i.dataList,loading:i.loading,rowKey:"id",onChange:function(e,t,r){n(r.order)},pagination:{showSizeChanger:!0,pageSize:h.perPage,current:h.page,total:i.total,hideOnSinglePage:10===h.perPage,onChange:function(e,t){g(x()(x()({},h),{},{page:e,perPage:t||10}))}},children:[(0,v.jsx)(z,{title:e.formatMessage({id:"common.table.name"}),dataIndex:"name"},"name"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.index"}),dataIndex:"index",render:function(e,t){return(0,v.jsx)("span",{children:t.index})}},"index"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.workername"}),dataIndex:"worker_name"},"worker_name"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.vender"}),dataIndex:"vendor"},"vendor"),(0,v.jsx)(z,{title:"".concat(e.formatMessage({id:"resources.table.temperature"})," (Â°C)"),dataIndex:"temperature",render:function(e,t){return(0,v.jsx)("span",{children:e?I().round(e,1):"-"})}},"Temperature"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.core"}),dataIndex:"core",render:function(e,t){var n;return(0,v.jsx)("span",{children:null===(n=t.core)||void 0===n?void 0:n.total})}},"Core"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.gpuutilization"}),dataIndex:"gpuUtil",render:function(e,t){var n;return(0,v.jsx)(j,{percent:I().round(null===(n=t.core)||void 0===n?void 0:n.utilization_rate,2)})}},"gpuUtil"),(0,v.jsx)(z,{title:e.formatMessage({id:"resources.table.vramutilization"}),dataIndex:"VRAM",render:function(t,n){var r,a,s;return(0,v.jsx)(j,{percent:I().round(null===(r=n.memory)||void 0===r?void 0:r.utilization_rate,0),label:(0,v.jsxs)("span",{className:"flex-column",children:[(0,v.jsxs)("span",{children:[e.formatMessage({id:"resources.table.total"}),":"," ",(0,b.hy)(null===(a=n.memory)||void 0===a?void 0:a.total,0)]}),(0,v.jsxs)("span",{children:[e.formatMessage({id:"resources.table.used"}),":"," ",(0,b.hy)(null===(s=n.memory)||void 0===s?void 0:s.used,0)]})]})})}},"VRAM")]})]})},O=(0,l.memo)(_),W=n(67825),N=n.n(W),T=n(89891),L=n(66292),R=n.n(L),E=["children","maxWidth","ghost","showTitle"],U=function(e){var t=e.children,n=e.maxWidth,r=void 0===n?"100%":n,s=e.ghost,o=void 0!==s&&s,i=e.showTitle,d=void 0!==i&&i,c=N()(e,E),u=(0,l.useRef)(null),m=(0,l.useState)(!1),f=a()(m,2),p=f[0],g=f[1],j=(0,l.useCallback)((function(){if(u.current){var e=u.current,t=e.scrollWidth,n=e.clientWidth;g(t>n)}}),[]),y=(0,l.useMemo)((function(){return R()(j,200)}),[j]);(0,l.useEffect)((function(){return j(),window.addEventListener("resize",y),function(){window.removeEventListener("resize",y),y.cancel()}}),[j,y]),(0,l.useEffect)((function(){j()}),[t,j]);var b=(0,l.useMemo)((function(){return x()({maxWidth:r,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},c.style)}),[r,c.style]);return(0,v.jsx)(h.Z,{title:p||d?t:"",children:o?(0,v.jsx)("div",{ref:u,style:b,children:t}):(0,v.jsx)(T.Z,x()(x()({},c),{},{ref:u,style:b,children:t}))})},A=l.memo(U),V=n(41755),B=n(64151),F=n(69517),K=n(43463),G=n(23543),D=n(86008),q=n(26657),H=n(10822),$=n(56280),J=n(18953),Q=n(94299),X=n(82092),Y=n.n(X),ee=n(33398),te="ready",ne="not_ready",re=Y()(Y()({},te,"Ready"),ne,"Not Ready"),ae=Y()(Y()({},te,ee.iE.success),ne,ee.iE.error),se={getToken:"cat /var/lib/gpustack/token",registerWorker:function(e){return"curl -sfL https://get.gpustack.ai | sh -s - --server-url ".concat(e," --token mytoken")}},oe={getToken:'Get-Content -Path (Join-Path -Path $env:APPDATA -ChildPath "gpustack\\token") -Raw',registerWorker:function(e){return'Invoke-Expression "& { $((Invoke-WebRequest -Uri "https://get.gpustack.ai" -UseBasicParsing).Content) } --server-url '.concat(e,' --token mytoken"')}},ie=n(34018),le=n(48157),de=function(e){var t=e||{},n=t.open,r=t.onCancel,a=(0,o.useIntl)(),s=window.location.origin;return(0,v.jsx)(le.Z,{title:a.formatMessage({id:"resources.button.create"}),open:n,centered:!0,onCancel:r,destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,footer:null,children:(0,v.jsxs)("div",{children:[(0,v.jsxs)("h3",{children:["1. ",a.formatMessage({id:"resources.worker.add.step1"})]}),(0,v.jsx)("h4",{children:a.formatMessage({id:"resources.worker.linuxormaxos"})}),(0,v.jsx)(ie.Z,{code:se.getToken,theme:"dark"}),(0,v.jsx)("h4",{children:"Windows "}),(0,v.jsx)(ie.Z,{code:oe.getToken,theme:"dark"}),(0,v.jsxs)("h3",{children:["2. ",a.formatMessage({id:"resources.worker.add.step2"})," ",(0,v.jsx)("span",{className:"font-size-12",style:{color:"var(--ant-color-text-tertiary)"},dangerouslySetInnerHTML:{__html:"(".concat(a.formatMessage({id:"resources.worker.add.step2.tips"}),")")}})]}),(0,v.jsx)("h4",{children:a.formatMessage({id:"resources.worker.linuxormaxos"})}),(0,v.jsx)(ie.Z,{code:se.registerWorker(s),theme:"dark"}),(0,v.jsx)("h4",{children:"Windows "}),(0,v.jsx)(ie.Z,{theme:"dark",code:oe.registerWorker(s)}),(0,v.jsxs)("h3",{children:["3. ",a.formatMessage({id:"resources.worker.add.step3"})]})]})})},ce=l.memo(de),ue=n(26409),me=n(45799),fe=n(99494),xe=n(79698),pe=n(56377),he=(n(32638),function(e){var t=e||{},n=t.open,r=t.onCancel,s=t.data,i=t.onOk,l=(0,o.useIntl)(),d=xe.Z.useForm(),c=a()(d,1)[0],u=xe.Z.useWatch("labels",c);return(0,v.jsx)(le.Z,{title:l.formatMessage({id:"resources.button.edit"}),open:n,centered:!0,onCancel:r,destroyOnClose:!0,closeIcon:!0,maskClosable:!1,keyboard:!1,width:600,styles:{content:{padding:"0px"},header:{padding:"var(--ant-modal-content-padding)",paddingBottom:"0"},body:{padding:"0"},footer:{padding:"0 var(--ant-modal-content-padding)"}},footer:(0,v.jsx)(me.Z,{onOk:function(){c.submit()},onCancel:r}),children:(0,v.jsx)(pe.Z,{style:{maxHeight:"550px"},children:(0,v.jsxs)(xe.Z,{name:"deployModel",form:c,onFinish:i,preserve:!1,clearOnDestroy:!0,initialValues:{name:s.name,labels:s.labels},style:{padding:"var(--ant-modal-content-padding)",paddingBlock:0},children:[(0,v.jsx)(xe.Z.Item,{name:"name",children:(0,v.jsx)(fe.Z.Input,{label:l.formatMessage({id:"common.table.name"}),disabled:!0})}),(0,v.jsx)(xe.Z.Item,{name:"labels",rules:[function(){return{validator:function(e,t){return I().keys(t).length>0&&I().some(I().keys(t),(function(e){return!t[e]}))?Promise.reject(l.formatMessage({id:"common.validate.value"},{name:l.formatMessage({id:"resources.form.label"})})):Promise.resolve()}}}],children:(0,v.jsx)(ue.Z,{label:l.formatMessage({id:"resources.table.labels"}),labels:u,btnText:"common.button.addLabel",onChange:function(e){c.setFieldValue("labels",e)}})})]})})})}),ge=l.memo(he),ve=w.Z.Column,je=[{label:"common.button.edit",key:"edit",icon:(0,v.jsx)(D.Z,{})},{label:"common.button.delete",key:"delete",props:{danger:!0},icon:(0,v.jsx)(q.Z,{})}],ye=function(){var e=(0,y.Z)({defaultSortOrder:"descend"}),t=(e.sortOrder,e.setSortOrder),n=(0,l.useRef)(null),r=(0,G.Z)(),s=(0,o.useIntl)(),i=(0,l.useState)(!1),d=a()(i,2),u=d[0],f=d[1],g=(0,l.useState)({dataList:[],loading:!1,total:0}),P=a()(g,2),z=P[0],_=P[1],O=(0,l.useState)({page:1,perPage:10,search:""}),W=a()(O,2),N=W[0],T=W[1],L=(0,l.useState)({open:!1,data:{}}),R=a()(L,2),E=R[0],U=R[1],D=(0,l.useCallback)(m()(c()().mark((function e(){var t,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _((function(e){return e.loading=!0,x()({},e)})),e.prev=1,t=x()({},I().pickBy(N,(function(e){return!!e}))),e.next=5,(0,S.Sw)(t);case 5:n=e.sent,_({dataList:n.items,loading:!1,total:n.pagination.total}),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),_({dataList:[],loading:!1,total:z.total});case 13:case"end":return e.stop()}}),e,null,[[1,9]])}))),[N]),X=(0,l.useCallback)((function(e,n,r){t(r.order)}),[]),Y=function(e,t){return t&&e?I().round(e/t*100,0):0},ee=function(){f(!0)},te=function(e){var t=I().find(e,(function(e){return"/"===e.mount_point}));return t?(0,v.jsxs)("span",{className:"flex-column",children:[(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.total"}),":"," ",(0,b.hy)(null==t?void 0:t.total,0)]}),(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.used"}),":"," ",(0,b.hy)(null==t?void 0:t.used,0)]})]}):0},ne=(0,l.useCallback)(function(){var e=m()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=4,(0,S.Vq)(E.data.id,x()(x()({},E.data),{},{labels:t.labels}));case 4:J.ZP.success(s.formatMessage({id:"common.message.success"})),D(),U({open:!1,data:{}}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),[E,D]),se=(0,l.useCallback)((function(){U(x()(x()({},E),{},{open:!1}))}),[]),oe=function(e,t){var r;"edit"!==e?"delete"===e&&(r=t,n.current.show({content:"worker",name:r.name,onOk:function(){return m()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,(0,S.lM)(r.id);case 3:D();case 4:case"end":return e.stop()}}),e)})))()}})):function(e){U({open:!0,data:x()({},e)})}(t)};return(0,l.useEffect)((function(){D()}),[N]),(0,Q.y1)(K.ZP.CREATE.join(","),ee,{enabled:!u}),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(p.Z,{marginBottom:10,marginTop:10,left:(0,v.jsxs)(M.Z,{children:[(0,v.jsx)(Z.Z,{placeholder:s.formatMessage({id:"common.filter.name"}),style:{width:300},allowClear:!0,onChange:function(e){T(x()(x()({},N),{},{search:e.target.value}))}}),(0,v.jsx)(C.ZP,{type:"text",style:{color:"var(--ant-color-text-tertiary)"},onClick:function(e){D()},icon:(0,v.jsx)(k.Z,{})})]}),right:(0,v.jsxs)(M.Z,{size:20,children:[(0,v.jsx)(C.ZP,{icon:(0,v.jsx)(H.Z,{}),type:"primary",onClick:ee,children:s.formatMessage({id:"resources.button.create"})}),(0,v.jsx)(C.ZP,{icon:(0,v.jsx)(q.Z,{}),danger:!0,onClick:function(){n.current.show({content:"wokers",selection:!0,onOk:function(){return m()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.D6)(r.selectedRowKeys,S.lM);case 2:r.clearSelections(),D();case 4:case"end":return e.stop()}}),e)})))()}})},disabled:!r.selectedRowKeys.length,children:s.formatMessage({id:"common.button.delete"})})]})}),(0,v.jsxs)(w.Z,{style:{width:"100%"},dataSource:z.dataList,loading:z.loading,rowKey:"id",onChange:X,rowSelection:r,pagination:{showSizeChanger:!0,pageSize:N.perPage,current:N.page,total:z.total,hideOnSinglePage:10===N.perPage,onChange:function(e,t){T(x()(x()({},N),{},{page:e,perPage:t||10}))}},children:[(0,v.jsx)(ve,{title:s.formatMessage({id:"common.table.name"}),dataIndex:"name"},"name"),(0,v.jsx)(ve,{title:s.formatMessage({id:"resources.table.labels"}),dataIndex:"labels",width:200,render:function(e,t){return(0,v.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:6,maxWidth:200},children:I().map(t.labels,(function(e,t){return(0,v.jsxs)(A,{className:"m-r-0",maxWidth:120,children:[t,":",e]},t)}))})}},"labels"),(0,v.jsx)(ve,{title:s.formatMessage({id:"common.table.status"}),dataIndex:"state",render:function(e,t){return(0,v.jsx)(F.Z,{statusValue:{status:ae[t.state],text:re[t.state],message:t.state_message}})}},"state"),(0,v.jsx)(ve,{title:"IP",dataIndex:"ip"},"address"),(0,v.jsx)(ve,{title:"CPU",dataIndex:"CPU",render:function(e,t){var n;return(0,v.jsx)(j,{percent:I().round(null==t||null===(n=t.status)||void 0===n||null===(n=n.cpu)||void 0===n?void 0:n.utilization_rate,0)})}},"CPU"),(0,v.jsx)(ve,{title:s.formatMessage({id:"resources.table.memory"}),dataIndex:"memory",render:function(e,t){var n,r,a,o;return(0,v.jsx)(j,{percent:Y(null==t||null===(n=t.status)||void 0===n||null===(n=n.memory)||void 0===n?void 0:n.used,null==t||null===(r=t.status)||void 0===r||null===(r=r.memory)||void 0===r?void 0:r.total),label:(0,v.jsxs)("span",{className:"flex-column",children:[(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.total"}),":"," ",(0,b.hy)(null==t||null===(a=t.status)||void 0===a||null===(a=a.memory)||void 0===a?void 0:a.total,0)]}),(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.used"}),":"," ",(0,b.hy)(null==t||null===(o=t.status)||void 0===o||null===(o=o.memory)||void 0===o?void 0:o.used,0)]})]})})}},"Memory"),(0,v.jsx)(ve,{title:"GPU",dataIndex:"GPU",render:function(e,t){var n;return(0,v.jsx)("span",{className:"flex-column flex-gap-2",children:I().map(null==t||null===(n=t.status)||void 0===n?void 0:n.gpu_devices,(function(e,t){var n;return(0,v.jsxs)("span",{className:"flex-center",children:[(0,v.jsxs)("span",{className:"m-r-5",style:{display:"flex",width:25},children:["[",e.index,"]"]}),(0,v.jsx)(j,{percent:I().round(null===(n=e.core)||void 0===n?void 0:n.utilization_rate,0)},t)]},t)}))})}},"GPU"),(0,v.jsx)(ve,{title:s.formatMessage({id:"resources.table.vram"}),dataIndex:"VRAM",render:function(e,t){var n;return(0,v.jsx)("span",{className:"flex-column",children:I().map(null==t||null===(n=t.status)||void 0===n?void 0:n.gpu_devices,(function(e,t){var n,r,a;return(0,v.jsx)("span",{children:(0,v.jsxs)("span",{className:"flex-center",children:[(0,v.jsxs)("span",{className:"m-r-5",style:{display:"flex",width:25},children:["[",e.index,"]"]}),(0,v.jsx)(j,{percent:I().round(null===(n=e.memory)||void 0===n?void 0:n.utilization_rate,0),label:(0,v.jsxs)("span",{className:"flex-column",children:[(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.total"}),": ",(0,b.hy)(null===(r=e.memory)||void 0===r?void 0:r.total,0)]}),(0,v.jsxs)("span",{children:[s.formatMessage({id:"resources.table.used"}),": ",(0,b.hy)(null===(a=e.memory)||void 0===a?void 0:a.used,0)]})]})},t),e.memory.is_unified_memory&&(0,v.jsx)(h.Z,{title:s.formatMessage({id:"resources.table.unified"}),children:(0,v.jsx)($.Z,{className:"m-l-5"})})]})},t)}))})}},"VRAM"),(0,v.jsx)(ve,{title:s.formatMessage({id:"resources.table.disk"}),dataIndex:"storage",render:function(e,t){var n,r,a;return(0,v.jsx)(j,{percent:(r=null===(n=t.status)||void 0===n?void 0:n.filesystem,a=I().find(r,(function(e){return"/"===e.mount_point})),a?Y(a.used,a.total):0),label:te(t.status.filesystem)})}},"storage"),(0,v.jsx)(ve,{title:s.formatMessage({id:"common.table.operation"}),render:function(e,t){return(0,v.jsx)(B.Z,{items:je,onSelect:function(e){return oe(e,t)}})}},"operation")]}),(0,v.jsx)(V.Z,{ref:n}),(0,v.jsx)(ce,{open:u,onCancel:function(){return f(!1)}}),(0,v.jsx)(ge,{open:E.open,onOk:ne,onCancel:se,data:{name:E.data.name,labels:E.data.labels}})]})},be=(0,l.memo)(ye),ke=[{key:"workers",label:"Workers",children:(0,v.jsx)(be,{})},{key:"gpus",label:"GPUs",children:(0,v.jsx)(O,{})}],we=function(){var e=(0,l.useState)("workers"),t=a()(e,2),n=t[0],r=t[1],d=(0,o.useIntl)(),c=(0,l.useCallback)((function(e){r(e)}),[]);return(0,v.jsx)(v.Fragment,{children:(0,v.jsx)(s._z,{ghost:!0,header:{title:d.formatMessage({id:"resources.title"})},extra:[],children:(0,v.jsx)("div",{style:{marginTop:60},children:(0,v.jsx)(i.Z,{type:"card",defaultActiveKey:"workers",items:ke,accessKey:n,onChange:c})})})})}}}]);