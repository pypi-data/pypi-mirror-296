# vim: filetype=apache
<VirtualHost 172.27.20.21:80>
    ServerName ar3.corporatepharmacy.com
    ServerAdmin webmaster@corporatepharmacy.com
    ServerSignature Off
    
    # Logging
    LogLevel error
	ErrorLog /var/log/apache2/ar3.corporatepharmacy.com-error.log
	CustomLog /var/log/apache2/ar3.corporatepharmacy.com-access.log combined

    # Force to HTTPS
    RewriteEngine On
    RedirectMatch ^/(.*) https://ar3.corporatepharmacy.com/$1
</VirtualHost>

<VirtualHost 172.27.20.21:443>
    ServerName ar3.corporatepharmacy.com
	ServerAdmin webmaster@corporatepharmacy.com
	ServerSignature Off

    # Logging
    LogLevel error
	ErrorLog /var/log/apache2/ar3.corporatepharmacy.com-error.log
	CustomLog /var/log/apache2/ar3.corporatepharmacy.com-access.log combined

    # SSL
    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/wildcard.corporatepharmacy.com.crt
    SSLCertificateKeyFile /etc/apache2/ssl/wildcard.corporatepharmacy.com.key.sha2
    SSLCertificateChainFile /etc/apache2/ssl/wildcard.corporatepharmacy.com.chain.crt
    BrowserMatch "MSIE [2-6]" \
		nokeepalive ssl-unclean-shutdown \
		downgrade-1.0 force-response-1.0
    # MSIE 7 and newer should be able to use keepalive
    BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    RewriteEngine On
    RewriteRule ^$ /html/frameset.html [R,L]
    RewriteRule ^/$ /html/frameset.html [R,L]
    RewriteRule ^/ppayment$ /ppayment/ [R,L]
    RewriteRule ^/apps/(.*)$ /$1 [R,L]

    # Authentication
    <Location />
        AuthType Basic
        AuthName "Accounting Launchpad"
        AuthUserFile "/data/htpasswd"
        Require valid-user
    </Location>

    # Resources
    Alias /css /usr/local/srv/bd/www/ar/css
    Alias /doc /usr/local/srv/bd/doc/ar
    Alias /html /usr/local/srv/bd/www/ar/html
    Alias /images /usr/local/srv/bd/www/ar/images
    Alias /js /usr/local/srv/bd/www/ar/js
    Alias /repo /usr/local/srv/bd/www/repo

    # WSGI
    WSGIScriptAlias / /usr/local/srv/bd/etc/ar/web4.wsgi
    WSGIDaemonProcess ar3.corporatepharmacy.com processes=15 threads=1
    WSGIProcessGroup ar3.corporatepharmacy.com
</VirtualHost>
