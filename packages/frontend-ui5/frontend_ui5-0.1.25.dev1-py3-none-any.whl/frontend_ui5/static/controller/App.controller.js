"use strict";sap.ui.define(["sap/base/Log","sap/m/Button","sap/m/MessageToast","sap/m/NotificationListItem","sap/m/ResponsivePopover","sap/m/library","sap/ui/Device","sap/ui/core/CustomData","sap/ui/core/Theming","sap/ui/core/library","./BaseController","./utils/Comparators","./utils/Cookies","./utils/Formatters"],function(t,e,o,i,s,n,a,c,r,d,h,g,l,u){"use strict";function p(t){return t&&t.__esModule&&typeof t.default!=="undefined"?t.default:t}const f=n["PlacementType"];const m=d["ValueState"];const S=p(h);const T=g["comparePersons"];const I=l["deleteCookie"];const v=l["getCookie"];const N=l["setCookie"];const P=l["setCookieConsent"];const y=l["setDummyCSRFCookie"];const L=u["shortenString"];const b=S.extend("demo.spa.controller.App",{constructor:function e(){S.prototype.constructor.apply(this,arguments);this.comparePersons=T;this.logger=t.getLogger(b.prototype.getMetadata().getName());this.shortenString=L},_:function t(){this.onInit()},formatPersonNameInNavList:async function t(e,o,i,s){const n=await this.getBundleText("thatsMe");const a=`${i} ${s}`;return e===o?a+" "+n:a},onAfterRendering:function t(){if(a.resize.width<=1024&&a.system.desktop){const t=this.byId("idSideNavigationToggleButton");setTimeout(()=>{if(!this.getRouter().getRouteInfoByHash(window.location.hash.slice(1))?.name.includes("FULLSCREEN")){t.fireEvent("press")}},1500)}},onBeforeRendering:function t(){this.onThemeChanged()},onExit:function t(){a.media.detachHandler(this.handleWindowResize.bind(this),this)},onInit:function t(){S.prototype.onInit.call(this);this.toolPage=this.byId("idToolPage");this.prepareSideNavigationLists();this.setUpAttachedHandlers();this.prepareAccount()},onLogoutPress:function t(){S.connector.signOut().then(this.handleLogoutSuccess.bind(this),this.handleLogoutFailure.bind(this))},onMenuButtonPress:function t(){const e=this.byId("idSideNavigation");if(!e.getVisible()){e.setVisible(true);return}const o=this.toolPage.getSideExpanded();void this.setToggleButtonTooltip(o);this.toolPage.setSideExpanded(!this.toolPage.getSideExpanded())},onNotificationPress:function t(o){const i=o.getSource();this.getI18nBundle().then(t=>{const o=new e({text:t.getText("app.btnBackText"),press:()=>{this.getNotificationMessagePopover().destroy()}});let n=this.getNotificationMessagePopover();if(!n){n=new s(this.getView().createId("idNotificationMessagePopover"),{title:t.getText("app.notificationTitle"),contentWidth:"300px",endButton:o,placement:f.Bottom,content:{path:"userData>/notification_list",factory:this.createNotification.bind(this)},afterClose:function(){n.destroy()}});this.toolPage.addDependent(n);n.openBy(i)}else if(n.isOpen()){n.close()}}).catch(t=>{this.logger.error(t.message)})},onOpenSignInDialogPress:function t(){this.getRouter().navTo("SIGN IN FULLSCREEN")},onOpenSignUpDialogPress:function t(){this.getRouter().navTo("SIGN UP FULLSCREEN")},onRouteChange:function t(){if(a.system.phone){this.toolPage.setSideExpanded(false)}},onThemeChanged:function t(){const e=this.getTheme();if(e){this.setSvgLogoPath(e)}else{this.logger.error(`Theme is not supported`)}},onUserBtnPress:function t(e){const o=this.getView().byId("idUserActionSheet");o.openBy(e.getSource())},createNotification:function t(e,s){const n=s.getObject();const a=new i(e,{title:n.title,description:n.description,priority:n.priority,datetime:n.datetime,customData:[new c({key:"path",value:s.getPath()})],close:t=>{const e=t.getSource().getCustomData()[0].getValue();const i=e.split("/").pop();const s=this.getUserDataModel().getData().notification_list.splice(parseInt(i),1);if(s.length===0){this.getView().byId("idNotificationMessagePopover");this.getNotificationMessagePopover().close()}this.getUserDataModel().updateBindings(true);void this.getBundleText("app.msgNotificationDeleted").then(t=>{o.show(t)})}});return a},getNotificationMessagePopover:function t(){return this.byId("idNotificationMessagePopover")},getTheme:function t(){return this.mapThemeToAlias[r.getTheme()]},handleLogoutFailure:function t(){this.getUserDataModel().reset();this.setUserNameAndId("","");N("LOG_OUT")},handleLogoutSuccess:function t(){this.setUserNameAndId("","");this.getUserDataModel().reset()},handleWindowResize:function t(e){const o=this.toolPage.getSideExpanded();const i=e.name==="Tablet";const s=e.name==="Phone";const n=e.name==="Desktop";if(o&&(i||s)){this.toolPage.setSideExpanded(false);void this.setToggleButtonTooltip(false)}else if(!o&&n){this.toolPage.setSideExpanded(true);void this.setToggleButtonTooltip(true)}},prepareAccount:function t(){if(v("LOG_OUT")){I("LOG_OUT");S.connector.signOut().then(this.handleLogoutSuccess.bind(this),this.handleLogoutFailure.bind(this))}else{const t=globalThis.django&&globalThis.django.username;if(t){this.loginUser(django.username,django.user_id)}else if(this.hasMockBackend()){P();y();this.loginUser("Benjamin Cooper","3mzw1aw7iw200")}}},prepareSideNavigationLists:function t(){this.setSelectedNavListItem();this.getUserDataModel().attachModelChangedHandler(t=>{if(t.getParameter("entityName")==="person"){this.setSelectedNavListItem()}});this.getRouter().attachEvent("navigateBackToValidRoute",()=>this.setSelectedNavListItem());this.getRouter().attachRouteMatched({},()=>this.setSelectedNavListItem())},setSelectedNavListItem:function t(){const e=this.byId("idHomeNavListItem");const o=this.byId("idNavList");const i=this.byId("idNavListFixed");const s=o.getItems();const n=i.getItems();const a=[...s,...n];const c=[];for(const t of a){t.getAggregation("items")?.forEach(t=>c.push(t))}const r=[...a,...c].find(t=>t.getHref()===window.location.hash);if(r){r.focus();if(n.includes(r)){i.setSelectedItem(r);o.setSelectedItem(null)}else{o.setSelectedItem(r);i.setSelectedItem(null)}}else{o.setSelectedItem(e);i.setSelectedItem(null)}},setSvgLogoPath:function t(e){const o=this.getFrontendModel().getData().resourceRoot;this.getFrontendModel().setProperty("/svgLogoPath",`${o}img/logo-${e}.svg`)},setToggleButtonTooltip:async function t(e){const o=this.byId("idSideNavigationToggleButton");const i=await this.getBundleText(e?"app.btnExpandMenu":"app.btnCollapseMenu");o.setTooltip(i)},setUpAttachedHandlers:function t(){a.media.attachHandler(this.handleWindowResize.bind(this),this);this.getRouter().attachRouteMatched(this.onRouteChange.bind(this));r.attachApplied(this.onThemeChanged.bind(this));sap.ui.getCore().attachValidationError(t=>{try{t.getParameter("element").setValueState(m.Error)}catch(t){this.logger.error(String(t))}});sap.ui.getCore().attachValidationSuccess(t=>{try{t.getParameter("element").setValueState(m.None)}catch(t){this.logger.error(String(t))}})}});return b});
//# sourceMappingURL=App.controller.js.map