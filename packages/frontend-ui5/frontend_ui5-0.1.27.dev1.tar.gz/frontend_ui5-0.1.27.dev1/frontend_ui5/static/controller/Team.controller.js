"use strict";sap.ui.define(["sap/base/Log","sap/m/MessageBox","sap/m/MessageToast","./BaseController","./utils/Comparators","./utils/Formatters"],function(e,t,o,s,n,a){"use strict";function i(e){return e&&e.__esModule&&typeof e.default!=="undefined"?e.default:e}const r=i(s);const l=n["comparePersons"];const m=a["getEmailAddressErrorState"];const c=a["isValidEmailAddress"];const g=a["trimValuesShallow"];const h=r.extend("demo.spa.controller.Team",{constructor:function t(){r.prototype.constructor.apply(this,arguments);this.comparePersons=l;this.getEmailAddressErrorState=m;this.logger=e.getLogger(h.getMetadata().getName())},_:function e(){this.onInit()},deletePerson:function e(t){this.teamMemberDialog.setBusy(true);const o=this.getUserDataModel().getProperty("/person_list").length;const s=()=>{this.teamMemberDialog.setBusy(false);this.teamMemberDialog.close();if(this.getUserDataModel().getProperty("/person_list").length!==o){this.getUserDataModel().fetch(["person","slot","appointment"])}};this.getUserDataModel().delete(t,s)},getAccessLink:function e(t){try{const e=window.location.origin;const o=this.getRouter().getURL("ACCESS FULLSCREEN",{userKey:t.key});const s=window.location.search;const n=window.location.pathname;return`${e}${n}${s}#${o}`}catch(e){this.logger.debug(String(e));return""}},onAddPersonPress:function e(){this.setPersonFormData({_type:"person",id:null,first_name:"",last_name:"",email:""});this.openTeamMemberDialog()},onDeletePersonPress:function e(){const t=this.getFrontendModel().getProperty("/personForm/id");const s=this.getUserDataModel().get("person",t);if(s.related_user===django.user_id){o.show("Sie können sich nicht selbst löschen.");return}const n=s.first_name+" "+s.last_name;this.createConfirmation("team.txtConfirmDeletion",[n],()=>this.deletePerson(s))},onDialogCreate:function e(){this.teamMemberDialog.setBusy(true);const t=this.getPersonFormData();if(!this.checkPersonFormInput(t.first_name,t.last_name,t.email)){this.onDialogClose();return}else{this.getUserDataModel().create(t,()=>this.onDialogClose())}},onDialogSave:function e(){const t=this.getPersonFormData();this.teamMemberDialog.setBusy(true);if(!this.checkPersonFormInput(t.first_name,t.last_name,t.email)){this.onDialogClose();return}else{this.getUserDataModel().update(t,()=>this.onDialogClose())}},onPersonEditPress:function e(t){const o=t.getSource().getCustomData()[0].getValue();this.setPersonFormData(o);this.openTeamMemberDialog()},onPersonListItemPress:function e(t){const o=t.getSource().getCustomData()[0].getValue();if(o.related_user!=django.user_id){this.setPersonFormData(o);this.openCollaborationDialog()}},checkPersonFormInput:function e(t,o,s){const n=c(s)||s==="";const a=(t+o).trim()!=="";return n&&a},createConfirmation:function e(o,s,n){void this.getI18nBundle().then(e=>{const a=e.getText(o,s);t.confirm(a,{actions:[t.Action.YES,t.Action.NO],emphasizedAction:t.Action.YES,onClose:e=>{if(e==t.Action.YES){n()}}})})},getPersonFormData:function e(){const t=this.getFrontendModel().getProperty("/personForm");return g({...t})},onDialogClose:function e(){if(this.teamCollaborationDialog){this.teamCollaborationDialog.setBusy(false);this.teamCollaborationDialog.close()}if(this.teamMemberDialog){this.teamMemberDialog.setBusy(false);this.teamMemberDialog.close()}},openCollaborationDialog:function e(){if(!this.teamCollaborationDialog){this.loadFragment({name:"demo.spa.view.TeamCollaborationDialog"}).then(e=>{this.teamCollaborationDialog=e;this.teamCollaborationDialog.open()}).catch(e=>{this.logger.error(String(e))})}else{this.teamCollaborationDialog.open()}},openTeamMemberDialog:function e(){if(!this.teamMemberDialog){this.loadFragment({name:"demo.spa.view.TeamDialog"}).then(e=>{this.teamMemberDialog=e;this.teamMemberDialog.attachAfterOpen(()=>this.setTeamMemberDialogFocus());this.teamMemberDialog.open()}).catch(e=>{this.logger.error(String(e))})}else{this.teamMemberDialog.open()}},setPersonFormData:function e(t){this.getFrontendModel().setProperty("/personForm",{...t})},setTeamMemberDialogFocus:function e(){const t=this.byId("idFirstNameInput");t.focus()}});return h});
//# sourceMappingURL=Team.controller.js.map