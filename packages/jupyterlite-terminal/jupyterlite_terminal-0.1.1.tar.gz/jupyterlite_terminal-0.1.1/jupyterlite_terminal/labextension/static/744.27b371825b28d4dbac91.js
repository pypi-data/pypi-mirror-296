/*! For license information please see 744.27b371825b28d4dbac91.js.LICENSE.txt */
"use strict";(self.webpackChunk_jupyterlite_terminal=self.webpackChunk_jupyterlite_terminal||[]).push([[744],{744:(t,e,s)=>{s.r(e),s.d(e,{Aliases:()=>n,BufferedOutput:()=>O,CommandRegistry:()=>E,ConsoleOutput:()=>T,Context:()=>k,ExitCode:()=>i,FileInput:()=>F,FileOutput:()=>B,InputAll:()=>R,Pipe:()=>L,PipeInput:()=>D,RedirectOutput:()=>P,Shell:()=>yt,TerminalInput:()=>M,TerminalOutput:()=>W,parse:()=>G,tokenize:()=>j});var r={};s.r(r),s.d(r,{AliasCommand:()=>w,BuiltinCommand:()=>f,CdCommand:()=>C,ClearCommand:()=>b,ExportCommand:()=>A,HistoryCommand:()=>N});class n extends Map{constructor(){super(),this.set("dir","dir --color=auto"),this.set("grep","grep --color=auto"),this.set("ls","ls --color=auto"),this.set("ll","ls -lF"),this.set("vdir","vdir --color=auto")}getRecursive(t){let e=this.get(t);for(;void 0!==e;){const s=e.split(" ")[0];if(s===t)break;const r=this.get(s);e=void 0===r?r:r+e.slice(s.length),t=s}return e}match(t){return[...this.keys()].filter((e=>e.startsWith(t)))}}const i={SUCCESS:0,GENERAL_ERROR:1,IMPROPER_USE:2,CANNOT_RUN_COMMAND:126,CANNOT_FIND_COMMAND:127};class a{wasmLoader;constructor(t){this.wasmLoader=t}async run(t,e){const{args:s,fileSystem:r,mountpoint:n,stdin:a,stdout:o,stderr:h}=e,{wasmBaseUrl:u}=this.wasmLoader,l=Date.now(),c=this.wasmLoader.getModule(this.moduleName());function d(t){const s=a.readChar(),r=s[0];return a.isTerminal()&&(10===r?(e.stdout.write("\n"),e.stdout.flush()):r>31&&127!==r&&(e.stdout.write(String.fromCharCode(...s)),e.stdout.flush())),4===r?null:r}function f(t){return[e.environment.getNumber("LINES")??24,e.environment.getNumber("COLUMNS")??80]}let p;const m=await c({thisProgram:t,arguments:s,locateFile:t=>u+t,print:t=>o.write(`${t}\n`),printErr:e=>{"touch"===t&&e===`touch: failed to close '${s[1]}': Bad file descriptor`||h.write(`${e}\n`)},quit:(t,e)=>{void 0===p&&(p=t)},preRun:t=>{if(Object.prototype.hasOwnProperty.call(t,"FS")){const e=t.FS;e.mkdir(n,511),e.mount(r.PROXYFS,{root:n,fs:r.FS},n),e.chdir(r.FS.cwd())}if(Object.prototype.hasOwnProperty.call(t,"ENV")&&e.environment.copyIntoCommand(t.ENV),Object.prototype.hasOwnProperty.call(t,"TTY")){t.TTY.default_tty_ops.ioctl_tiocgwinsz=f;const e=t.FS.makedev(5,0);t.TTY.ttys[e].ops.get_char=d}}});if(void 0===p)p=i.CANNOT_RUN_COMMAND;else{if(Object.prototype.hasOwnProperty.call(m,"FS")){const t=m.FS;t.close(t.streams[1]),t.close(t.streams[2])}Object.prototype.hasOwnProperty.call(m,"getEnvStrings")&&e.environment.copyFromCommand(m.getEnvStrings())}const _=Date.now();return console.log(`${t} load and run time ${_-l} ms`),p}}class o extends a{constructor(t){super(t)}moduleName(){return"coreutils"}names(){return["basename","cat","chmod","cp","cut","date","dir","dircolors","dirname","echo","env","expr","head","id","join","ln","logname","ls","md5sum","mkdir","mv","nl","pwd","realpath","rm","rmdir","seq","sha1sum","sha224sum","sha256sum","sha384sum","sha512sum","sleep","sort","stat","stty","tail","touch","tr","tty","uname","uniq","vdir","wc"]}}class h extends a{constructor(t){super(t)}moduleName(){return"grep"}names(){return["grep"]}}class u extends a{constructor(t){super(t)}moduleName(){return"lua"}names(){return["lua"]}}class l extends Error{exitCode;constructor(t,e){super(e),this.exitCode=t}}class c extends l{constructor(t){super(i.CANNOT_FIND_COMMAND,`'${t}': command not found`)}}class d extends l{constructor(t){super(i.GENERAL_ERROR,t)}}class f{names(){return[this.name]}run(t,e){if(t!==this.name)throw new c(t);return this._run(e)}}class p{shortName;longName;description;constructor(t,e,s){this.shortName=t,this.longName=e,this.description=s}get isSet(){return this._isSet}get name(){return this.shortName?this.shortName:this.longName}get prefixedName(){return this.shortName?`-${this.shortName}`:`--${this.longName}`}set(){this._isSet=!0}_isSet=!1}class m extends p{constructor(t,e,s){super(t,e,s)}}class _ extends p{minCount;constructor(t=1){if(super("","",""),this.minCount=t,t<0)throw new d("Negative minCount in TrailingStringsOption.constructor")}add(t){this._strings.push(t),this._isSet=!0}get length(){return this._strings.length}get strings(){return this._strings}_strings=[]}class g{static fromArgs(t,e){const s=new e,r=s._getStrings();let n=!1;for(const e of t)if(e.startsWith("-")&&e.length>1){if(n)throw new d("Cannot have named option after parsing a trailing path");if(e.startsWith("--")){const t=e.slice(2);s._findByLongName(t).set()}else{const t=e.slice(1);s._findByShortName(t).set()}}else{if(null===r)throw new d(`Unrecognised option: ${e}`);r.add(e),n=!0}if(r&&r.length<r.minCount)throw new d("Insufficient trailing strings options specified");return s}writeHelp(t){for(const e of this._help())t.write(`${e}\n`)}_findByLongName(t){let e;for(e of Object.values(this))if(e.longName===t)return e;throw new d(`No such longName option '${t}'`)}_findByShortName(t){let e;for(e of Object.values(this))if(e.shortName===t)return e;throw new d(`No such shortName option '${t}'`)}_getStrings(){return"trailingStrings"in this?this.trailingStrings:null}_help(){return[...Object.values(this)].sort(((t,e)=>t.name>e.name?1:-1)).map((t=>{const e=t.prefixedName,s=Math.max(1,12-e.length);return`    ${e}${" ".repeat(s)}${t.description}`}))}}class y extends g{trailingStrings=new _(0)}class w extends f{get name(){return"alias"}async _run(t){const{aliases:e,args:s,stdout:r}=t,n=g.fromArgs(s,y);if(n.trailingStrings.isSet)for(const t of n.trailingStrings.strings){const s=t.indexOf("=");-1===s?r.write(`${t}='${e.get(t)}'\n`):e.set(t.slice(0,s),t.slice(s+1))}else for(const[t,s]of e.entries())r.write(`${t}='${s}'\n`);return i.SUCCESS}}class S extends g{trailingStrings=new _(0)}class C extends f{get name(){return"cd"}async _run(t){const{args:e}=t,s=g.fromArgs(e,S).trailingStrings.strings;if(s.length<1)return i.SUCCESS;if(s.length>1)throw new d("cd: too many arguments");let r=s[0];if("-"===r){const e=t.environment.get("OLDPWD");if(void 0===e)throw new d("cd: OLDPWD not set");r=e,t.stdout.write(`${r}\n`)}const{FS:n}=t.fileSystem,a=n.cwd();return n.chdir(r),t.environment.set("OLDPWD",a),t.environment.set("PWD",n.cwd()),i.SUCCESS}}class b extends f{get name(){return"clear"}async _run(t){const{stdout:e}=t;return e.supportsAnsiEscapes()&&e.write("[2J[3J[H"),i.SUCCESS}}class v extends g{trailingStrings=new _(0)}class A extends f{get name(){return"export"}async _run(t){const{args:e,environment:s}=t,r=g.fromArgs(e,v);if(r.trailingStrings.isSet)for(const t of r.trailingStrings.strings){const e=t.indexOf("=");if(e>0){const r=t.slice(0,e),n=t.slice(e+1);s.set(r,n)}}return i.SUCCESS}}class x extends g{clear=new m("c","","clear the history by deleting all of the entries");help=new m("","help","display this help and exit")}class N extends f{get name(){return"history"}async _run(t){const{args:e,history:s,stdout:r}=t,n=g.fromArgs(e,x);return n.help.isSet?n.writeHelp(r):n.clear.isSet?s.clear():s.write(r),i.SUCCESS}}class E{constructor(t){this.registerBuiltinCommands(r),this._commandRunners=[new o(t),new h(t),new u(t)];for(const t of this._commandRunners)for(const e of t.names())this._map.set(e,t)}get(t){return this._map.get(t)??null}match(t){return[...this._map.keys()].filter((e=>e.startsWith(t))).sort()}register(t,e){this._map.set(t,e)}registerBuiltinCommands(t){for(const[e,s]of Object.entries(t))if(e.endsWith("Command")&&!e.startsWith("Builtin"))try{const t=new s;t instanceof f&&this.register(t.name,t)}catch{}}_commandRunners;_map=new Map}class k{args;fileSystem;mountpoint;aliases;environment;history;stdin;stdout;stderr;constructor(t,e,s,r,n,i,a,o,h){this.args=t,this.fileSystem=e,this.mountpoint=s,this.aliases=r,this.environment=n,this.history=i,this.stdin=a,this.stdout=o,this.stderr=h}async flush(){await this.stderr.flush(),await this.stdout.flush()}}class O{get allContent(){return this.data.join("")}clear(){this.data=[]}supportsAnsiEscapes(){return!1}write(t){this.data.push(t)}data=[]}class T{async flush(){}supportsAnsiEscapes(){return!1}write(t){console.log(t)}}class R{isTerminal(){return!1}readChar(){if(void 0===this._buffer&&(this._buffer=this.readAll(),this._index=0),this._index<this._buffer.length){const t=this._buffer[this._index++],e=[];for(let s=0;s<t.length;s++)e.push(t.charCodeAt(s));return e}return[4]}_buffer;_index=0}class F extends R{fileSystem;path;constructor(t,e){super(),this.fileSystem=t,this.path=e}readAll(){const{FS:t}=this.fileSystem;return t.readFile(this.path,{encoding:"utf8"})}}class B extends O{fileSystem;path;append;constructor(t,e,s){super(),this.fileSystem=t,this.path=e,this.append=s}async flush(){const{FS:t}=this.fileSystem;let e=this.allContent;if(this.append)try{e=t.readFile(this.path,{encoding:"utf8"})+e}catch(t){}t.writeFile(this.path,e,{mode:436}),this.clear()}}class D extends R{pipe;constructor(t){super(),this.pipe=t}readAll(){const t=this.pipe.allContent;return this.pipe.clear(),t}}class L extends O{async flush(){}get input(){return new D(this)}}class P extends O{constructor(t){super(),this.target=t}async flush(){this.data.forEach((async t=>this.target.write(t))),this.clear(),await this.target.flush()}target}class M{stdinCallback;constructor(t){this.stdinCallback=t}isTerminal(){return!0}readChar(){if(this._finished||void 0===this.stdinCallback)return[4];{const t=this.stdinCallback();if(4===t[0])this._finished=!0;else if(13===t[0])return[10];return t}}_finished=!1}class W extends O{outputCallback;prefix;suffix;constructor(t,e=null,s=null){super(),this.outputCallback=t,this.prefix=e,this.suffix=s}async flush(){this.data.forEach((async t=>await this.outputCallback(t))),this.clear()}supportsAnsiEscapes(){return!0}write(t){null!==this.prefix&&(t=this.prefix+t),null!==this.suffix&&(t+=this.suffix),super.write(t)}}function j(t,e=!0,s){const r=new $(t,e,s);return r.run(),r.tokens}var Q;!function(t){t[t.None=0]="None",t[t.Delimiter=1]="Delimiter",t[t.DoubleQuote=2]="DoubleQuote",t[t.SingleQuote=3]="SingleQuote",t[t.Whitespace=4]="Whitespace",t[t.Other=5]="Other"}(Q||(Q={}));class ${throwErrors;aliases;constructor(t,e,s){this.throwErrors=e,this.aliases=s,this._source=t,this._tokens=[]}run(){for(;this._index<=this._source.length;)this._next();if(this.throwErrors&&""!==this._endQuote)throw new d("Tokenize error, expected end quote "+this._endQuote)}get tokens(){return this._tokens}_addToken(){const t=this._offset,e=this._value;if(void 0!==this.aliases&&t!==this._aliasOffset&&(0===this._tokens.length||";&|".includes(this._tokens.at(-1).value.at(-1)))){const s=this.aliases.getRecursive(e);if(void 0!==s){const r=e.length;return this._offset=-1,this._index=t-1,this._aliasOffset=t,this._source=this._source.slice(0,t)+s+this._source.slice(t+r),this._prevChar="",this._prevCharType=Q.None,this._value="",this._endQuote="",!1}}return this._tokens.push({offset:t,value:e}),this._endQuote="",!0}_getCharType(t){return" ".includes(t)?Q.Whitespace:";&|><".includes(t)?Q.Delimiter:"'"===t?Q.SingleQuote:'"'===t?Q.DoubleQuote:Q.Other}_endQuoteFromCharType(t){return t===Q.DoubleQuote?'"':t===Q.SingleQuote?"'":""}_next(){const t=++this._index,e=t<this._source.length?this._source[t]:" ";let s=this._getCharType(e);const r=this._endQuoteFromCharType(s);this._offset>=0?this._endQuote?e!==this._endQuote?this._value+=e:(this._endQuote="",s=Q.Other):r?this._endQuote=r:s===Q.Whitespace?this._addToken()&&(this._offset=-1):s!==this._prevCharType||s===Q.Delimiter&&e!==this._prevChar?this._addToken()&&(this._offset=t,this._value=e):this._value+=e:s!==Q.Whitespace&&(this._offset=t,this._endQuote=this._endQuoteFromCharType(s),this._value=""===this._endQuote?e:""),this._prevChar=e,this._prevCharType=s}_source;_tokens;_prevChar="";_prevCharType=Q.None;_index=-1;_offset=-1;_aliasOffset=-1;_value="";_endQuote=""}const U=";&";class I{}class z extends I{name;suffix;redirects;constructor(t,e,s){super(),this.name=t,this.suffix=e,this.redirects=s}lastToken(){return this.redirects&&this.redirects.length>0?this.redirects[this.redirects.length-1].lastToken():this.suffix.length>0?[this.suffix[this.suffix.length-1],!1]:[this.name,!0]}}class H extends I{commands;constructor(t){super(),this.commands=t}lastToken(){return this.commands.length>0?this.commands[this.commands.length-1].lastToken():[null,!1]}}class Y extends I{token;target;constructor(t,e){super(),this.token=t,this.target=e}lastToken(){return[this.target,!1]}}function G(t,e=!0,s){const r=j(t,e,s),n=[],i=[];let a=-1;const o=r.length;function h(){1===i.length?n.push(i[0]):i.length>1&&n.push(new H([...i])),i.length=0}for(let t=0;t<o;t++){const e=r[t];a>=0?U.includes(e.value)?(i.push(q(r.slice(a,t))),h(),a=-1):"|"===e.value&&(i.push(q(r.slice(a,t))),a=-1):U.includes(e.value)||(a=t)}return a>=0&&i.push(q(r.slice(a,o))),h(),n}function q(t){let e=t.slice(1);const s=e.findIndex((t=>{return(e=t.value).startsWith(">")||e.startsWith("<");var e}));if(s>=0){if(e.length!==s+2)throw new d("Redirect should be followed by file to redirect to");const r=new Y(e[s],e[s+1]);return e=e.slice(0,s),new z(t[0],e,[r])}return new z(t[0],e)}const J=Symbol("Comlink.proxy"),V=Symbol("Comlink.endpoint"),X=Symbol("Comlink.releaseProxy"),K=Symbol("Comlink.finalizer"),Z=Symbol("Comlink.thrown"),tt=t=>"object"==typeof t&&null!==t||"function"==typeof t,et=new Map([["proxy",{canHandle:t=>tt(t)&&t[J],serialize(t){const{port1:e,port2:s}=new MessageChannel;return st(t,e),[s,[s]]},deserialize:t=>(t.start(),nt(t))}],["throw",{canHandle:t=>tt(t)&&Z in t,serialize({value:t}){let e;return e=t instanceof Error?{isError:!0,value:{message:t.message,name:t.name,stack:t.stack}}:{isError:!1,value:t},[e,[]]},deserialize(t){if(t.isError)throw Object.assign(new Error(t.value.message),t.value);throw t.value}}]]);function st(t,e=globalThis,s=["*"]){e.addEventListener("message",(function r(n){if(!n||!n.data)return;if(!function(t,e){for(const s of t){if(e===s||"*"===s)return!0;if(s instanceof RegExp&&s.test(e))return!0}return!1}(s,n.origin))return void console.warn(`Invalid origin '${n.origin}' for comlink proxy`);const{id:i,type:a,path:o}=Object.assign({path:[]},n.data),h=(n.data.argumentList||[]).map(pt);let u;try{const e=o.slice(0,-1).reduce(((t,e)=>t[e]),t),s=o.reduce(((t,e)=>t[e]),t);switch(a){case"GET":u=s;break;case"SET":e[o.slice(-1)[0]]=pt(n.data.value),u=!0;break;case"APPLY":u=s.apply(e,h);break;case"CONSTRUCT":u=dt(new s(...h));break;case"ENDPOINT":{const{port1:e,port2:s}=new MessageChannel;st(t,s),u=function(t,e){return ct.set(t,e),t}(e,[e])}break;case"RELEASE":u=void 0;break;default:return}}catch(t){u={value:t,[Z]:0}}Promise.resolve(u).catch((t=>({value:t,[Z]:0}))).then((s=>{const[n,o]=ft(s);e.postMessage(Object.assign(Object.assign({},n),{id:i}),o),"RELEASE"===a&&(e.removeEventListener("message",r),rt(e),K in t&&"function"==typeof t[K]&&t[K]())})).catch((t=>{const[s,r]=ft({value:new TypeError("Unserializable return value"),[Z]:0});e.postMessage(Object.assign(Object.assign({},s),{id:i}),r)}))})),e.start&&e.start()}function rt(t){(function(t){return"MessagePort"===t.constructor.name})(t)&&t.close()}function nt(t,e){return ut(t,[],e)}function it(t){if(t)throw new Error("Proxy has been released and is not useable")}function at(t){return mt(t,{type:"RELEASE"}).then((()=>{rt(t)}))}const ot=new WeakMap,ht="FinalizationRegistry"in globalThis&&new FinalizationRegistry((t=>{const e=(ot.get(t)||0)-1;ot.set(t,e),0===e&&at(t)}));function ut(t,e=[],s=function(){}){let r=!1;const n=new Proxy(s,{get(s,i){if(it(r),i===X)return()=>{!function(t){ht&&ht.unregister(t)}(n),at(t),r=!0};if("then"===i){if(0===e.length)return{then:()=>n};const s=mt(t,{type:"GET",path:e.map((t=>t.toString()))}).then(pt);return s.then.bind(s)}return ut(t,[...e,i])},set(s,n,i){it(r);const[a,o]=ft(i);return mt(t,{type:"SET",path:[...e,n].map((t=>t.toString())),value:a},o).then(pt)},apply(s,n,i){it(r);const a=e[e.length-1];if(a===V)return mt(t,{type:"ENDPOINT"}).then(pt);if("bind"===a)return ut(t,e.slice(0,-1));const[o,h]=lt(i);return mt(t,{type:"APPLY",path:e.map((t=>t.toString())),argumentList:o},h).then(pt)},construct(s,n){it(r);const[i,a]=lt(n);return mt(t,{type:"CONSTRUCT",path:e.map((t=>t.toString())),argumentList:i},a).then(pt)}});return function(t,e){const s=(ot.get(e)||0)+1;ot.set(e,s),ht&&ht.register(t,e,t)}(n,t),n}function lt(t){const e=t.map(ft);return[e.map((t=>t[0])),(s=e.map((t=>t[1])),Array.prototype.concat.apply([],s))];var s}const ct=new WeakMap;function dt(t){return Object.assign(t,{[J]:!0})}function ft(t){for(const[e,s]of et)if(s.canHandle(t)){const[r,n]=s.serialize(t);return[{type:"HANDLER",name:e,value:r},n]}return[{type:"RAW",value:t},ct.get(t)||[]]}function pt(t){switch(t.type){case"HANDLER":return et.get(t.name).deserialize(t.value);case"RAW":return t.value}}function mt(t,e,s){return new Promise((r=>{const n=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");t.addEventListener("message",(function e(s){s.data&&s.data.id&&s.data.id===n&&(t.removeEventListener("message",e),r(s.data))})),t.start&&t.start(),t.postMessage(Object.assign({id:n},e),s)}))}class _t{constructor(t){if(void 0===t){const t=(this._maxChars+3)*Int32Array.BYTES_PER_ELEMENT;this._sharedArrayBuffer=new SharedArrayBuffer(t)}else this._sharedArrayBuffer=t;this._intArray=new Int32Array(this._sharedArrayBuffer),void 0===t&&(this._intArray[0]=0,this._intArray[1]=0)}async disable(){this._enabled=!1,this._clear()}async enable(){this._enabled=!0}get enabled(){return this._enabled}_clear(){this._intArray[0]=0,this._intArray[1]=0,this._readCount=0}_loadFromSharedArrayBuffer(){const t=Atomics.load(this._intArray,2),e=[];for(let s=0;s<t;s++)e.push(Atomics.load(this._intArray,3+s));return e}_enabled=!1;_maxChars=8;_sharedArrayBuffer;_intArray;_readCount=0}class gt extends _t{constructor(){super()}async disable(){if(this._disabling=!0,this._storedCount!==this._readCount){const t=this._loadFromSharedArrayBuffer();let e="";for(const s of t)e+=String.fromCharCode(s);await this._sendStdinNow(e)}for(;this._buffer.length>0;)await this._sendStdinNow(this._buffer.shift());this._disabling=!1,super.disable()}get sharedArrayBuffer(){return this._sharedArrayBuffer}async push(t){this._buffer.push(t),this._bufferCount++,t.length>this._maxChars&&console.log(`String '${t}' is too long to buffer`),this._disabling||this._readCount!==this._storedCount||this._storeInSharedArrayBuffer()}registerSendStdinNow(t){this._sendStdinNow=t}_afterRead(){if(this._readCount=Atomics.load(this._intArray,1),this._readCount!==this._storedCount)throw new Error("Should not happen");this._bufferCount>this._storedCount&&this._storeInSharedArrayBuffer()}_clear(){super._clear(),this._buffer=[],this._bufferCount=0,this._storedCount=0}_storeInSharedArrayBuffer(){const t=this._buffer.shift();this._storedCount++;const e=t.length;Atomics.store(this._intArray,2,e);for(let s=0;s<e;s++)Atomics.store(this._intArray,3+s,t.charCodeAt(s));Atomics.store(this._intArray,0,this._storedCount),Atomics.notify(this._intArray,0,1);const{async:s,value:r}=Atomics.waitAsync(this._intArray,1,this._readCount);s&&r.then((()=>this._afterRead()))}_buffer=[];_bufferCount=0;_disabling=!1;_storedCount=0;_sendStdinNow}class yt{options;constructor(t){this.options=t,this._bufferedStdin=new gt,this._initWorker(t)}async _initWorker(t){this._worker=new Worker(new URL(s.p+s.u(817),s.b),{type:void 0}),this._remote=nt(this._worker);const{color:e,mountpoint:r,wasmBaseUrl:n,driveFsBaseUrl:i,initialDirectories:a,initialFiles:o}=t,{sharedArrayBuffer:h}=this._bufferedStdin;await this._remote.initialize({color:e,mountpoint:r,wasmBaseUrl:n,driveFsBaseUrl:i,sharedArrayBuffer:h,initialDirectories:a,initialFiles:o},dt(t.outputCallback),dt(this.enableBufferedStdinCallback.bind(this))),this._bufferedStdin.registerSendStdinNow(this._remote.input)}async enableBufferedStdinCallback(t){t?await this._bufferedStdin.enable():await this._bufferedStdin.disable()}async input(t){this._bufferedStdin.enabled?await this._bufferedStdin.push(t):await this._remote.input(t)}async setSize(t,e){await this._remote.setSize(t,e)}async start(){await this._remote.start()}_worker;_remote;_bufferedStdin}}}]);